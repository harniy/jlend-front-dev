import{b as re,a as X,w as ie,e as G,C as ce,s as de,R as ue,c as _e,d as me,_ as pe}from"./Cd1Lq6Ri.js";import{u as le,a as J,c as Q,t as ee,s as O,e as be,f as te,g as ve,_ as ge,b as E,h as q,d as xe,i as he,j as ye,k as we}from"./BcbHYa65.js";import{d as ae,s as fe,c as n,r as D,g as ne,v as ke,w as K,h as F,o as d,l as s,e as a,b,u as o,i as Y,f as w,t as c,a as $,F as P,x as oe,y as $e,q as Ce,j as se,z as Ve,n as je,C as Be,_ as Ne}from"./BJUxEtg5.js";import{a as Te}from"./BZgHvP1V.js";const Me={class:"account-dialog__title"},Se=["src","alt"],Ue={class:"account-dialog__body"},Ae={class:"account-info-table"},De={class:"account-dialog-action"},Fe=ae({__name:"RepayDialog",props:fe({data:{},modelValue:{type:Boolean}},{modelValue:{default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const f=le(),k=J(),C=re(),A=n(()=>C.publicKey),L=X(),R=n(()=>L.jLendClient),S=Q(),U=n(()=>S.userTotalDepositInUsd),p=n(()=>S.userTotalBorrowedInUsd),_=D(!1),T=D(!1),v=ne(k,"repayAmount"),I=D(0),r=n(()=>t.data?t.data.asset.symbol==="XLM"?C.nativeBalance:C.getAssetBalance(String(t.data.asset_issuer)):0),i=n(()=>t.data?.raw?.config?.close_ltv_bps?Number(t.data.raw.config.close_ltv_bps)/1e4:0),V=n(()=>{const m=Number(v.value||0)*Number(t.data?.raw?.pool_price||0),g=U.value*i.value,x=Math.max(p.value-m,0),e=Math.max(g/x,0);return Math.min(e,10)});ie([()=>t.data,T,A],async([m,g])=>{if(!m||!A.value)return;const x=await R.value?.sdk.repayTx(A.value,m?.pool_address||"",0);I.value=R.value.sdk.getTransactionFee(x)},{immediate:!0,debounce:300});const M=n(()=>{if(!t.data)return[];const m=Math.max(Number(t.data?.debt)-v.value||0,0);return[{name:"healthFactor",label:"Health Factor",value:ee(V.value,2)},{label:"Borrow balance after repay",value:`${O(m)} ${t.data.asset.symbol}`},{label:"Transaction Fee",value:`${I.value} XLM`}]}),u=ke(t,"modelValue");async function j(){if(t.data){if(!v.value||v.value<=0){ve(".repay-dialog__input");return}try{_.value=!0,f.poolDepositAddr=t.data?.pool_address,await k.repay(t.data?.pool_address,v.value,r.value,t.data?.asset.symbol)}finally{_.value=!1}}}let N;return K(()=>t.modelValue,async m=>{if(clearInterval(N),!m){setTimeout(()=>{v.value=0},ce);return}N=de(()=>{T.value=!0,$e(()=>{T.value=!1})},ue)}),(m,g)=>{const x=be,e=te,l=G,h=ge;return d(),F(h,{modelValue:u.value,"onUpdate:modelValue":g[1]||(g[1]=y=>u.value=y),"class-name":"account-dialog"},{header:s(()=>[a("div",Me,[a("img",{src:m.data?.asset.icon,alt:`${m.data?.asset.symbol} icon`},null,8,Se),a("span",null,"Repay "+c(m.data?.asset.symbol),1)])]),default:s(()=>[a("div",Ue,[b(x,{modelValue:o(v),"onUpdate:modelValue":g[0]||(g[0]=y=>Y(v)?v.value=y:null),class:"repay-dialog__input",balance:o(r),limit:Number(m.data?.debt)||0,rules:[y=>y&&Number(y)<o(r)||"Insufficient balance"]},{"label-right":s(()=>[w(" Repay with Wallet: "+c(o(r))+" "+c(m.data?.asset.symbol),1)]),_:1},8,["modelValue","balance","limit","rules"]),a("div",Ae,[(d(!0),$(P,null,oe(o(M),y=>(d(),$("div",{key:y.label,class:"account-info-table__item"},[a("span",null,c(y?.label),1),a("span",null,[y?.name==="healthFactor"&&o(_)?(d(),F(e,{key:0,width:"14px",style:{padding:"0",width:"14px","margin-left":"auto"}})):(d(),$(P,{key:1},[w(c(y?.value),1)],64))])]))),128))]),a("div",De,[b(l,{loading:o(_),variant:"success",size:"md",pill:"",onClick:j},{default:s(()=>[w(" Repay "+c(m.data?.asset.symbol),1)]),_:1},8,["loading"])])])]),_:1},8,["modelValue"])}}}),Ie=Object.assign(Fe,{__name:"RepayDialog"}),Le={width:"30",height:"30",viewBox:"0 0 30 30",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Re(t,f){return d(),$("svg",Le,f[0]||(f[0]=[a("path",{d:"M11.2231 2.5H18.7231C24.9731 2.5 27.4731 5 27.4731 11.25V18.75C27.4731 25 24.9731 27.5 18.7231 27.5H11.2231C4.97314 27.5 2.47314 25 2.47314 18.75V11.25C2.47314 5 4.97314 2.5 11.2231 2.5Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),a("path",{d:"M10.7126 19.0875L18.8876 10.9125",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),a("path",{d:"M11.225 12.9625C12.0742 12.9625 12.7625 12.2742 12.7625 11.425C12.7625 10.5759 12.0742 9.8875 11.225 9.8875C10.3759 9.8875 9.6875 10.5759 9.6875 11.425C9.6875 12.2742 10.3759 12.9625 11.225 12.9625Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),a("path",{d:"M19.4 20.1125C20.2492 20.1125 20.9375 19.4241 20.9375 18.575C20.9375 17.7258 20.2492 17.0375 19.4 17.0375C18.5509 17.0375 17.8625 17.7258 17.8625 18.575C17.8625 19.4241 18.5509 20.1125 19.4 20.1125Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}const He=Ce({name:"app-percentage-square-icon",render:Re}),We={class:"account-card"},Oe={key:1,class:"table-wrapper"},Pe={class:"market-table__asset"},ze=["src"],Ee={class:"market-table__asset__info"},Ze={class:"market-table__asset__info__name"},Ke={class:"market-table__asset__info__symbol"},Ye={class:"table-cell justify-content-center"},qe={class:"table-cell justify-content-center"},Xe={key:1,class:"no-data"},Ge=ae({__name:"AccountCardBorrows",setup(t){const f=X(),k=n(()=>f.assetDecimals),C=Q(),A=n(()=>C.userObligation),L=le(),R=n(()=>L.state.pools),S=J(),U=[{key:"asset",label:"Asset",align:"left"},{key:"debt",label:"Debt",align:"right"},{key:"borrow_apy",label:"Borrow APY",align:"center"},{key:"action",label:""}],p=n(()=>(A.value?.borrows||[]).map(i=>{const[V,M]=i,u=R.value.find(h=>h.pool_address===V);if(!u)return{asset:{name:"Unknown",symbol:"Unknown",icon:""},balance:"0",supply_apy:"0%",action:"Repay"};const j=u.token_ticker,N=me(j),m=_e(j),g=E(M.borrowed+M.unpaid_interest,k.value),x=q(Number(g)*Number(u.pool_price),2,2),[,e]=xe(u.name),l=u.pool_apy.borrow_bps/100;return{raw:u,asset:{name:N,symbol:j,icon:m},debt:g,debtUsd:x,borrow_apy:`${ee(l||0,2)}%`,action:"Repay",pool_address:V,asset_issuer:e}})),_=D(!1),T=D(),v=n(()=>p.value.find(r=>r.pool_address===T.value));function I(r){T.value=r.item?.pool_address,_.value=!0}return K(v,r=>{r||(_.value=!1)}),(r,i)=>{const V=he,M=we,u=ye,j=G,N=pe,m=He,g=te,x=Ie;return d(),$(P,null,[a("div",We,[i[3]||(i[3]=a("div",{class:"account-card__title"}," Your Borrows ",-1)),o(p).length===0&&o(C).loading?(d(),$(P,{key:0},[b(V,{height:"36","full-width":""}),b(V,{height:"80","full-width":"",style:{"margin-top":"-8px"}})],64)):(d(),$("div",Oe,[o(p).length>0?(d(),F(N,{key:0,borderless:"",fields:U,items:o(p),responsive:"",class:"account-card__table market-table"},Ve({"cell(asset)":s(e=>[a("div",Pe,[a("img",{src:e.item.asset.icon,alt:""},null,8,ze),a("div",Ee,[a("div",Ze,c(e.item.asset.symbol),1),a("div",Ke,c(e.item.asset.name),1)])])]),"cell(debt)":s(e=>[b(M,{"tooltip-class":"table-cell table-cell__dept justify-content-end with-price"},{content:s(()=>[w(c(o(q)(e.item.debt)),1)]),default:s(()=>[w(c(Number(e.item.debt)>1e3?o(O)(Number(e.item.debt)):Number(e.item.debt).toFixed(5))+" ",1),a("span",null,"$"+c(e.item.debtUsd),1)]),_:2},1024)]),"cell(borrow_apy)":s(e=>[a("div",Ye,[b(u,{color:"#111","bg-color":"#e49c0b80",size:"md"},{default:s(()=>[w(c(e.item.borrow_apy),1)]),_:2},1024)])]),"cell(action)":s(e=>[a("div",qe,[b(j,{pill:"",variant:"success","icon-right":"",size:"lg",class:"repay-btn",disabled:o(S).isDisabled(e.item.pool_address,"repay"),loading:o(S).isLoading(e.item.pool_address,"repay"),onClick:l=>I(e)},{default:s(()=>[w(c(e.item.action),1)]),_:2},1032,["disabled","loading","onClick"])])]),_:2},[oe(U,e=>({name:`head(${e.key})`,fn:s(l=>[a("span",{style:je({"--align":e.align})},c(l.label),5)])}))]),1032,["items"])):(d(),$("div",Xe,[b(m),i[1]||(i[1]=w(" no borrowed assets ",-1))])),o(C).loading?(d(),F(g,{key:2},{default:s(()=>i[2]||(i[2]=[w(" Loading... ",-1)])),_:1,__:[2]})):se("",!0)]))]),b(x,{modelValue:o(_),"onUpdate:modelValue":i[0]||(i[0]=e=>Y(_)?_.value=e:null),data:o(v)},null,8,["modelValue","data"])],64)}}}),Je=Object.assign(Ge,{__name:"AccountCardBorrows"}),Qe={class:"account-dialog__title"},et=["src","alt"],tt={class:"account-dialog__body"},at={class:"account-info-table"},ot={class:"account-dialog-action"},nt=ae({__name:"WithdrawDialog",props:fe({data:{},modelValue:{type:Boolean}},{modelValue:{default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const f=X(),k=n(()=>f.jLendClient),C=Q(),A=n(()=>C.userTotalDepositInUsd),L=n(()=>C.userTotalBorrowedInUsd),R=re(),S=n(()=>R.publicKey),U=J(),p=ne(U,"withdrawAmount"),_=ne(U,"collateralOnly"),T=D(!1),v=D(!1),I=D(0),r=n(()=>Number(t.data?.collateral)||0),i=n(()=>Number(t.data?.balance||0)-r.value),V=n(()=>Number(t.data?.balance)||0),M=n(()=>Number(_.value?r.value:i.value)-p.value),u=n(()=>t.data?.raw.config.close_ltv_bps?Number(t.data.raw.config.close_ltv_bps)/1e4:0),j=n(()=>{const l=Number(t.data?.price||0),h=Number(p.value||0)*l,y=Math.max(A.value-h,0),H=L.value,z=H===0?10:Math.max(y*u.value/H,0);return Math.min(z,10)}),N=n(()=>{const l=Number(t.data?.price||1),h=A.value,H=L.value/u.value;let W=Math.max(h-H,0)/l;const Z=_.value?r.value:i.value;return W=Math.min(Z,W),Math.max(W,0)});ie([()=>t.data,v,S],async([l,h])=>{if(!l||!S.value)return;const y=await k.value?.sdk.withdrawTx(S.value,l?.pool_address||"",0);I.value=k.value.sdk.getTransactionFee(y)},{immediate:!0,debounce:300});const m=n(()=>t.data?[{name:"healthFactor",label:"Health Factor",value:ee(j.value||0,2)},{label:"Total supply",value:`${O(V.value||0)} ${t.data?.asset.symbol}`},{label:"Deposited balance",value:`${O(i.value||0)} ${t.data?.asset.symbol}`},{label:"Collateral balance",value:`${O(r.value||0)} ${t.data?.asset.symbol}`},{label:"Remaining supply",value:`${O(Math.max(M.value||0,0))} ${t.data?.asset.symbol}`},{label:"Available to withdraw",value:`${O(N.value||0)} ${t.data?.asset.symbol}`},{label:"Transaction Fee",value:`${I.value||0} XLM`}]:[]),g=ke(t,"modelValue");async function x(){if(t.data){if(!p.value||p.value<=0){ve(".withdraw-dialog__input");return}try{T.value=!0,_.value?await U.removeCollateral(t.data?.pool_address,p.value,r.value,t.data?.asset.symbol):await U.withdraw(t.data?.pool_address,p.value,i.value,t.data?.asset.symbol)}finally{T.value=!1}}}let e;return K(()=>t.modelValue,async l=>{if(clearInterval(e),!l){setTimeout(()=>{p.value=0},ce),_.value=!1;return}e=de(()=>{v.value=!0,$e(()=>{v.value=!1})},ue)}),K(r,l=>{l<=0&&(_.value=!1)},{immediate:!0}),(l,h)=>{const y=be,H=te,z=Te,W=G,Z=ge;return d(),F(Z,{modelValue:g.value,"onUpdate:modelValue":h[2]||(h[2]=B=>g.value=B),"class-name":"account-dialog"},{header:s(()=>[a("div",Qe,[a("img",{src:l.data?.asset.icon,alt:`${l.data?.asset.symbol} icon`},null,8,et),a("span",null,"Withdraw "+c(l.data?.asset.symbol),1)])]),default:s(()=>[a("div",tt,[b(y,{modelValue:o(p),"onUpdate:modelValue":h[0]||(h[0]=B=>Y(p)?p.value=B:null),balance:o(N),class:"withdraw-dialog__input",rules:[B=>B&&Number(B)<=o(N)||"Withdraw limit exceeded"]},{"label-right":s(()=>[w(" Amount: "+c(o(N).toFixed(5))+" "+c(l.data?.asset.symbol),1)]),_:1},8,["modelValue","balance","rules"]),a("div",at,[(d(!0),$(P,null,oe(o(m),B=>(d(),$("div",{key:B.label,class:"account-info-table__item"},[a("span",null,c(B?.label),1),a("span",null,[B?.name==="healthFactor"&&o(T)?(d(),F(H,{key:0,width:"14px",style:{padding:"0",width:"14px","margin-left":"auto"}})):(d(),$(P,{key:1},[w(c(B?.value),1)],64))])]))),128))]),o(r)>0?(d(),F(z,{key:0,modelValue:o(_),"onUpdate:modelValue":h[1]||(h[1]=B=>Y(_)?_.value=B:null)},{append:s(()=>h[3]||(h[3]=[w(" Collateral Balance ",-1)])),_:1},8,["modelValue"])):se("",!0),a("div",ot,[b(W,{loading:o(T),variant:"dark",size:"md",pill:"",onClick:x},{default:s(()=>[w(" Withdraw "+c(l.data?.asset.symbol),1)]),_:1},8,["loading"])])])]),_:1},8,["modelValue"])}}}),lt=Object.assign(nt,{__name:"WithdrawDialog"}),st={width:"30",height:"30",viewBox:"0 0 30 30",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function rt(t,f){return d(),$("svg",st,f[0]||(f[0]=[Be('<path d="M11.2499 27.5H18.7499C24.9999 27.5 27.4999 25 27.4999 18.75V11.25C27.4999 5 24.9999 2.5 18.7499 2.5H11.2499C4.99988 2.5 2.49988 5 2.49988 11.25V18.75C2.49988 25 4.99988 27.5 11.2499 27.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M9.99988 23.75H19.9999C22.4999 23.75 23.7499 22.5 23.7499 20V10C23.7499 7.5 22.4999 6.25 19.9999 6.25H9.99988C7.49988 6.25 6.24988 7.5 6.24988 10V20C6.24988 22.5 7.49988 23.75 9.99988 23.75Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M6.24988 11.875H9.34987C11.0749 11.875 12.4749 13.275 12.4749 15C12.4749 16.725 11.0749 18.125 9.34987 18.125H6.24988" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M23.7499 12.4875H19.9999" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M23.7499 17.5H19.9999" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M9.00012 15H9.12512" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path>',6)]))}const it=Ce({name:"app-strongbox-icon",render:rt}),ct={class:"account-card"},dt={key:1,class:"table-wrapper"},ut={class:"market-table__asset"},_t=["src"],mt={class:"market-table__asset__info"},pt={class:"market-table__asset__info__name"},bt={class:"market-table__asset__info__symbol"},vt={class:"table-cell justify-content-center"},gt={class:"table-cell justify-content-center"},ht={key:1,class:"no-data"},yt=ae({__name:"AccountCardSupplies",setup(t){const f=X(),k=n(()=>f.assetDecimals),C=Q(),A=n(()=>C.userObligation),L=le(),R=n(()=>L.state.pools),S=J(),U=[{key:"asset",label:"Asset",align:"left"},{key:"balance",label:"Balance",align:"right"},{key:"supply_apy",label:"Supply APY",align:"center"},{key:"action",label:""}],p=n(()=>(A.value?.deposits||[]).map(i=>{const[V,M]=i,u=R.value.find(B=>B.pool_address===V);if(!u)return{asset:{name:"Unknown",symbol:"Unknown",icon:""},balance:"0",supply_apy:"0%",action:"Withdraw",pool_address:V};const j=u.token_ticker,N=me(j),m=_e(j),g=E(M.shares,k.value),x=E(u.total_shares,k.value),e=Number(g)/Number(x),l=Number(E(u.available,k.value)),h=Number(E(u.total_borrowed,k.value)),H=(l+h)*e,z=E(M.collateral,k.value),W=Number(H)+Number(z),Z=u.pool_apy.supply_bps/100;return{raw:u,asset:{name:N,symbol:j,icon:m},balance:W,balanceUsd:q(W*Number(u.pool_price),2,2),price:Number(u.pool_price),available:l,supply_apy:`${ee(Z||0,2)}%`,action:"Withdraw",pool_address:V,collateral:z}})),_=D(!1),T=D(),v=n(()=>p.value.find(r=>r.pool_address===T.value));function I(r){T.value=r.item?.pool_address,_.value=!0}return K(v,r=>{r||(_.value=!1)}),(r,i)=>{const V=he,M=we,u=ye,j=G,N=pe,m=it,g=te,x=lt;return d(),$(P,null,[a("div",ct,[i[3]||(i[3]=a("div",{class:"account-card__title"}," Your Supplies ",-1)),o(p).length===0&&o(C).loading?(d(),$(P,{key:0},[b(V,{height:"36","full-width":""}),b(V,{height:"80","full-width":"",style:{"margin-top":"-8px"}})],64)):(d(),$("div",dt,[o(p).length>0?(d(),F(N,{key:0,borderless:"",fields:U,items:o(p),responsive:"",class:"account-card__table market-table"},Ve({"cell(asset)":s(e=>[a("div",ut,[a("img",{src:e.item.asset.icon,alt:""},null,8,_t),a("div",mt,[a("div",pt,c(e.item.asset.symbol),1),a("div",bt,c(e.item.asset.name),1)])])]),"cell(balance)":s(e=>[b(M,{"tooltip-class":"table-cell justify-content-end with-price"},{content:s(()=>[w(c(o(q)(e.item.balance)),1)]),default:s(()=>[w(c(Number(e.item.balance)>1e3?o(O)(Number(e.item.balance)):Number(e.item.balance).toFixed(5))+" ",1),a("span",null,"$"+c(e.item.balanceUsd),1)]),_:2},1024)]),"cell(supply_apy)":s(e=>[a("div",vt,[b(u,{color:"#111","bg-color":"#08b57680",size:"md"},{default:s(()=>[w(c(e.item.supply_apy),1)]),_:2},1024)])]),"cell(action)":s(e=>[a("div",gt,[b(j,{pill:"",variant:"dark",size:"lg",disabled:o(S).isDisabled(e.item.pool_address,"withdraw"),loading:o(S).isLoading(e.item.pool_address,"withdraw"),onClick:l=>I(e)},{default:s(()=>[w(c(e.item.action),1)]),_:2},1032,["disabled","loading","onClick"])])]),_:2},[oe(U,e=>({name:`head(${e.key})`,fn:s(l=>[a("span",{style:je({"--align":e.align})},c(l.label),5)])}))]),1032,["items"])):(d(),$("div",ht,[b(m),i[1]||(i[1]=w(" no supplied assets ",-1))])),o(C).loading?(d(),F(g,{key:2},{default:s(()=>i[2]||(i[2]=[w(" Loading... ",-1)])),_:1,__:[2]})):se("",!0)]))]),b(x,{modelValue:o(_),"onUpdate:modelValue":i[0]||(i[0]=e=>Y(_)?_.value=e:null),data:o(v)},null,8,["modelValue","data"])],64)}}}),wt=Object.assign(yt,{__name:"AccountCardSupplies"}),ft={},kt={class:"account-page container"},$t={class:"account-cards card"};function Ct(t,f){const k=wt,C=Je;return d(),$("main",kt,[a("div",$t,[b(k),f[0]||(f[0]=a("div",{class:"separator-vert"},null,-1)),b(C)])])}const Vt=Object.assign(Ne(ft,[["render",Ct]]),{__name:"AccountPage"}),jt={};function Nt(t,f){const k=Vt;return d(),F(k)}const St=Ne(jt,[["render",Nt]]);export{St as default};
