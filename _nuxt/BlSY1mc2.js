import{l as L,S as V,m as J,n as j,p as z,q as I,r as S,v as D,x as A,O as E,y as Y,z as Q,A as Z,B as ee,E as te,F as se,G as ne,H as re,I as ie,J as oe,K as T,L as ae,M as ce,N as le,Q as de,T as x,U as he,V as R,W as ue,X as y,Y as M,Z as v,$ as g,a0 as N,a1 as m,a2 as u,a3 as w,a4 as p,a5 as d,a6 as C,a7 as P,a8 as U,a9 as W,aa as k}from"./zpHdnZTQ.js";import{ad as ze,ac as Ye,ab as Qe}from"./zpHdnZTQ.js";import{p as a}from"./40nC5FYw.js";import"./CobzMJ77.js";var we={now:function(){return Date.now()}},ge=function(r){L(t,r);function t(e,s){return r.call(this)||this}return t.prototype.schedule=function(e,s){return this},t}(V),B={setInterval:function(r,t){for(var e=[],s=2;s<arguments.length;s++)e[s-2]=arguments[s];return setInterval.apply(void 0,J([r,t],j(e)))},clearInterval:function(r){return clearInterval(r)},delegate:void 0},fe=function(r){L(t,r);function t(e,s){var n=r.call(this,e,s)||this;return n.scheduler=e,n.work=s,n.pending=!1,n}return t.prototype.schedule=function(e,s){var n;if(s===void 0&&(s=0),this.closed)return this;this.state=e;var i=this.id,o=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(o,i,s)),this.pending=!0,this.delay=s,this.id=(n=this.id)!==null&&n!==void 0?n:this.requestAsyncId(o,this.id,s),this},t.prototype.requestAsyncId=function(e,s,n){return n===void 0&&(n=0),B.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,s,n){if(n===void 0&&(n=0),n!=null&&this.delay===n&&this.pending===!1)return s;s!=null&&B.clearInterval(s)},t.prototype.execute=function(e,s){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,s);if(n)return n;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,s){var n=!1,i;try{this.work(e)}catch(o){n=!0,i=o||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),i},t.prototype.unsubscribe=function(){if(!this.closed){var e=this,s=e.id,n=e.scheduler,i=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,z(i,this),s!=null&&(this.id=this.recycleAsyncId(n,s,null)),this.delay=null,r.prototype.unsubscribe.call(this)}},t}(ge),$=function(){function r(t,e){e===void 0&&(e=r.now),this.schedulerActionCtor=t,this.now=e}return r.prototype.schedule=function(t,e,s){return e===void 0&&(e=0),new this.schedulerActionCtor(this,t).schedule(s,e)},r.now=we.now,r}(),ye=function(r){L(t,r);function t(e,s){s===void 0&&(s=$.now);var n=r.call(this,e,s)||this;return n.actions=[],n._active=!1,n}return t.prototype.flush=function(e){var s=this.actions;if(this._active){s.push(e);return}var n;this._active=!0;do if(n=e.execute(e.state,e.delay))break;while(e=s.shift());if(this._active=!1,n){for(;e=s.shift();)e.unsubscribe();throw n}},t}($),be=new ye(fe),me=be;function X(r){return r&&I(r.schedule)}function pe(r){return r[r.length-1]}function ve(r){return X(pe(r))?r.pop():void 0}function f(r,t,e,s,n){s===void 0&&(s=0),n===void 0&&(n=!1);var i=t.schedule(function(){e(),n?r.add(this.schedule(null,s)):this.unsubscribe()},s);if(r.add(i),!n)return i}function q(r,t){return t===void 0&&(t=0),S(function(e,s){e.subscribe(D(s,function(n){return f(s,r,function(){return s.next(n)},t)},function(){return f(s,r,function(){return s.complete()},t)},function(n){return f(s,r,function(){return s.error(n)},t)}))})}function F(r,t){return t===void 0&&(t=0),S(function(e,s){s.add(r.schedule(function(){return e.subscribe(s)},t))})}function Ee(r,t){return A(r).pipe(F(t),q(t))}function Te(r,t){return A(r).pipe(F(t),q(t))}function ke(r,t){return new E(function(e){var s=0;return t.schedule(function(){s===r.length?e.complete():(e.next(r[s++]),e.closed||this.schedule())})})}function Ae(r,t){return new E(function(e){var s;return f(e,t,function(){s=r[Y](),f(e,t,function(){var n,i,o;try{n=s.next(),i=n.value,o=n.done}catch(c){e.error(c);return}o?e.complete():e.next(i)},0,!0)}),function(){return I(s==null?void 0:s.return)&&s.return()}})}function G(r,t){if(!r)throw new Error("Iterable cannot be null");return new E(function(e){f(e,t,function(){var s=r[Symbol.asyncIterator]();f(e,t,function(){s.next().then(function(n){n.done?e.complete():e.next(n.value)})},0,!0)})})}function xe(r,t){return G(Q(r),t)}function Ce(r,t){if(r!=null){if(Z(r))return Ee(r,t);if(ee(r))return ke(r,t);if(te(r))return Te(r,t);if(se(r))return G(r,t);if(ne(r))return Ae(r,t);if(re(r))return xe(r,t)}throw ie(r)}function Pe(r,t){return t?Ce(r,t):A(r)}function O(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=ve(r);return Pe(r,e)}function _(r,t){var e=I(r)?r:function(){return r},s=function(n){return n.error(e())};return new E(s)}function Le(r){return r instanceof Date&&!isNaN(r)}function Ie(r,t,e){e===void 0&&(e=me);var s=-1;return X(t)?e=t:s=t,new E(function(n){var i=Le(r)?+r-e.now():r;i<0&&(i=0);var o=0;return e.schedule(function(){n.closed||(n.next(o++),0<=s?this.schedule(void 0,s):n.complete())},i)})}function h(r){return S(function(t,e){A(r).subscribe(D(e,function(){return e.complete()},oe)),!e.closed&&t.subscribe(e)})}class Ke{get selectedModule(){const{selectedModuleId:t}=T.getValue();if(!t)throw{code:-3,message:"Please set the wallet first"};const e=this.modules.find(s=>s.productId===t);if(!e)throw{code:-3,message:"Please set the wallet first"};return e}constructor(t){this.modules=t.modules,t.selectedWalletId&&this.setWallet(t.selectedWalletId),ae(t.network);const e=t.theme||t.modalTheme;e&&ce(e),t.buttonTheme&&le(t.buttonTheme),this.getSupportedWallets().then(s=>{de(s)})}async getSupportedWallets(){return Promise.all(this.modules.map(async t=>{const e=new Promise(s=>setTimeout(()=>s(!1),500));return{id:t.productId,name:t.productName,type:t.moduleType,icon:t.productIcon,isAvailable:await Promise.race([e,t.isAvailable()]),url:t.productUrl}}))}setWallet(t){const e=this.modules.find(s=>s.productId===t);if(!e)throw new Error(`Wallet id "${t}" is not supported`);x(e.productId)}async getAddress(t){const{address:e}=await this.selectedModule.getAddress(t);return he(e),{address:e}}async signTransaction(t,e){return this.selectedModule.signTransaction(t,{...e,networkPassphrase:(e==null?void 0:e.networkPassphrase)||T.getValue().selectedNetwork})}async signAuthEntry(t,e){return this.selectedModule.signAuthEntry(t,{...e,networkPassphrase:(e==null?void 0:e.networkPassphrase)||T.getValue().selectedNetwork})}async signMessage(t,e){return this.selectedModule.signMessage(t,{...e,networkPassphrase:(e==null?void 0:e.networkPassphrase)||T.getValue().selectedNetwork})}async getNetwork(){return this.selectedModule.getNetwork()}async disconnect(){R()}isButtonCreated(){return!!this.buttonElement}assignButtons(t){const e=typeof t.connectEl=="string"?document.querySelector(t.connectEl):t.connectEl;if(!e)throw new Error("connectEl is not available");if(e.addEventListener("click",()=>{this.openModal({onWalletSelected:n=>{x(n.id),this.getAddress().then(i=>t.onConnect(i))}}).then()},!1),!t.disconnectEl)return;const s=typeof t.disconnectEl=="string"?document.querySelector(t.disconnectEl):t.disconnectEl;if(!s)throw new Error("disconnectEl is not available");s.addEventListener("click",()=>{t.onDisconnect(),R(),this.selectedModule.disconnect&&this.selectedModule.disconnect().then()},!1)}async createButton(t){if(this.buttonElement)throw new Error("Stellar Wallets Kit button is already created");this.buttonElement=document.createElement("stellar-wallets-button"),t.buttonText&&this.buttonElement.setAttribute("buttonText",t.buttonText),t.horizonUrl&&ue(t.horizonUrl),t.container.appendChild(this.buttonElement),this.buttonElement.addEventListener("button-clicked",()=>{this.openModal({onWalletSelected:e=>{x(e.id),this.getAddress().then(s=>t.onConnect(s)).catch(s=>{t.onError&&t.onError(s)})},onClosed:e=>{t.onClosed&&t.onClosed(e)}})},!1),this.buttonElement.addEventListener("disconnect-wallet",()=>{t.onDisconnect(),this.selectedModule.disconnect&&this.selectedModule.disconnect()},!1)}async removeButton(t){if(!this.buttonElement)throw new Error("Stellar Wallets Kit button hasn't been created yet");(t==null?void 0:t.skipDisconnect)!==!0&&this.buttonElement.disconnect(),this.buttonElement.remove(),delete this.buttonElement}async openModal(t){if(this.modalElement&&!this.buttonElement)throw new Error("Stellar Wallets Kit modal is already open");this.modalElement=document.createElement("stellar-wallets-modal"),this.modalElement.setAttribute("showModal",""),t.modalTitle&&this.modalElement.setAttribute("modalTitle",t.modalTitle),t.notAvailableText&&this.modalElement.setAttribute("notAvailableText",t.notAvailableText),document.body.appendChild(this.modalElement);const e=n=>{t.onWalletSelected(n.detail),this.modalElement.removeEventListener("wallet-selected",e,!1),document.body.removeChild(this.modalElement),this.modalElement=void 0};this.modalElement.addEventListener("wallet-selected",e,!1);const s=n=>{t.onClosed&&t.onClosed(n.detail),this.modalElement.removeEventListener("wallet-selected",e,!1),this.modalElement.removeEventListener("modal-closed",s,!1),document.body.removeChild(this.modalElement),this.modalElement=void 0};this.modalElement.addEventListener("modal-closed",s,!1)}}const Se="albedo";class He{constructor(){this.moduleType=y.HOT_WALLET,this.productId=Se,this.productName="Albedo",this.productUrl="https://albedo.link/",this.productIcon="https://stellar.creit.tech/wallet-icons/albedo.png"}async isAvailable(){return!0}async getAddress(){return M.publicKey({}).then(t=>({address:t.pubkey})).catch(t=>{throw a(t)})}async signTransaction(t,e){return M.tx({xdr:t,pubkey:e==null?void 0:e.address,network:e!=null&&e.networkPassphrase?e.networkPassphrase===v.PUBLIC?"public":"testnet":void 0}).then(({signed_envelope_xdr:s})=>({signedTxXdr:s,signerAddress:e==null?void 0:e.address})).catch(s=>{throw a(s)})}async signAuthEntry(){throw{code:-3,message:'Albedo does not support the "signAuthEntry" function'}}async signMessage(){throw{code:-3,message:'Albedo does not support the "signMessage" function'}}async getNetwork(){throw{code:-3,message:'Albedo does not support the "getNetwork" function'}}}const Re="freighter";class De{constructor(){this.moduleType=y.HOT_WALLET,this.productId=Re,this.productName="Freighter",this.productUrl="https://freighter.app",this.productIcon="https://stellar.creit.tech/wallet-icons/freighter.png"}async runChecks(){if(!await this.isAvailable())throw new Error("Freighter is not connected")}async isAvailable(){return g.isConnected().then(({isConnected:t,error:e})=>!e&&t).catch(()=>!1)}async getAddress(){return this.runChecks().then(()=>g.requestAccess()).then(()=>g.getAddress()).then(({address:t,error:e})=>{if(e)throw e;return{address:t}}).catch(t=>{throw a(t)})}async signTransaction(t,e){return this.runChecks().then(async()=>{const{signedTxXdr:s,signerAddress:n,error:i}=await g.signTransaction(t,{address:e==null?void 0:e.address,networkPassphrase:e==null?void 0:e.networkPassphrase});if(i)throw i;return{signedTxXdr:s,signerAddress:n}}).catch(s=>{throw a(s)})}async signAuthEntry(t,e){return this.runChecks().then(async()=>{const{signedAuthEntry:s,signerAddress:n,error:i}=await g.signAuthEntry(t,{address:e==null?void 0:e.address,networkPassphrase:e==null?void 0:e.networkPassphrase});if(i||!s)throw i;return{signedAuthEntry:N.Buffer.from(s).toString("base64"),signerAddress:n}}).catch(s=>{throw a(s)})}async signMessage(t,e){return this.runChecks().then(async()=>{const{signedMessage:s,signerAddress:n,error:i}=await g.signMessage(t,{address:e==null?void 0:e.address,networkPassphrase:e==null?void 0:e.networkPassphrase});if(i||!s)throw i;return{signedMessage:N.Buffer.from(s).toString("base64"),signerAddress:n}}).catch(s=>{throw a(s)})}async getNetwork(){return this.runChecks().then(async()=>{const{network:t,networkPassphrase:e,error:s}=await g.getNetwork();if(s)throw s;return{network:t,networkPassphrase:e}}).catch(t=>{throw a(t)})}}const Me="lobstr";class Xe{constructor(){this.moduleType=y.HOT_WALLET,this.productId=Me,this.productName="LOBSTR",this.productUrl="https://lobstr.co",this.productIcon="https://stellar.creit.tech/wallet-icons/lobstr.png"}async isAvailable(){return m.isConnected()}async getAddress(){return(async()=>{if(!await m.isConnected())throw new Error("Lobstr is not connected")})().then(()=>m.getPublicKey()).then(e=>({address:e})).catch(e=>{throw a(e)})}async signTransaction(t,e){return(async()=>{if(!await m.isConnected())throw new Error("Lobstr is not connected");e!=null&&e.address&&console.warn("Lobstr doesn't allow specifying what public key should sign the transaction, we skip the value"),e!=null&&e.networkPassphrase&&console.warn("Lobstr doesn't allow specifying the network that should be used, we skip the value")})().then(()=>m.signTransaction(t)).then(n=>({signedTxXdr:n})).catch(n=>{throw a(n)})}async signAuthEntry(){throw{code:-3,message:'Lobstr does not support the "signAuthEntry" function'}}async signMessage(){throw{code:-3,message:'Lobstr does not support the "signMessage" function'}}async getNetwork(){throw{code:-3,message:'Lobstr does not support the "getNetwork" function'}}}const Ne="rabet";class qe{constructor(){this.moduleType=y.HOT_WALLET,this.productId=Ne,this.productName="Rabet",this.productUrl="https://rabet.io/",this.productIcon="https://stellar.creit.tech/wallet-icons/rabet.png"}isAvailable(){return new Promise(t=>{setTimeout(()=>{t(typeof window<"u"&&!!window.rabet)},100)})}async getAddress(){return(async()=>{if(!await this.isAvailable())throw new Error("Rabet is not installed")})().then(()=>window.rabet.connect()).then(({publicKey:e})=>({address:e})).catch(e=>{throw a(e)})}async signTransaction(t,e){const s=async()=>{if(!await this.isAvailable())throw new Error("Rabet is not installed");if(e!=null&&e.address&&e.networkPassphrase!==v.PUBLIC&&e.networkPassphrase!==v.TESTNET)throw new Error(`Rabet doesn't support the network: ${e.networkPassphrase}`);e!=null&&e.address&&console.warn("Rabet doesn't allow specifying the network that should be used, we skip the value")},n=async()=>window.rabet.sign(t,(e==null?void 0:e.networkPassphrase)===v.PUBLIC?"mainnet":"testnet");return s().then(n).then(i=>({signedTxXdr:i==null?void 0:i.xdr})).catch(i=>{throw a(i)})}async signAuthEntry(){throw{code:-3,message:'Rabet does not support the "signAuthEntry" function'}}async signMessage(){throw{code:-3,message:'Rabet does not support the "signMessage" function'}}async getNetwork(){throw{code:-3,message:'Rabet does not support the "getNetwork" function'}}}class K{constructor(){this.isConnected=!1}sendEventToContentScript(t,e,s){return new Promise(n=>{const i=o=>{o.source!==window||!o.data||o.origin!==window.origin||o.data.eventId===s&&(n(o),window.removeEventListener("message",i,!1))};window.addEventListener("message",i,!1),window.webkit.messageHandlers.cordova_iab.postMessage(JSON.stringify({type:t,eventId:s,detail:e}))})}async enableConnection(){const t={origin:window.origin,host:window.location.host,permissions:{canRequestPublicKey:!0,canRequestSign:!0}},e=await this.sendEventToContentScript(u.XBULL_CONNECT,t,crypto.randomUUID()),{detail:s}=e.data;if(!s||s.error)throw{code:(s==null?void 0:s.code)||-1,message:(s==null?void 0:s.errorMessage)||"Unexpected error"};this.isConnected=!0}async getAddress(){try{await this.enableConnection()}catch(n){return{error:{code:(n==null?void 0:n.code)||-1,message:(n==null?void 0:n.message)||"Unexpected error"}}}const t={origin:window.origin,host:window.location.host},e=await this.sendEventToContentScript(u.XBULL_GET_PUBLIC_KEY,t,crypto.randomUUID()),{detail:s}=e.data;return!s||s.error?{error:{code:(s==null?void 0:s.code)||-1,message:(s==null?void 0:s.errorMessage)||"Unexpected error"}}:{address:s.payload}}async signTransaction(t){var i,o,c,b;if((i=t.opts)!=null&&i.submit||(o=t.opts)!=null&&o.submitUrl)return{error:{code:-1,message:"Parameters `submit` and `submitUrl` are not supported"}};try{await this.enableConnection()}catch(l){return{error:{code:(l==null?void 0:l.code)||-1,message:(l==null?void 0:l.message)||"Unexpected error"}}}const e={origin:window.origin,host:window.location.host,network:(c=t.opts)==null?void 0:c.networkPassphrase,publicKey:(b=t.opts)==null?void 0:b.address,xdr:t.xdr,xdrType:"Transaction"},s=await this.sendEventToContentScript(u.XBULL_SIGN_XDR,e,crypto.randomUUID()),{detail:n}=s.data;return!n||n.error?{error:{code:(n==null?void 0:n.code)||-1,message:(n==null?void 0:n.errorMessage)||"Unexpected error"}}:{signedTxXdr:n.payload.signedXdr,signerAddress:n.payload.signerAddress}}async getNetwork(){try{await this.enableConnection()}catch(n){return{error:{code:(n==null?void 0:n.code)||-1,message:(n==null?void 0:n.message)||"Unexpected error"}}}const t={origin:window.origin,host:window.location.host},e=await this.sendEventToContentScript(u.XBULL_GET_NETWORK,t,crypto.randomUUID()),{detail:s}=e.data;return!s||s.error?{error:{code:(s==null?void 0:s.code)||-1,message:(s==null?void 0:s.errorMessage)||"Unexpected error"}}:{network:s.payload.network,networkPassphrase:s.payload.networkPassphrase}}}class H{constructor(t){this.closeCurrentPromises$=new w,this.closeObservables$=new w,this.initialResponse$=new w,this.initialResponseCompleted$=new w,this.connectResponse$=new w,this.connectResult$=new w,this.signResponse$=new w,this.signResult$=new w,this.closeCurrentPromisesSubscription=Ie(1e3,1e3).pipe(h(this.closeObservables$)).subscribe(()=>{var i;(i=this.target)!=null&&i.closed&&this.closeCurrentPromises$.next()}),this.onInititalResponseSubscription=this.initialResponse$.pipe(h(this.closeObservables$)).subscribe(i=>{const o=this.decryptFromReceiver({oneTimeCode:i.data.oneTimeCode,payload:i.data.message,senderPublicKey:i.data.publicKey});JSON.parse(o).providedSession===this.session()&&(this.targetPublicKey=i.data.publicKey,this.initialResponseCompleted$.next())}),this.onConnectResponseSubscription=this.connectResponse$.pipe(h(this.closeObservables$)).subscribe(i=>{if(!this.targetPublicKey)return void this.connectResult$.next({success:!1,message:"Wallet encryption public key is not provided, request rejected."});if(!i.data.success)return void this.connectResult$.next({success:!1,message:"Request rejected from the wallet"});const o=this.decryptFromReceiver({oneTimeCode:i.data.oneTimeCode,payload:i.data.message,senderPublicKey:this.targetPublicKey}),c=JSON.parse(o);this.connectResult$.next({success:!0,publicKey:c.publicKey})}),this.onSignResponseSubscription=this.signResponse$.pipe(h(this.closeObservables$)).subscribe(i=>{if(!this.targetPublicKey)return void this.signResult$.next({success:!1,message:"Wallet encryption public key is not provided, request rejected."});if(!i.data.success)return void this.signResult$.next({success:!1,message:"Request rejected from the wallet"});const o=this.decryptFromReceiver({oneTimeCode:i.data.oneTimeCode,payload:i.data.message,senderPublicKey:this.targetPublicKey}),c=JSON.parse(o);this.signResult$.next({success:!0,xdr:c.xdr})}),this.preferredTarget=(t==null?void 0:t.preferredTarget)||"extension",this.walletUrl=(t==null?void 0:t.url)||"https://wallet.xbull.app/connect";const e=p.box.keyPair(),s=d.encodeBase64(p.randomBytes(24));this.encryptForReceiver=i=>{const o=p.randomBytes(24),c=p.box(d.decodeUTF8(i.data),o,i.receiverPublicKey,e.secretKey);return{message:d.encodeBase64(c),oneTimeCode:d.encodeBase64(o)}},this.decryptFromReceiver=i=>{const o=p.box.open(d.decodeBase64(i.payload),d.decodeBase64(i.oneTimeCode),d.decodeBase64(i.senderPublicKey),e.secretKey);if(!o)throw new Error("Decrypted message is null");return d.encodeUTF8(o)},this.publicKey=()=>e.publicKey,this.session=()=>s.slice();const n=i=>{switch(i.data.type){case u.XBULL_INITIAL_RESPONSE:this.initialResponse$.next(i);break;case u.XBULL_CONNECT_RESPONSE:this.connectResponse$.next(i);break;case u.XBULL_SIGN_RESPONSE:this.signResponse$.next(i)}};window.addEventListener("message",n),this.closeObservables$.asObservable().pipe(C(1)).subscribe(()=>{window.removeEventListener("message",n)})}openWallet(){return this.target&&!this.target.closed&&(this.target.close(),this.target=null,this.closeCurrentPromises$.next()),this.target=window.open(`${this.walletUrl}?public=${encodeURIComponent(d.encodeBase64(this.publicKey()))}&session=${encodeURIComponent(this.session())}`,"xBull_Wallet_app","width=380,height=640,left=100,top=100"),P(this.initialResponseCompleted$.pipe(h(this.closeCurrentPromises$)).pipe(h(this.closeObservables$)))}closeWallet(){var t;this.target&&((t=this.target)==null||t.close(),this.target=null)}async connect(t={canRequestPublicKey:!0,canRequestSign:!0}){var s,n;const e=(n=(s=window==null?void 0:window.webkit)==null?void 0:s.messageHandlers)!=null&&n.cordova_iab?new K:window.xBullSDK;if(e&&this.preferredTarget==="extension"){const i=await e.getAddress();if(U(i))throw i.error;return i.address}{if(await this.openWallet(),!this.target||!this.targetPublicKey)throw new Error("xBull Wallet is not open, we can't connect with it");const{message:i,oneTimeCode:o}=this.encryptForReceiver({data:JSON.stringify(t),receiverPublicKey:d.decodeBase64(this.targetPublicKey)}),c={type:u.XBULL_CONNECT,message:i,oneTimeCode:o};this.target.postMessage(c,"*");const b=this.connectResult$.asObservable().pipe(W(l=>l.success?(this.closeWallet(),O(l.publicKey)):(this.closeWallet(),_(()=>new Error(l.message))))).pipe(C(1)).pipe(h(this.closeCurrentPromises$)).pipe(h(this.closeObservables$));return P(b)}}async sign(t){var s,n;const e=(n=(s=window==null?void 0:window.webkit)==null?void 0:s.messageHandlers)!=null&&n.cordova_iab?new K:window.xBullSDK;if(e&&this.preferredTarget==="extension"){const i=await e.signTransaction({xdr:t.xdr,opts:{networkPassphrase:t.network,address:t.publicKey}});if(U(i))throw i.error;return i.signedTxXdr}{if(await this.openWallet(),!this.target||!this.targetPublicKey)throw new Error("xBull Wallet is not open, we can't connect with it");if(typeof t.xdr!="string")throw new Error("XDR provided needs to be a string value");const{message:i,oneTimeCode:o}=this.encryptForReceiver({data:JSON.stringify(t),receiverPublicKey:d.decodeBase64(this.targetPublicKey)}),c={type:u.XBULL_SIGN,message:i,oneTimeCode:o};this.target.postMessage(c,"*");const b=this.signResult$.asObservable().pipe(W(l=>l.success?(this.closeWallet(),O(l.xdr)):(this.closeWallet(),_(()=>new Error(l.message))))).pipe(C(1)).pipe(h(this.closeCurrentPromises$)).pipe(h(this.closeObservables$));return P(b)}}closeConnections(){this.closeObservables$.next(),this.closeCurrentPromises$.next(),this.closeObservables$.complete(),this.closeCurrentPromises$.complete()}}const Ue="xbull";class Fe{constructor(){this.moduleType=y.HOT_WALLET,this.productId=Ue,this.productName="xBull",this.productUrl="https://xbull.app",this.productIcon="https://stellar.creit.tech/wallet-icons/xbull.png"}async isAvailable(){return!0}async getAddress(){try{const t=new H,e=await t.connect();return t.closeConnections(),{address:e}}catch(t){throw a(t)}}async signTransaction(t,e){try{const s=new H,n=await s.sign({xdr:t,publicKey:e==null?void 0:e.address,network:e==null?void 0:e.networkPassphrase});return s.closeConnections(),{signedTxXdr:n,signerAddress:e==null?void 0:e.address}}catch(s){throw a(s)}}async signAuthEntry(){throw{code:-3,message:'xBull does not support the "signAuthEntry" function'}}async signMessage(){throw{code:-3,message:'xBull does not support the "signMessage" function'}}async getNetwork(){throw{code:-3,message:'xBull does not support the "getNetwork" function'}}}const We="hot-wallet";class Ge{constructor(){this.moduleType=y.HOT_WALLET,this.productId=We,this.productName="HOT Wallet",this.productUrl="https://hot-labs.org/wallet",this.productIcon="https://storage.herewallet.app/logo.png"}async isAvailable(){return!0}async getAddress(){return await k.HOT.request("stellar:getAddress",{})}async signTransaction(t,e){return await k.HOT.request("stellar:signTransaction",{xdr:t,accountToSign:e==null?void 0:e.address})}async signAuthEntry(t,e){return await k.HOT.request("stellar:signAuthEntry",{authEntry:t,accountToSign:e==null?void 0:e.address})}async signMessage(t,e){return await k.HOT.request("stellar:signMessage",{message:t,accountToSign:e==null?void 0:e.address})}async getNetwork(){return{network:"mainnet",networkPassphrase:v.PUBLIC}}}const Be="hana";class Ve{constructor(){this.moduleType=y.HOT_WALLET,this.productId=Be,this.productName="Hana Wallet",this.productUrl="https://hanawallet.io/",this.productIcon="https://stellar.creit.tech/wallet-icons/hana.png"}async runChecks(){if(!await this.isAvailable())throw new Error("Hana Wallet is not installed")}isAvailable(){return new Promise(t=>{var e;return t(typeof window<"u"&&!!((e=window.hanaWallet)!=null&&e.stellar))})}async getAddress(){return this.runChecks().then(()=>window.hanaWallet.stellar.getPublicKey()).then(t=>({address:t})).catch(t=>{throw a(t)})}async signTransaction(t,e){return this.runChecks().then(()=>window.hanaWallet.stellar.signTransaction({xdr:t,accountToSign:e==null?void 0:e.address,networkPassphrase:e==null?void 0:e.networkPassphrase})).then(s=>({signedTxXdr:s,signerAddress:e==null?void 0:e.address})).catch(s=>{throw a(s)})}async signAuthEntry(t,e){return this.runChecks().then(()=>window.hanaWallet.stellar.signAuthEntry({xdr:t,accountToSign:e==null?void 0:e.address})).then(s=>({signedAuthEntry:s,signerAddress:e==null?void 0:e.address})).catch(s=>{throw a(s)})}async signMessage(t,e){return this.runChecks().then(()=>window.hanaWallet.stellar.signMessage({message:t,accountToSign:e==null?void 0:e.address})).then(s=>({signedMessage:s,signerAddress:e==null?void 0:e.address})).catch(s=>{throw a(s)})}async getNetwork(){throw{code:-3,message:'Hana does not support the "getNetwork" function'}}}export{Se as ALBEDO_ID,He as AlbedoModule,Re as FREIGHTER_ID,De as FreighterModule,Be as HANA_ID,We as HOTWALLET_ID,Ve as HanaModule,Ge as HotWalletModule,Me as LOBSTR_ID,Xe as LobstrModule,y as ModuleType,Ne as RABET_ID,qe as RabetModule,ze as StellarSelectorModal,Ye as StellarWalletsButton,Ke as StellarWalletsKit,Qe as StellarWalletsModal,v as WalletNetwork,Ue as XBULL_ID,a as parseError,Fe as xBullModule};
