import{b as ce,a as G,w as de,C as ue,s as _e,R as me,e as J,c as pe,d as be,_ as ve}from"./zpHdnZTQ.js";import{u as ne,a as Q,c as ee,t as ae,s as z,e as fe,f as te,_ as he,g as ye,b as Z,h as X,d as Be,i as ge,j as we,k as ke}from"./Bvh3q8QW.js";import{d as oe,s as $e,c,r as L,g as se,v as Ce,w as K,x as Ve,h as H,o as b,l as u,e as o,b as w,u as s,i as Y,f as C,t as m,a as j,F as E,y as le,q as Ne,j as re,z as je,n as xe,C as Me,_ as Te}from"./CobzMJ77.js";import{a as Se}from"./Cv2CDYPi.js";const Ue={class:"account-dialog__title"},Ae=["src","alt"],De={class:"account-dialog__body"},Fe={class:"account-info-table"},Ie={class:"account-dialog-action"},Le=oe({__name:"RepayDialog",props:$e({data:{},modelValue:{type:Boolean}},{modelValue:{default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const V=ne(),N=Q(),x=ce(),I=c(()=>x.publicKey),W=G(),P=c(()=>W.jLendClient),U=ee(),A=c(()=>U.userTotalDepositInUsd),y=c(()=>U.userTotalBorrowedInUsd),v=L(!1),B=L(!1),k=se(N,"repayAmount"),R=L(0),_=c(()=>t.data?t.data.asset.symbol==="XLM"?x.nativeBalance:x.getAssetBalance(String(t.data.asset_issuer)):0),n=c(()=>{var r,p,g;return(g=(p=(r=t.data)==null?void 0:r.raw)==null?void 0:p.config)!=null&&g.close_ltv_bps?Number(t.data.raw.config.close_ltv_bps)/1e4:0}),S=c(()=>{var a,d;const r=Number(k.value||0)*Number(((d=(a=t.data)==null?void 0:a.raw)==null?void 0:d.pool_price)||0),p=A.value*n.value,g=Math.max(y.value-r,0),e=Math.max(p/g,0);return Math.min(e,10)});de([()=>t.data,B,I],async([r,p])=>{var e;if(!r||!I.value)return;const g=await((e=P.value)==null?void 0:e.sdk.repayTx(I.value,(r==null?void 0:r.pool_address)||"",0));R.value=P.value.sdk.getTransactionFee(g)},{immediate:!0,debounce:300});const M=c(()=>{var p;if(!t.data)return[];const r=Math.max(Number((p=t.data)==null?void 0:p.debt)-k.value||0,0);return[{name:"healthFactor",label:"Health Factor",value:ae(S.value,2)},{label:"Borrow balance after repay",value:`${z(r)} ${t.data.asset.symbol}`},{label:"Transaction Fee",value:`${R.value} XLM`}]}),T=Ce(t,"modelValue");async function f(){var r,p,g;if(t.data){if(!k.value||k.value<=0){ye(".repay-dialog__input");return}try{v.value=!0,V.poolDepositAddr=(r=t.data)==null?void 0:r.pool_address,await N.repay((p=t.data)==null?void 0:p.pool_address,k.value,_.value,(g=t.data)==null?void 0:g.asset.symbol)}finally{v.value=!1}}}let $;return K(()=>t.modelValue,async r=>{if(clearInterval($),!r){setTimeout(()=>{k.value=0},ue);return}$=_e(()=>{B.value=!0,Ve(()=>{B.value=!1})},me)}),(r,p)=>{const g=fe,e=te,a=J,d=he;return b(),H(d,{modelValue:T.value,"onUpdate:modelValue":p[1]||(p[1]=h=>T.value=h),"class-name":"account-dialog"},{header:u(()=>{var h,l,D;return[o("div",Ue,[o("img",{src:(h=r.data)==null?void 0:h.asset.icon,alt:`${(l=r.data)==null?void 0:l.asset.symbol} icon`},null,8,Ae),o("span",null,"Repay "+m((D=r.data)==null?void 0:D.asset.symbol),1)])]}),default:u(()=>{var h;return[o("div",De,[w(g,{modelValue:s(k),"onUpdate:modelValue":p[0]||(p[0]=l=>Y(k)?k.value=l:null),class:"repay-dialog__input",balance:s(_),limit:Number((h=r.data)==null?void 0:h.debt)||0,rules:[l=>l&&Number(l)<s(_)||"Insufficient balance"]},{"label-right":u(()=>{var l;return[C(" Repay with Wallet: "+m(s(_))+" "+m((l=r.data)==null?void 0:l.asset.symbol),1)]}),_:1},8,["modelValue","balance","limit","rules"]),o("div",Fe,[(b(!0),j(E,null,le(s(M),l=>(b(),j("div",{key:l.label,class:"account-info-table__item"},[o("span",null,m(l==null?void 0:l.label),1),o("span",null,[(l==null?void 0:l.name)==="healthFactor"&&s(v)?(b(),H(e,{key:0,width:"14px",style:{padding:"0",width:"14px","margin-left":"auto"}})):(b(),j(E,{key:1},[C(m(l==null?void 0:l.value),1)],64))])]))),128))]),o("div",Ie,[w(a,{loading:s(v),variant:"success",size:"md",pill:"",onClick:f},{default:u(()=>{var l;return[C(" Repay "+m((l=r.data)==null?void 0:l.asset.symbol),1)]}),_:1},8,["loading"])])])]}),_:1},8,["modelValue"])}}}),He={width:"30",height:"30",viewBox:"0 0 30 30",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Re(t,V){return b(),j("svg",He,V[0]||(V[0]=[o("path",{d:"M11.2231 2.5H18.7231C24.9731 2.5 27.4731 5 27.4731 11.25V18.75C27.4731 25 24.9731 27.5 18.7231 27.5H11.2231C4.97314 27.5 2.47314 25 2.47314 18.75V11.25C2.47314 5 4.97314 2.5 11.2231 2.5Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),o("path",{d:"M10.7126 19.0875L18.8876 10.9125",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),o("path",{d:"M11.225 12.9625C12.0742 12.9625 12.7625 12.2742 12.7625 11.425C12.7625 10.5759 12.0742 9.8875 11.225 9.8875C10.3759 9.8875 9.6875 10.5759 9.6875 11.425C9.6875 12.2742 10.3759 12.9625 11.225 12.9625Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),o("path",{d:"M19.4 20.1125C20.2492 20.1125 20.9375 19.4241 20.9375 18.575C20.9375 17.7258 20.2492 17.0375 19.4 17.0375C18.5509 17.0375 17.8625 17.7258 17.8625 18.575C17.8625 19.4241 18.5509 20.1125 19.4 20.1125Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}const We=Ne({name:"app-percentage-square-icon",render:Re}),Pe={class:"account-card"},ze={key:1,class:"table-wrapper"},Ee={class:"market-table__asset"},Oe=["src"],Ze={class:"market-table__asset__info"},Ke={class:"market-table__asset__info__name"},Ye={class:"market-table__asset__info__symbol"},qe={class:"table-cell justify-content-center"},Xe={class:"table-cell justify-content-center"},Ge={key:1,class:"no-data"},Je=oe({__name:"AccountCardBorrows",setup(t){const V=G(),N=c(()=>V.assetDecimals),x=ee(),I=c(()=>x.userObligation),W=ne(),P=c(()=>W.state.pools),U=Q(),A=[{key:"asset",label:"Asset",align:"left"},{key:"debt",label:"Debt",align:"right"},{key:"borrow_apy",label:"Borrow APY",align:"center"},{key:"action",label:""}],y=c(()=>{var n;return(((n=I.value)==null?void 0:n.borrows)||[]).map(S=>{const[M,T]=S,f=P.value.find(h=>h.pool_address===M);if(!f)return{asset:{name:"Unknown",symbol:"Unknown",icon:""},balance:"0",supply_apy:"0%",action:"Repay"};const $=f.token_ticker,r=be($),p=pe($),g=Z(T.borrowed+T.unpaid_interest,N.value),e=X(Number(g)*Number(f.pool_price),2,2),[,a]=Be(f.name),d=f.pool_apy.borrow_bps/100;return{raw:f,asset:{name:r,symbol:$,icon:p},debt:g,debtUsd:e,borrow_apy:`${ae(d||0,2)}%`,action:"Repay",pool_address:M,asset_issuer:a}})}),v=L(!1),B=L(),k=c(()=>y.value.find(_=>_.pool_address===B.value));function R(_){var n;B.value=(n=_.item)==null?void 0:n.pool_address,v.value=!0}return K(k,_=>{_||(v.value=!1)}),(_,n)=>{const S=ge,M=ke,T=we,f=J,$=ve,r=We,p=te,g=Le;return b(),j(E,null,[o("div",Pe,[n[3]||(n[3]=o("div",{class:"account-card__title"}," Your Borrows ",-1)),s(y).length===0&&s(x).loading?(b(),j(E,{key:0},[w(S,{height:"36","full-width":""}),w(S,{height:"80","full-width":"",style:{"margin-top":"-8px"}})],64)):(b(),j("div",ze,[s(y).length>0?(b(),H($,{key:0,borderless:"",fields:A,items:s(y),responsive:"",class:"account-card__table market-table"},je({"cell(asset)":u(e=>[o("div",Ee,[o("img",{src:e.item.asset.icon,alt:""},null,8,Oe),o("div",Ze,[o("div",Ke,m(e.item.asset.symbol),1),o("div",Ye,m(e.item.asset.name),1)])])]),"cell(debt)":u(e=>[w(M,{"tooltip-class":"table-cell table-cell__dept justify-content-end with-price"},{content:u(()=>[C(m(s(X)(e.item.debt)),1)]),default:u(()=>[C(m(Number(e.item.debt)>1e3?s(z)(Number(e.item.debt)):Number(e.item.debt).toFixed(5))+" ",1),o("span",null,"$"+m(e.item.debtUsd),1)]),_:2},1024)]),"cell(borrow_apy)":u(e=>[o("div",qe,[w(T,{color:"#111","bg-color":"#e49c0b80",size:"md"},{default:u(()=>[C(m(e.item.borrow_apy),1)]),_:2},1024)])]),"cell(action)":u(e=>[o("div",Xe,[w(f,{pill:"",variant:"success","icon-right":"",size:"lg",class:"repay-btn",disabled:s(U).isDisabled(e.item.pool_address,"repay"),loading:s(U).isLoading(e.item.pool_address,"repay"),onClick:a=>R(e)},{default:u(()=>[C(m(e.item.action),1)]),_:2},1032,["disabled","loading","onClick"])])]),_:2},[le(A,e=>({name:`head(${e.key})`,fn:u(a=>[o("span",{style:xe({"--align":e.align})},m(a.label),5)])}))]),1032,["items"])):(b(),j("div",Ge,[w(r),n[1]||(n[1]=C(" no borrowed assets "))])),s(x).loading?(b(),H(p,{key:2},{default:u(()=>n[2]||(n[2]=[C(" Loading... ")])),_:1,__:[2]})):re("",!0)]))]),w(g,{modelValue:s(v),"onUpdate:modelValue":n[0]||(n[0]=e=>Y(v)?v.value=e:null),data:s(k)},null,8,["modelValue","data"])],64)}}}),Qe={class:"account-dialog__title"},ea=["src","alt"],aa={class:"account-dialog__body"},ta={class:"account-info-table"},oa={class:"account-dialog-action"},la=oe({__name:"WithdrawDialog",props:$e({data:{},modelValue:{type:Boolean}},{modelValue:{default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const V=G(),N=c(()=>V.jLendClient),x=ee(),I=c(()=>x.userTotalDepositInUsd),W=c(()=>x.userTotalBorrowedInUsd),P=ce(),U=c(()=>P.publicKey),A=Q(),y=se(A,"withdrawAmount"),v=se(A,"collateralOnly"),B=L(!1),k=L(!1),R=L(0),_=c(()=>{var a;return Number((a=t.data)==null?void 0:a.collateral)||0}),n=c(()=>{var a;return Number(((a=t.data)==null?void 0:a.balance)||0)-_.value}),S=c(()=>{var a;return Number((a=t.data)==null?void 0:a.balance)||0}),M=c(()=>Number(v.value?_.value:n.value)-y.value),T=c(()=>{var a;return(a=t.data)!=null&&a.raw.config.close_ltv_bps?Number(t.data.raw.config.close_ltv_bps)/1e4:0}),f=c(()=>{var F;const a=Number(((F=t.data)==null?void 0:F.price)||0),d=Number(y.value||0)*a,h=Math.max(I.value-d,0),l=W.value,D=l===0?10:Math.max(h*T.value/l,0);return Math.min(D,10)}),$=c(()=>{var i;const a=Number(((i=t.data)==null?void 0:i.price)||1),d=I.value,l=W.value/T.value;let F=Math.max(d-l,0)/a;const O=v.value?_.value:n.value;return F=Math.min(O,F),Math.max(F,0)});de([()=>t.data,k,U],async([a,d])=>{var l;if(!a||!U.value)return;const h=await((l=N.value)==null?void 0:l.sdk.withdrawTx(U.value,(a==null?void 0:a.pool_address)||"",0));R.value=N.value.sdk.getTransactionFee(h)},{immediate:!0,debounce:300});const r=c(()=>{var a,d,h,l,D;return t.data?[{name:"healthFactor",label:"Health Factor",value:ae(f.value||0,2)},{label:"Total supply",value:`${z(S.value||0)} ${(a=t.data)==null?void 0:a.asset.symbol}`},{label:"Deposited balance",value:`${z(n.value||0)} ${(d=t.data)==null?void 0:d.asset.symbol}`},{label:"Collateral balance",value:`${z(_.value||0)} ${(h=t.data)==null?void 0:h.asset.symbol}`},{label:"Remaining supply",value:`${z(Math.max(M.value||0,0))} ${(l=t.data)==null?void 0:l.asset.symbol}`},{label:"Available to withdraw",value:`${z($.value||0)} ${(D=t.data)==null?void 0:D.asset.symbol}`},{label:"Transaction Fee",value:`${R.value||0} XLM`}]:[]}),p=Ce(t,"modelValue");async function g(){var a,d,h,l;if(t.data){if(!y.value||y.value<=0){ye(".withdraw-dialog__input");return}try{B.value=!0,v.value?await A.removeCollateral((a=t.data)==null?void 0:a.pool_address,y.value,_.value,(d=t.data)==null?void 0:d.asset.symbol):await A.withdraw((h=t.data)==null?void 0:h.pool_address,y.value,n.value,(l=t.data)==null?void 0:l.asset.symbol)}finally{B.value=!1}}}let e;return K(()=>t.modelValue,async a=>{if(clearInterval(e),!a){setTimeout(()=>{y.value=0},ue),v.value=!1;return}e=_e(()=>{k.value=!0,Ve(()=>{k.value=!1})},me)}),K(_,a=>{a<=0&&(v.value=!1)},{immediate:!0}),(a,d)=>{const h=fe,l=te,D=Se,F=J,O=he;return b(),H(O,{modelValue:p.value,"onUpdate:modelValue":d[2]||(d[2]=i=>p.value=i),"class-name":"account-dialog"},{header:u(()=>{var i,q,ie;return[o("div",Qe,[o("img",{src:(i=a.data)==null?void 0:i.asset.icon,alt:`${(q=a.data)==null?void 0:q.asset.symbol} icon`},null,8,ea),o("span",null,"Withdraw "+m((ie=a.data)==null?void 0:ie.asset.symbol),1)])]}),default:u(()=>[o("div",aa,[w(h,{modelValue:s(y),"onUpdate:modelValue":d[0]||(d[0]=i=>Y(y)?y.value=i:null),balance:s($),class:"withdraw-dialog__input",rules:[i=>i&&Number(i)<=s($)||"Withdraw limit exceeded"]},{"label-right":u(()=>{var i;return[C(" Amount: "+m(s($).toFixed(5))+" "+m((i=a.data)==null?void 0:i.asset.symbol),1)]}),_:1},8,["modelValue","balance","rules"]),o("div",ta,[(b(!0),j(E,null,le(s(r),i=>(b(),j("div",{key:i.label,class:"account-info-table__item"},[o("span",null,m(i==null?void 0:i.label),1),o("span",null,[(i==null?void 0:i.name)==="healthFactor"&&s(B)?(b(),H(l,{key:0,width:"14px",style:{padding:"0",width:"14px","margin-left":"auto"}})):(b(),j(E,{key:1},[C(m(i==null?void 0:i.value),1)],64))])]))),128))]),s(_)>0?(b(),H(D,{key:0,modelValue:s(v),"onUpdate:modelValue":d[1]||(d[1]=i=>Y(v)?v.value=i:null)},{append:u(()=>d[3]||(d[3]=[C(" Collateral Balance ")])),_:1},8,["modelValue"])):re("",!0),o("div",oa,[w(F,{loading:s(B),variant:"dark",size:"md",pill:"",onClick:g},{default:u(()=>{var i;return[C(" Withdraw "+m((i=a.data)==null?void 0:i.asset.symbol),1)]}),_:1},8,["loading"])])])]),_:1},8,["modelValue"])}}}),sa={width:"30",height:"30",viewBox:"0 0 30 30",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function na(t,V){return b(),j("svg",sa,V[0]||(V[0]=[Me('<path d="M11.2499 27.5H18.7499C24.9999 27.5 27.4999 25 27.4999 18.75V11.25C27.4999 5 24.9999 2.5 18.7499 2.5H11.2499C4.99988 2.5 2.49988 5 2.49988 11.25V18.75C2.49988 25 4.99988 27.5 11.2499 27.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M9.99988 23.75H19.9999C22.4999 23.75 23.7499 22.5 23.7499 20V10C23.7499 7.5 22.4999 6.25 19.9999 6.25H9.99988C7.49988 6.25 6.24988 7.5 6.24988 10V20C6.24988 22.5 7.49988 23.75 9.99988 23.75Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M6.24988 11.875H9.34987C11.0749 11.875 12.4749 13.275 12.4749 15C12.4749 16.725 11.0749 18.125 9.34987 18.125H6.24988" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M23.7499 12.4875H19.9999" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M23.7499 17.5H19.9999" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M9.00012 15H9.12512" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path>',6)]))}const ra=Ne({name:"app-strongbox-icon",render:na}),ia={class:"account-card"},ca={key:1,class:"table-wrapper"},da={class:"market-table__asset"},ua=["src"],_a={class:"market-table__asset__info"},ma={class:"market-table__asset__info__name"},pa={class:"market-table__asset__info__symbol"},ba={class:"table-cell justify-content-center"},va={class:"table-cell justify-content-center"},fa={key:1,class:"no-data"},ha=oe({__name:"AccountCardSupplies",setup(t){const V=G(),N=c(()=>V.assetDecimals),x=ee(),I=c(()=>x.userObligation),W=ne(),P=c(()=>W.state.pools),U=Q(),A=[{key:"asset",label:"Asset",align:"left"},{key:"balance",label:"Balance",align:"right"},{key:"supply_apy",label:"Supply APY",align:"center"},{key:"action",label:""}],y=c(()=>{var n;return(((n=I.value)==null?void 0:n.deposits)||[]).map(S=>{const[M,T]=S,f=P.value.find(q=>q.pool_address===M);if(!f)return{asset:{name:"Unknown",symbol:"Unknown",icon:""},balance:"0",supply_apy:"0%",action:"Withdraw",pool_address:M};const $=f.token_ticker,r=be($),p=pe($),g=Z(T.shares,N.value),e=Z(f.total_shares,N.value),a=Number(g)/Number(e),d=Number(Z(f.available,N.value)),h=Number(Z(f.total_borrowed,N.value)),D=(d+h)*a,F=Z(T.collateral,N.value),O=Number(D)+Number(F),i=f.pool_apy.supply_bps/100;return{raw:f,asset:{name:r,symbol:$,icon:p},balance:O,balanceUsd:X(O*Number(f.pool_price),2,2),price:Number(f.pool_price),available:d,supply_apy:`${ae(i||0,2)}%`,action:"Withdraw",pool_address:M,collateral:F}})}),v=L(!1),B=L(),k=c(()=>y.value.find(_=>_.pool_address===B.value));function R(_){var n;B.value=(n=_.item)==null?void 0:n.pool_address,v.value=!0}return K(k,_=>{_||(v.value=!1)}),(_,n)=>{const S=ge,M=ke,T=we,f=J,$=ve,r=ra,p=te,g=la;return b(),j(E,null,[o("div",ia,[n[3]||(n[3]=o("div",{class:"account-card__title"}," Your Supplies ",-1)),s(y).length===0&&s(x).loading?(b(),j(E,{key:0},[w(S,{height:"36","full-width":""}),w(S,{height:"80","full-width":"",style:{"margin-top":"-8px"}})],64)):(b(),j("div",ca,[s(y).length>0?(b(),H($,{key:0,borderless:"",fields:A,items:s(y),responsive:"",class:"account-card__table market-table"},je({"cell(asset)":u(e=>[o("div",da,[o("img",{src:e.item.asset.icon,alt:""},null,8,ua),o("div",_a,[o("div",ma,m(e.item.asset.symbol),1),o("div",pa,m(e.item.asset.name),1)])])]),"cell(balance)":u(e=>[w(M,{"tooltip-class":"table-cell justify-content-end with-price"},{content:u(()=>[C(m(s(X)(e.item.balance)),1)]),default:u(()=>[C(m(Number(e.item.balance)>1e3?s(z)(Number(e.item.balance)):Number(e.item.balance).toFixed(5))+" ",1),o("span",null,"$"+m(e.item.balanceUsd),1)]),_:2},1024)]),"cell(supply_apy)":u(e=>[o("div",ba,[w(T,{color:"#111","bg-color":"#08b57680",size:"md"},{default:u(()=>[C(m(e.item.supply_apy),1)]),_:2},1024)])]),"cell(action)":u(e=>[o("div",va,[w(f,{pill:"",variant:"dark",size:"lg",disabled:s(U).isDisabled(e.item.pool_address,"withdraw"),loading:s(U).isLoading(e.item.pool_address,"withdraw"),onClick:a=>R(e)},{default:u(()=>[C(m(e.item.action),1)]),_:2},1032,["disabled","loading","onClick"])])]),_:2},[le(A,e=>({name:`head(${e.key})`,fn:u(a=>[o("span",{style:xe({"--align":e.align})},m(a.label),5)])}))]),1032,["items"])):(b(),j("div",fa,[w(r),n[1]||(n[1]=C(" no supplied assets "))])),s(x).loading?(b(),H(p,{key:2},{default:u(()=>n[2]||(n[2]=[C(" Loading... ")])),_:1,__:[2]})):re("",!0)]))]),w(g,{modelValue:s(v),"onUpdate:modelValue":n[0]||(n[0]=e=>Y(v)?v.value=e:null),data:s(k)},null,8,["modelValue","data"])],64)}}}),ya={},ga={class:"account-page container"},wa={class:"account-cards card"};function ka(t,V){const N=ha,x=Je;return b(),j("main",ga,[o("div",wa,[w(N),V[0]||(V[0]=o("div",{class:"separator-vert"},null,-1)),w(x)])])}const $a=Te(ya,[["render",ka]]),Ca={};function Va(t,V){const N=$a;return b(),H(N)}const Ba=Te(Ca,[["render",Va]]);export{Ba as default};
