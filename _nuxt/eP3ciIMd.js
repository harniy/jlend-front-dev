const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./bwa-R7GR.js","./_bNdCwc-.js","./CFNTmiT0.js","./entry.ISNw3uRF.css","./connection.qHwc-Rnt.css","./EEsBwWkj.js"])))=>i.map(i=>d[i]);
import{aT as Pl,aU as Ai,aV as ni,aN as Xn,aO as gt}from"./CFNTmiT0.js";import{ae as Tl,af as $l,X as Ul,Z as js}from"./_bNdCwc-.js";import{p as qs}from"./EEsBwWkj.js";const Fl=Symbol(),zs=Object.getPrototypeOf,Pn=new WeakMap,Ll=e=>e&&(Pn.has(e)?Pn.get(e):zs(e)===Object.prototype||zs(e)===Array.prototype),Ml=e=>Ll(e)&&e[Fl]||null,Ks=(e,t=!0)=>{Pn.set(e,t)},_i={},zi=e=>typeof e=="object"&&e!==null,Ft=new WeakMap,si=new WeakSet,Bl=(e=Object.is,t=(l,h)=>new Proxy(l,h),r=l=>zi(l)&&!si.has(l)&&(Array.isArray(l)||!(Symbol.iterator in l))&&!(l instanceof WeakMap)&&!(l instanceof WeakSet)&&!(l instanceof Error)&&!(l instanceof Number)&&!(l instanceof Date)&&!(l instanceof String)&&!(l instanceof RegExp)&&!(l instanceof ArrayBuffer),i=l=>{switch(l.status){case"fulfilled":return l.value;case"rejected":throw l.reason;default:throw l}},n=new WeakMap,s=(l,h,p=i)=>{const w=n.get(l);if(w?.[0]===h)return w[1];const v=Array.isArray(l)?[]:Object.create(Object.getPrototypeOf(l));return Ks(v,!0),n.set(l,[h,v]),Reflect.ownKeys(l).forEach(E=>{if(Object.getOwnPropertyDescriptor(v,E))return;const O=Reflect.get(l,E),C={value:O,enumerable:!0,configurable:!0};if(si.has(O))Ks(O,!1);else if(O instanceof Promise)delete C.value,C.get=()=>p(O);else if(Ft.has(O)){const[P,_]=Ft.get(O);C.value=s(P,_(),p)}Object.defineProperty(v,E,C)}),Object.preventExtensions(v)},a=new WeakMap,c=[1,1],u=l=>{if(!zi(l))throw new Error("object required");const h=a.get(l);if(h)return h;let p=c[0];const w=new Set,v=(R,A=++c[0])=>{p!==A&&(p=A,w.forEach(N=>N(R,A)))};let E=c[1];const O=(R=++c[1])=>(E!==R&&!w.size&&(E=R,P.forEach(([A])=>{const N=A[1](R);N>p&&(p=N)})),p),C=R=>(A,N)=>{const B=[...A];B[1]=[R,...B[1]],v(B,N)},P=new Map,_=(R,A)=>{if((_i?"production":void 0)!=="production"&&P.has(R))throw new Error("prop listener already exists");if(w.size){const N=A[3](C(R));P.set(R,[A,N])}else P.set(R,[A])},D=R=>{var A;const N=P.get(R);N&&(P.delete(R),(A=N[1])==null||A.call(N))},g=R=>(w.add(R),w.size===1&&P.forEach(([N,B],V)=>{if((_i?"production":void 0)!=="production"&&B)throw new Error("remove already exists");const U=N[3](C(V));P.set(V,[N,U])}),()=>{w.delete(R),w.size===0&&P.forEach(([N,B],V)=>{B&&(B(),P.set(V,[N]))})}),y=Array.isArray(l)?[]:Object.create(Object.getPrototypeOf(l)),o=t(y,{deleteProperty(R,A){const N=Reflect.get(R,A);D(A);const B=Reflect.deleteProperty(R,A);return B&&v(["delete",[A],N]),B},set(R,A,N,B){const V=Reflect.has(R,A),U=Reflect.get(R,A,B);if(V&&(e(U,N)||a.has(N)&&e(U,a.get(N))))return!0;D(A),zi(N)&&(N=Ml(N)||N);let I=N;if(N instanceof Promise)N.then(b=>{N.status="fulfilled",N.value=b,v(["resolve",[A],b])}).catch(b=>{N.status="rejected",N.reason=b,v(["reject",[A],b])});else{!Ft.has(N)&&r(N)&&(I=u(N));const b=!si.has(I)&&Ft.get(I);b&&_(A,b)}return Reflect.set(R,A,I,B),v(["set",[A],N,U]),!0}});a.set(l,o);const d=[y,O,s,g];return Ft.set(o,d),Reflect.ownKeys(l).forEach(R=>{const A=Object.getOwnPropertyDescriptor(l,R);"value"in A&&(o[R]=l[R],delete A.value,delete A.writable),Object.defineProperty(y,R,A)}),o})=>[u,Ft,si,e,t,r,i,n,s,a,c],[jl]=Bl();function Bt(e={}){return jl(e)}function tr(e,t,r){const i=Ft.get(e);(_i?"production":void 0)!=="production"&&!i&&console.warn("Please use proxy object");let n;const s=[],a=i[3];let c=!1;const l=a(h=>{s.push(h),n||(n=Promise.resolve().then(()=>{n=void 0,c&&t(s.splice(0))}))});return c=!0,()=>{c=!1,l()}}function ql(e,t){const r=Ft.get(e);(_i?"production":void 0)!=="production"&&!r&&console.warn("Please use proxy object");const[i,n,s]=r;return s(i,n(),t)}const Ce=Bt({history:["ConnectWallet"],view:"ConnectWallet",data:void 0}),cc={state:Ce,subscribe(e){return tr(Ce,()=>e(Ce))},push(e,t){e!==Ce.view&&(Ce.view=e,t&&(Ce.data=t),Ce.history.push(e))},reset(e){Ce.view=e,Ce.history=[e]},replace(e){Ce.history.length>1&&(Ce.history[Ce.history.length-1]=e,Ce.view=e)},goBack(){if(Ce.history.length>1){Ce.history.pop();const[e]=Ce.history.slice(-1);Ce.view=e}},setData(e){Ce.data=e}},je={WALLETCONNECT_DEEPLINK_CHOICE:"WALLETCONNECT_DEEPLINK_CHOICE",WCM_VERSION:"WCM_VERSION",RECOMMENDED_WALLET_AMOUNT:9,isMobile(){return typeof window<"u"?!!(window.matchMedia("(pointer:coarse)").matches||/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/u.test(navigator.userAgent)):!1},isAndroid(){return je.isMobile()&&navigator.userAgent.toLowerCase().includes("android")},isIos(){const e=navigator.userAgent.toLowerCase();return je.isMobile()&&(e.includes("iphone")||e.includes("ipad"))},isHttpUrl(e){return e.startsWith("http://")||e.startsWith("https://")},isArray(e){return Array.isArray(e)&&e.length>0},formatNativeUrl(e,t,r){if(je.isHttpUrl(e))return this.formatUniversalUrl(e,t,r);let i=e;i.includes("://")||(i=e.replaceAll("/","").replaceAll(":",""),i=`${i}://`),i.endsWith("/")||(i=`${i}/`),this.setWalletConnectDeepLink(i,r);const n=encodeURIComponent(t);return`${i}wc?uri=${n}`},formatUniversalUrl(e,t,r){if(!je.isHttpUrl(e))return this.formatNativeUrl(e,t,r);let i=e;i.endsWith("/")||(i=`${i}/`),this.setWalletConnectDeepLink(i,r);const n=encodeURIComponent(t);return`${i}wc?uri=${n}`},async wait(e){return new Promise(t=>{setTimeout(t,e)})},openHref(e,t){window.open(e,t,"noreferrer noopener")},setWalletConnectDeepLink(e,t){try{localStorage.setItem(je.WALLETCONNECT_DEEPLINK_CHOICE,JSON.stringify({href:e,name:t}))}catch{console.info("Unable to set WalletConnect deep link")}},setWalletConnectAndroidDeepLink(e){try{const[t]=e.split("?");localStorage.setItem(je.WALLETCONNECT_DEEPLINK_CHOICE,JSON.stringify({href:t,name:"Android"}))}catch{console.info("Unable to set WalletConnect android deep link")}},removeWalletConnectDeepLink(){try{localStorage.removeItem(je.WALLETCONNECT_DEEPLINK_CHOICE)}catch{console.info("Unable to remove WalletConnect deep link")}},setModalVersionInStorage(){try{typeof localStorage<"u"&&localStorage.setItem(je.WCM_VERSION,"2.6.2")}catch{console.info("Unable to set Web3Modal version in storage")}},getWalletRouterData(){var e;const t=(e=cc.state.data)==null?void 0:e.Wallet;if(!t)throw new Error('Missing "Wallet" view data');return t}},zl=typeof location<"u"&&(location.hostname.includes("localhost")||location.protocol.includes("https")),Be=Bt({enabled:zl,userSessionId:"",events:[],connectedWalletId:void 0}),Kl={state:Be,subscribe(e){return tr(Be.events,()=>e(ql(Be.events[Be.events.length-1])))},initialize(){Be.enabled&&typeof(crypto==null?void 0:crypto.randomUUID)<"u"&&(Be.userSessionId=crypto.randomUUID())},setConnectedWalletId(e){Be.connectedWalletId=e},click(e){if(Be.enabled){const t={type:"CLICK",name:e.name,userSessionId:Be.userSessionId,timestamp:Date.now(),data:e};Be.events.push(t)}},track(e){if(Be.enabled){const t={type:"TRACK",name:e.name,userSessionId:Be.userSessionId,timestamp:Date.now(),data:e};Be.events.push(t)}},view(e){if(Be.enabled){const t={type:"VIEW",name:e.name,userSessionId:Be.userSessionId,timestamp:Date.now(),data:e};Be.events.push(t)}}},ht=Bt({chains:void 0,walletConnectUri:void 0,isAuth:!1,isCustomDesktop:!1,isCustomMobile:!1,isDataLoaded:!1,isUiLoaded:!1}),ct={state:ht,subscribe(e){return tr(ht,()=>e(ht))},setChains(e){ht.chains=e},setWalletConnectUri(e){ht.walletConnectUri=e},setIsCustomDesktop(e){ht.isCustomDesktop=e},setIsCustomMobile(e){ht.isCustomMobile=e},setIsDataLoaded(e){ht.isDataLoaded=e},setIsUiLoaded(e){ht.isUiLoaded=e},setIsAuth(e){ht.isAuth=e}},oi=Bt({projectId:"",mobileWallets:void 0,desktopWallets:void 0,walletImages:void 0,chains:void 0,enableAuthMode:!1,enableExplorer:!0,explorerExcludedWalletIds:void 0,explorerRecommendedWalletIds:void 0,termsOfServiceUrl:void 0,privacyPolicyUrl:void 0}),gr={state:oi,subscribe(e){return tr(oi,()=>e(oi))},setConfig(e){var t,r;Kl.initialize(),ct.setChains(e.chains),ct.setIsAuth(!!e.enableAuthMode),ct.setIsCustomMobile(!!((t=e.mobileWallets)!=null&&t.length)),ct.setIsCustomDesktop(!!((r=e.desktopWallets)!=null&&r.length)),je.setModalVersionInStorage(),Object.assign(oi,e)}};var Vl=Object.defineProperty,Vs=Object.getOwnPropertySymbols,Hl=Object.prototype.hasOwnProperty,Wl=Object.prototype.propertyIsEnumerable,Hs=(e,t,r)=>t in e?Vl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,kl=(e,t)=>{for(var r in t||(t={}))Hl.call(t,r)&&Hs(e,r,t[r]);if(Vs)for(var r of Vs(t))Wl.call(t,r)&&Hs(e,r,t[r]);return e};const Tn="https://explorer-api.walletconnect.com",$n="wcm",Un="js-2.6.2";async function ai(e,t){const r=kl({sdkType:$n,sdkVersion:Un},t),i=new URL(e,Tn);return i.searchParams.append("projectId",gr.state.projectId),Object.entries(r).forEach(([n,s])=>{s&&i.searchParams.append(n,String(s))}),(await fetch(i)).json()}const kt={async getDesktopListings(e){return ai("/w3m/v1/getDesktopListings",e)},async getMobileListings(e){return ai("/w3m/v1/getMobileListings",e)},async getInjectedListings(e){return ai("/w3m/v1/getInjectedListings",e)},async getAllListings(e){return ai("/w3m/v1/getAllListings",e)},getWalletImageUrl(e){return`${Tn}/w3m/v1/getWalletImage/${e}?projectId=${gr.state.projectId}&sdkType=${$n}&sdkVersion=${Un}`},getAssetImageUrl(e){return`${Tn}/w3m/v1/getAssetImage/${e}?projectId=${gr.state.projectId}&sdkType=${$n}&sdkVersion=${Un}`}};var Gl=Object.defineProperty,Ws=Object.getOwnPropertySymbols,Yl=Object.prototype.hasOwnProperty,Jl=Object.prototype.propertyIsEnumerable,ks=(e,t,r)=>t in e?Gl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ql=(e,t)=>{for(var r in t||(t={}))Yl.call(t,r)&&ks(e,r,t[r]);if(Ws)for(var r of Ws(t))Jl.call(t,r)&&ks(e,r,t[r]);return e};const Gs=je.isMobile(),ft=Bt({wallets:{listings:[],total:0,page:1},search:{listings:[],total:0,page:1},recomendedWallets:[]}),tv={state:ft,async getRecomendedWallets(){const{explorerRecommendedWalletIds:e,explorerExcludedWalletIds:t}=gr.state;if(e==="NONE"||t==="ALL"&&!e)return ft.recomendedWallets;if(je.isArray(e)){const r={recommendedIds:e.join(",")},{listings:i}=await kt.getAllListings(r),n=Object.values(i);n.sort((s,a)=>{const c=e.indexOf(s.id),u=e.indexOf(a.id);return c-u}),ft.recomendedWallets=n}else{const{chains:r,isAuth:i}=ct.state,n=r?.join(","),s=je.isArray(t),a={page:1,sdks:i?"auth_v1":void 0,entries:je.RECOMMENDED_WALLET_AMOUNT,chains:n,version:2,excludedIds:s?t.join(","):void 0},{listings:c}=Gs?await kt.getMobileListings(a):await kt.getDesktopListings(a);ft.recomendedWallets=Object.values(c)}return ft.recomendedWallets},async getWallets(e){const t=Ql({},e),{explorerRecommendedWalletIds:r,explorerExcludedWalletIds:i}=gr.state,{recomendedWallets:n}=ft;if(i==="ALL")return ft.wallets;n.length?t.excludedIds=n.map(p=>p.id).join(","):je.isArray(r)&&(t.excludedIds=r.join(",")),je.isArray(i)&&(t.excludedIds=[t.excludedIds,i].filter(Boolean).join(",")),ct.state.isAuth&&(t.sdks="auth_v1");const{page:s,search:a}=e,{listings:c,total:u}=Gs?await kt.getMobileListings(t):await kt.getDesktopListings(t),l=Object.values(c),h=a?"search":"wallets";return ft[h]={listings:[...ft[h].listings,...l],total:u,page:s??1},{listings:l,total:u}},getWalletImageUrl(e){return kt.getWalletImageUrl(e)},getAssetImageUrl(e){return kt.getAssetImageUrl(e)},resetSearch(){ft.search={listings:[],total:0,page:1}}},or=Bt({open:!1}),Ki={state:or,subscribe(e){return tr(or,()=>e(or))},async open(e){return new Promise(t=>{const{isUiLoaded:r,isDataLoaded:i}=ct.state;if(je.removeWalletConnectDeepLink(),ct.setWalletConnectUri(e?.uri),ct.setChains(e?.chains),cc.reset("ConnectWallet"),r&&i)or.open=!0,t();else{const n=setInterval(()=>{const s=ct.state;s.isUiLoaded&&s.isDataLoaded&&(clearInterval(n),or.open=!0,t())},200)}})},close(){or.open=!1}};var Xl=Object.defineProperty,Ys=Object.getOwnPropertySymbols,Zl=Object.prototype.hasOwnProperty,eh=Object.prototype.propertyIsEnumerable,Js=(e,t,r)=>t in e?Xl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,th=(e,t)=>{for(var r in t||(t={}))Zl.call(t,r)&&Js(e,r,t[r]);if(Ys)for(var r of Ys(t))eh.call(t,r)&&Js(e,r,t[r]);return e};function rh(){return typeof matchMedia<"u"&&matchMedia("(prefers-color-scheme: dark)").matches}const Dr=Bt({themeMode:rh()?"dark":"light"}),Qs={state:Dr,subscribe(e){return tr(Dr,()=>e(Dr))},setThemeConfig(e){const{themeMode:t,themeVariables:r}=e;t&&(Dr.themeMode=t),r&&(Dr.themeVariables=th({},r))}},Gt=Bt({open:!1,message:"",variant:"success"}),rv={state:Gt,subscribe(e){return tr(Gt,()=>e(Gt))},openToast(e,t){Gt.open=!0,Gt.message=e,Gt.variant=t},closeToast(){Gt.open=!1}};let ih=class{constructor(t){this.openModal=Ki.open,this.closeModal=Ki.close,this.subscribeModal=Ki.subscribe,this.setTheme=Qs.setThemeConfig,Qs.setThemeConfig(t),gr.setConfig(t),this.initUi()}async initUi(){if(typeof window<"u"){await Pl(()=>import("./bwa-R7GR.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url);const t=document.createElement("wcm-modal");document.body.insertAdjacentElement("beforeend",t),ct.setIsUiLoaded(!0)}}};var ci={exports:{}},Xs;function uc(){if(Xs)return ci.exports;Xs=1;var e=typeof Reflect=="object"?Reflect:null,t=e&&typeof e.apply=="function"?e.apply:function(y,f,o){return Function.prototype.apply.call(y,f,o)},r;e&&typeof e.ownKeys=="function"?r=e.ownKeys:Object.getOwnPropertySymbols?r=function(y){return Object.getOwnPropertyNames(y).concat(Object.getOwnPropertySymbols(y))}:r=function(y){return Object.getOwnPropertyNames(y)};function i(g){console&&console.warn&&console.warn(g)}var n=Number.isNaN||function(y){return y!==y};function s(){s.init.call(this)}ci.exports=s,ci.exports.once=P,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function c(g){if(typeof g!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof g)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(g){if(typeof g!="number"||g<0||n(g))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+g+".");a=g}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(y){if(typeof y!="number"||y<0||n(y))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+y+".");return this._maxListeners=y,this};function u(g){return g._maxListeners===void 0?s.defaultMaxListeners:g._maxListeners}s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(y){for(var f=[],o=1;o<arguments.length;o++)f.push(arguments[o]);var d=y==="error",R=this._events;if(R!==void 0)d=d&&R.error===void 0;else if(!d)return!1;if(d){var A;if(f.length>0&&(A=f[0]),A instanceof Error)throw A;var N=new Error("Unhandled error."+(A?" ("+A.message+")":""));throw N.context=A,N}var B=R[y];if(B===void 0)return!1;if(typeof B=="function")t(B,this,f);else for(var V=B.length,U=E(B,V),o=0;o<V;++o)t(U[o],this,f);return!0};function l(g,y,f,o){var d,R,A;if(c(f),R=g._events,R===void 0?(R=g._events=Object.create(null),g._eventsCount=0):(R.newListener!==void 0&&(g.emit("newListener",y,f.listener?f.listener:f),R=g._events),A=R[y]),A===void 0)A=R[y]=f,++g._eventsCount;else if(typeof A=="function"?A=R[y]=o?[f,A]:[A,f]:o?A.unshift(f):A.push(f),d=u(g),d>0&&A.length>d&&!A.warned){A.warned=!0;var N=new Error("Possible EventEmitter memory leak detected. "+A.length+" "+String(y)+" listeners added. Use emitter.setMaxListeners() to increase limit");N.name="MaxListenersExceededWarning",N.emitter=g,N.type=y,N.count=A.length,i(N)}return g}s.prototype.addListener=function(y,f){return l(this,y,f,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(y,f){return l(this,y,f,!0)};function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(g,y,f){var o={fired:!1,wrapFn:void 0,target:g,type:y,listener:f},d=h.bind(o);return d.listener=f,o.wrapFn=d,d}s.prototype.once=function(y,f){return c(f),this.on(y,p(this,y,f)),this},s.prototype.prependOnceListener=function(y,f){return c(f),this.prependListener(y,p(this,y,f)),this},s.prototype.removeListener=function(y,f){var o,d,R,A,N;if(c(f),d=this._events,d===void 0)return this;if(o=d[y],o===void 0)return this;if(o===f||o.listener===f)--this._eventsCount===0?this._events=Object.create(null):(delete d[y],d.removeListener&&this.emit("removeListener",y,o.listener||f));else if(typeof o!="function"){for(R=-1,A=o.length-1;A>=0;A--)if(o[A]===f||o[A].listener===f){N=o[A].listener,R=A;break}if(R<0)return this;R===0?o.shift():O(o,R),o.length===1&&(d[y]=o[0]),d.removeListener!==void 0&&this.emit("removeListener",y,N||f)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(y){var f,o,d;if(o=this._events,o===void 0)return this;if(o.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):o[y]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete o[y]),this;if(arguments.length===0){var R=Object.keys(o),A;for(d=0;d<R.length;++d)A=R[d],A!=="removeListener"&&this.removeAllListeners(A);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(f=o[y],typeof f=="function")this.removeListener(y,f);else if(f!==void 0)for(d=f.length-1;d>=0;d--)this.removeListener(y,f[d]);return this};function w(g,y,f){var o=g._events;if(o===void 0)return[];var d=o[y];return d===void 0?[]:typeof d=="function"?f?[d.listener||d]:[d]:f?C(d):E(d,d.length)}s.prototype.listeners=function(y){return w(this,y,!0)},s.prototype.rawListeners=function(y){return w(this,y,!1)},s.listenerCount=function(g,y){return typeof g.listenerCount=="function"?g.listenerCount(y):v.call(g,y)},s.prototype.listenerCount=v;function v(g){var y=this._events;if(y!==void 0){var f=y[g];if(typeof f=="function")return 1;if(f!==void 0)return f.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]};function E(g,y){for(var f=new Array(y),o=0;o<y;++o)f[o]=g[o];return f}function O(g,y){for(;y+1<g.length;y++)g[y]=g[y+1];g.pop()}function C(g){for(var y=new Array(g.length),f=0;f<y.length;++f)y[f]=g[f].listener||g[f];return y}function P(g,y){return new Promise(function(f,o){function d(A){g.removeListener(y,R),o(A)}function R(){typeof g.removeListener=="function"&&g.removeListener("error",d),f([].slice.call(arguments))}D(g,y,R,{once:!0}),y!=="error"&&_(g,d,{once:!0})})}function _(g,y,f){typeof g.on=="function"&&D(g,"error",y,f)}function D(g,y,f,o){if(typeof g.on=="function")o.once?g.once(y,f):g.on(y,f);else if(typeof g.addEventListener=="function")g.addEventListener(y,function d(R){o.once&&g.removeEventListener(y,d),f(R)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof g)}return ci.exports}var yt=uc();const lc=Ai(yt);function nh(e){return!e||typeof e.then!="function"?Promise.resolve(e):e}function Ne(e,...t){try{return nh(e(...t))}catch(r){return Promise.reject(r)}}function sh(e){const t=typeof e;return e===null||t!=="object"&&t!=="function"}function oh(e){const t=Object.getPrototypeOf(e);return!t||t.isPrototypeOf(Object)}function bi(e){if(sh(e))return String(e);if(oh(e)||Array.isArray(e))return JSON.stringify(e);if(typeof e.toJSON=="function")return bi(e.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Fn="base64:";function ah(e){return typeof e=="string"?e:Fn+lh(e)}function ch(e){return typeof e!="string"||!e.startsWith(Fn)?e:uh(e.slice(Fn.length))}function uh(e){return globalThis.Buffer?Buffer.from(e,"base64"):Uint8Array.from(globalThis.atob(e),t=>t.codePointAt(0))}function lh(e){return globalThis.Buffer?Buffer.from(e).toString("base64"):globalThis.btoa(String.fromCodePoint(...e))}function We(e){return e&&e.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function hh(...e){return We(e.join(":"))}function ui(e){return e=We(e),e?e+":":""}function fh(e,t){if(t===void 0)return!0;let r=0,i=e.indexOf(":");for(;i>-1;)r++,i=e.indexOf(":",i+1);return r<=t}function dh(e,t){return t?e.startsWith(t)&&e[e.length-1]!=="$":e[e.length-1]!=="$"}const ph="memory",gh=()=>{const e=new Map;return{name:ph,getInstance:()=>e,hasItem(t){return e.has(t)},getItem(t){return e.get(t)??null},getItemRaw(t){return e.get(t)??null},setItem(t,r){e.set(t,r)},setItemRaw(t,r){e.set(t,r)},removeItem(t){e.delete(t)},getKeys(){return[...e.keys()]},clear(){e.clear()},dispose(){e.clear()}}};function yh(e={}){const t={mounts:{"":e.driver||gh()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=l=>{for(const h of t.mountpoints)if(l.startsWith(h))return{base:h,relativeKey:l.slice(h.length),driver:t.mounts[h]};return{base:"",relativeKey:l,driver:t.mounts[""]}},i=(l,h)=>t.mountpoints.filter(p=>p.startsWith(l)||h&&l.startsWith(p)).map(p=>({relativeBase:l.length>p.length?l.slice(p.length):void 0,mountpoint:p,driver:t.mounts[p]})),n=(l,h)=>{if(t.watching){h=We(h);for(const p of t.watchListeners)p(l,h)}},s=async()=>{if(!t.watching){t.watching=!0;for(const l in t.mounts)t.unwatch[l]=await Zs(t.mounts[l],n,l)}},a=async()=>{if(t.watching){for(const l in t.unwatch)await t.unwatch[l]();t.unwatch={},t.watching=!1}},c=(l,h,p)=>{const w=new Map,v=E=>{let O=w.get(E.base);return O||(O={driver:E.driver,base:E.base,items:[]},w.set(E.base,O)),O};for(const E of l){const O=typeof E=="string",C=We(O?E:E.key),P=O?void 0:E.value,_=O||!E.options?h:{...h,...E.options},D=r(C);v(D).items.push({key:C,value:P,relativeKey:D.relativeKey,options:_})}return Promise.all([...w.values()].map(E=>p(E))).then(E=>E.flat())},u={hasItem(l,h={}){l=We(l);const{relativeKey:p,driver:w}=r(l);return Ne(w.hasItem,p,h)},getItem(l,h={}){l=We(l);const{relativeKey:p,driver:w}=r(l);return Ne(w.getItem,p,h).then(v=>ni(v))},getItems(l,h={}){return c(l,h,p=>p.driver.getItems?Ne(p.driver.getItems,p.items.map(w=>({key:w.relativeKey,options:w.options})),h).then(w=>w.map(v=>({key:hh(p.base,v.key),value:ni(v.value)}))):Promise.all(p.items.map(w=>Ne(p.driver.getItem,w.relativeKey,w.options).then(v=>({key:w.key,value:ni(v)})))))},getItemRaw(l,h={}){l=We(l);const{relativeKey:p,driver:w}=r(l);return w.getItemRaw?Ne(w.getItemRaw,p,h):Ne(w.getItem,p,h).then(v=>ch(v))},async setItem(l,h,p={}){if(h===void 0)return u.removeItem(l);l=We(l);const{relativeKey:w,driver:v}=r(l);v.setItem&&(await Ne(v.setItem,w,bi(h),p),v.watch||n("update",l))},async setItems(l,h){await c(l,h,async p=>{if(p.driver.setItems)return Ne(p.driver.setItems,p.items.map(w=>({key:w.relativeKey,value:bi(w.value),options:w.options})),h);p.driver.setItem&&await Promise.all(p.items.map(w=>Ne(p.driver.setItem,w.relativeKey,bi(w.value),w.options)))})},async setItemRaw(l,h,p={}){if(h===void 0)return u.removeItem(l,p);l=We(l);const{relativeKey:w,driver:v}=r(l);if(v.setItemRaw)await Ne(v.setItemRaw,w,h,p);else if(v.setItem)await Ne(v.setItem,w,ah(h),p);else return;v.watch||n("update",l)},async removeItem(l,h={}){typeof h=="boolean"&&(h={removeMeta:h}),l=We(l);const{relativeKey:p,driver:w}=r(l);w.removeItem&&(await Ne(w.removeItem,p,h),(h.removeMeta||h.removeMata)&&await Ne(w.removeItem,p+"$",h),w.watch||n("remove",l))},async getMeta(l,h={}){typeof h=="boolean"&&(h={nativeOnly:h}),l=We(l);const{relativeKey:p,driver:w}=r(l),v=Object.create(null);if(w.getMeta&&Object.assign(v,await Ne(w.getMeta,p,h)),!h.nativeOnly){const E=await Ne(w.getItem,p+"$",h).then(O=>ni(O));E&&typeof E=="object"&&(typeof E.atime=="string"&&(E.atime=new Date(E.atime)),typeof E.mtime=="string"&&(E.mtime=new Date(E.mtime)),Object.assign(v,E))}return v},setMeta(l,h,p={}){return this.setItem(l+"$",h,p)},removeMeta(l,h={}){return this.removeItem(l+"$",h)},async getKeys(l,h={}){l=ui(l);const p=i(l,!0);let w=[];const v=[];let E=!0;for(const C of p){C.driver.flags?.maxDepth||(E=!1);const P=await Ne(C.driver.getKeys,C.relativeBase,h);for(const _ of P){const D=C.mountpoint+We(_);w.some(g=>D.startsWith(g))||v.push(D)}w=[C.mountpoint,...w.filter(_=>!_.startsWith(C.mountpoint))]}const O=h.maxDepth!==void 0&&!E;return v.filter(C=>(!O||fh(C,h.maxDepth))&&dh(C,l))},async clear(l,h={}){l=ui(l),await Promise.all(i(l,!1).map(async p=>{if(p.driver.clear)return Ne(p.driver.clear,p.relativeBase,h);if(p.driver.removeItem){const w=await p.driver.getKeys(p.relativeBase||"",h);return Promise.all(w.map(v=>p.driver.removeItem(v,h)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(l=>eo(l)))},async watch(l){return await s(),t.watchListeners.push(l),async()=>{t.watchListeners=t.watchListeners.filter(h=>h!==l),t.watchListeners.length===0&&await a()}},async unwatch(){t.watchListeners=[],await a()},mount(l,h){if(l=ui(l),l&&t.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(t.mountpoints.push(l),t.mountpoints.sort((p,w)=>w.length-p.length)),t.mounts[l]=h,t.watching&&Promise.resolve(Zs(h,n,l)).then(p=>{t.unwatch[l]=p}).catch(console.error),u},async unmount(l,h=!0){l=ui(l),!(!l||!t.mounts[l])&&(t.watching&&l in t.unwatch&&(t.unwatch[l]?.(),delete t.unwatch[l]),h&&await eo(t.mounts[l]),t.mountpoints=t.mountpoints.filter(p=>p!==l),delete t.mounts[l])},getMount(l=""){l=We(l)+":";const h=r(l);return{driver:h.driver,base:h.base}},getMounts(l="",h={}){return l=We(l),i(l,h.parents).map(w=>({driver:w.driver,base:w.mountpoint}))},keys:(l,h={})=>u.getKeys(l,h),get:(l,h={})=>u.getItem(l,h),set:(l,h,p={})=>u.setItem(l,h,p),has:(l,h={})=>u.hasItem(l,h),del:(l,h={})=>u.removeItem(l,h),remove:(l,h={})=>u.removeItem(l,h)};return u}function Zs(e,t,r){return e.watch?e.watch((i,n)=>t(i,r+n)):()=>{}}async function eo(e){typeof e.dispose=="function"&&await Ne(e.dispose)}function rr(e){return new Promise((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)})}function hc(e,t){let r;const i=()=>{if(r)return r;const n=indexedDB.open(e);return n.onupgradeneeded=()=>n.result.createObjectStore(t),r=rr(n),r.then(s=>{s.onclose=()=>r=void 0},()=>{}),r};return(n,s)=>i().then(a=>s(a.transaction(t,n).objectStore(t)))}let Vi;function zr(){return Vi||(Vi=hc("keyval-store","keyval")),Vi}function to(e,t=zr()){return t("readonly",r=>rr(r.get(e)))}function wh(e,t,r=zr()){return r("readwrite",i=>(i.put(t,e),rr(i.transaction)))}function bh(e,t=zr()){return t("readwrite",r=>(r.delete(e),rr(r.transaction)))}function mh(e=zr()){return e("readwrite",t=>(t.clear(),rr(t.transaction)))}function vh(e,t){return e.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},rr(e.transaction)}function Eh(e=zr()){return e("readonly",t=>{if(t.getAllKeys)return rr(t.getAllKeys());const r=[];return vh(t,i=>r.push(i.key)).then(()=>r)})}const _h=e=>JSON.stringify(e,(t,r)=>typeof r=="bigint"?r.toString()+"n":r),Dh=e=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=e.replace(t,'$1"$2n"$3');return JSON.parse(r,(i,n)=>typeof n=="string"&&n.match(/^\d+n$/)?BigInt(n.substring(0,n.length-1)):n)};function Ri(e){if(typeof e!="string")throw new Error(`Cannot safe json parse value of type ${typeof e}`);try{return Dh(e)}catch{return e}}function Kr(e){return typeof e=="string"?e:_h(e)||""}const Sh="idb-keyval";var Ih=(e={})=>{const t=e.base&&e.base.length>0?`${e.base}:`:"",r=n=>t+n;let i;return e.dbName&&e.storeName&&(i=hc(e.dbName,e.storeName)),{name:Sh,options:e,async hasItem(n){return!(typeof await to(r(n),i)>"u")},async getItem(n){return await to(r(n),i)??null},setItem(n,s){return wh(r(n),s,i)},removeItem(n){return bh(r(n),i)},getKeys(){return Eh(i)},clear(){return mh(i)}}};const Oh="WALLET_CONNECT_V2_INDEXED_DB",xh="keyvaluestorage";let Ah=class{constructor(){this.indexedDb=yh({driver:Ih({dbName:Oh,storeName:xh})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,Kr(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var Hi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},mi={exports:{}};(function(){let e;function t(){}e=t,e.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},e.prototype.setItem=function(r,i){this[r]=String(i)},e.prototype.removeItem=function(r){delete this[r]},e.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},e.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},e.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Hi<"u"&&Hi.localStorage?mi.exports=Hi.localStorage:typeof window<"u"&&window.localStorage?mi.exports=window.localStorage:mi.exports=new t})();function Rh(e){var t;return[e[0],Ri((t=e[1])!=null?t:"")]}let Ch=class{constructor(){this.localStorage=mi.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Rh)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return Ri(r)}async setItem(t,r){this.localStorage.setItem(t,Kr(r))}async removeItem(t){this.localStorage.removeItem(t)}};const Nh="wc_storage_version",ro=1,Ph=async(e,t,r)=>{const i=Nh,n=await t.getItem(i);if(n&&n>=ro){r(t);return}const s=await e.getKeys();if(!s.length){r(t);return}const a=[];for(;s.length;){const c=s.shift();if(!c)continue;const u=c.toLowerCase();if(u.includes("wc@")||u.includes("walletconnect")||u.includes("wc_")||u.includes("wallet_connect")){const l=await e.getItem(c);await t.setItem(c,l),a.push(c)}}await t.setItem(i,ro),r(t),Th(e,a)},Th=async(e,t)=>{t.length&&t.forEach(async r=>{await e.removeItem(r)})};let $h=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new Ch;this.storage=t;try{const r=new Ah;Ph(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var Wi={};var Ln=function(e,t){return Ln=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Ln(e,t)};function Uh(e,t){Ln(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Mn=function(){return Mn=Object.assign||function(t){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},Mn.apply(this,arguments)};function Fh(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]]);return r}function Lh(e,t,r,i){var n=arguments.length,s=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,t,r,i);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(s=(n<3?a(s):n>3?a(t,r,s):a(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s}function Mh(e,t){return function(r,i){t(r,i,e)}}function Bh(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function jh(e,t,r,i){function n(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(h){try{l(i.next(h))}catch(p){a(p)}}function u(h){try{l(i.throw(h))}catch(p){a(p)}}function l(h){h.done?s(h.value):n(h.value).then(c,u)}l((i=i.apply(e,t||[])).next())})}function qh(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(h){return u([l,h])}}function u(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=l[0]&2?n.return:l[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,l[1])).done)return s;switch(n=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(h){l=[6,h],n=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function zh(e,t,r,i){i===void 0&&(i=r),e[i]=t[r]}function Kh(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=e[r])}function Bn(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function fc(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var i=r.call(e),n,s=[],a;try{for(;(t===void 0||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){a={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return s}function Vh(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(fc(arguments[t]));return e}function Hh(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var i=Array(e),n=0,t=0;t<r;t++)for(var s=arguments[t],a=0,c=s.length;a<c;a++,n++)i[n]=s[a];return i}function Br(e){return this instanceof Br?(this.v=e,this):new Br(e)}function Wh(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(e,t||[]),n,s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(w){i[w]&&(n[w]=function(v){return new Promise(function(E,O){s.push([w,v,E,O])>1||c(w,v)})})}function c(w,v){try{u(i[w](v))}catch(E){p(s[0][3],E)}}function u(w){w.value instanceof Br?Promise.resolve(w.value.v).then(l,h):p(s[0][2],w)}function l(w){c("next",w)}function h(w){c("throw",w)}function p(w,v){w(v),s.shift(),s.length&&c(s[0][0],s[0][1])}}function kh(e){var t,r;return t={},i("next"),i("throw",function(n){throw n}),i("return"),t[Symbol.iterator]=function(){return this},t;function i(n,s){t[n]=e[n]?function(a){return(r=!r)?{value:Br(e[n](a)),done:n==="return"}:s?s(a):a}:s}}function Gh(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof Bn=="function"?Bn(e):e[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=e[s]&&function(a){return new Promise(function(c,u){a=e[s](a),n(c,u,a.done,a.value)})}}function n(s,a,c,u){Promise.resolve(u).then(function(l){s({value:l,done:c})},a)}}function Yh(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function Jh(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function Qh(e){return e&&e.__esModule?e:{default:e}}function Xh(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function Zh(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r}const ef=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Mn},__asyncDelegator:kh,__asyncGenerator:Wh,__asyncValues:Gh,__await:Br,__awaiter:jh,__classPrivateFieldGet:Xh,__classPrivateFieldSet:Zh,__createBinding:zh,__decorate:Lh,__exportStar:Kh,__extends:Uh,__generator:qh,__importDefault:Qh,__importStar:Jh,__makeTemplateObject:Yh,__metadata:Bh,__param:Mh,__read:fc,__rest:Fh,__spread:Vh,__spreadArrays:Hh,__values:Bn},Symbol.toStringTag,{value:"Module"})),At=Xn(ef);var Sr={},ki={},Gi={},Ir={},io;function tf(){if(io)return Ir;io=1,Object.defineProperty(Ir,"__esModule",{value:!0}),Ir.delay=void 0;function e(t){return new Promise(r=>{setTimeout(()=>{r(!0)},t)})}return Ir.delay=e,Ir}var Yt={},Yi={},Jt={},no;function rf(){return no||(no=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.ONE_THOUSAND=Jt.ONE_HUNDRED=void 0,Jt.ONE_HUNDRED=100,Jt.ONE_THOUSAND=1e3),Jt}var Ji={},so;function nf(){return so||(so=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ONE_YEAR=e.FOUR_WEEKS=e.THREE_WEEKS=e.TWO_WEEKS=e.ONE_WEEK=e.THIRTY_DAYS=e.SEVEN_DAYS=e.FIVE_DAYS=e.THREE_DAYS=e.ONE_DAY=e.TWENTY_FOUR_HOURS=e.TWELVE_HOURS=e.SIX_HOURS=e.THREE_HOURS=e.ONE_HOUR=e.SIXTY_MINUTES=e.THIRTY_MINUTES=e.TEN_MINUTES=e.FIVE_MINUTES=e.ONE_MINUTE=e.SIXTY_SECONDS=e.THIRTY_SECONDS=e.TEN_SECONDS=e.FIVE_SECONDS=e.ONE_SECOND=void 0,e.ONE_SECOND=1,e.FIVE_SECONDS=5,e.TEN_SECONDS=10,e.THIRTY_SECONDS=30,e.SIXTY_SECONDS=60,e.ONE_MINUTE=e.SIXTY_SECONDS,e.FIVE_MINUTES=e.ONE_MINUTE*5,e.TEN_MINUTES=e.ONE_MINUTE*10,e.THIRTY_MINUTES=e.ONE_MINUTE*30,e.SIXTY_MINUTES=e.ONE_MINUTE*60,e.ONE_HOUR=e.SIXTY_MINUTES,e.THREE_HOURS=e.ONE_HOUR*3,e.SIX_HOURS=e.ONE_HOUR*6,e.TWELVE_HOURS=e.ONE_HOUR*12,e.TWENTY_FOUR_HOURS=e.ONE_HOUR*24,e.ONE_DAY=e.TWENTY_FOUR_HOURS,e.THREE_DAYS=e.ONE_DAY*3,e.FIVE_DAYS=e.ONE_DAY*5,e.SEVEN_DAYS=e.ONE_DAY*7,e.THIRTY_DAYS=e.ONE_DAY*30,e.ONE_WEEK=e.SEVEN_DAYS,e.TWO_WEEKS=e.ONE_WEEK*2,e.THREE_WEEKS=e.ONE_WEEK*3,e.FOUR_WEEKS=e.ONE_WEEK*4,e.ONE_YEAR=e.ONE_DAY*365}(Ji)),Ji}var oo;function dc(){return oo||(oo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=At;t.__exportStar(rf(),e),t.__exportStar(nf(),e)}(Yi)),Yi}var ao;function sf(){if(ao)return Yt;ao=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.fromMiliseconds=Yt.toMiliseconds=void 0;const e=dc();function t(i){return i*e.ONE_THOUSAND}Yt.toMiliseconds=t;function r(i){return Math.floor(i/e.ONE_THOUSAND)}return Yt.fromMiliseconds=r,Yt}var co;function of(){return co||(co=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=At;t.__exportStar(tf(),e),t.__exportStar(sf(),e)}(Gi)),Gi}var ar={},uo;function af(){if(uo)return ar;uo=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.Watch=void 0;class e{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const n=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:n})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return ar.Watch=e,ar.default=e,ar}var Qi={},Or={},lo;function cf(){if(lo)return Or;lo=1,Object.defineProperty(Or,"__esModule",{value:!0}),Or.IWatch=void 0;class e{}return Or.IWatch=e,Or}var ho;function uf(){return ho||(ho=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),At.__exportStar(cf(),e)}(Qi)),Qi}var fo;function Zn(){return fo||(fo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=At;t.__exportStar(of(),e),t.__exportStar(af(),e),t.__exportStar(uf(),e),t.__exportStar(dc(),e)}(ki)),ki}var Xi={},xr={};class ir{}const lf=Object.freeze(Object.defineProperty({__proto__:null,IEvents:ir},Symbol.toStringTag,{value:"Module"})),hf=Xn(lf);var po;function ff(){if(po)return xr;po=1,Object.defineProperty(xr,"__esModule",{value:!0}),xr.IHeartBeat=void 0;const e=hf;class t extends e.IEvents{constructor(i){super()}}return xr.IHeartBeat=t,xr}var go;function pc(){return go||(go=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),At.__exportStar(ff(),e)}(Xi)),Xi}var Zi={},Qt={},yo;function df(){if(yo)return Qt;yo=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.HEARTBEAT_EVENTS=Qt.HEARTBEAT_INTERVAL=void 0;const e=Zn();return Qt.HEARTBEAT_INTERVAL=e.FIVE_SECONDS,Qt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Qt}var wo;function gc(){return wo||(wo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),At.__exportStar(df(),e)}(Zi)),Zi}var bo;function pf(){if(bo)return Sr;bo=1,Object.defineProperty(Sr,"__esModule",{value:!0}),Sr.HeartBeat=void 0;const e=At,t=uc(),r=Zn(),i=pc(),n=gc();class s extends i.IHeartBeat{constructor(c){super(c),this.events=new t.EventEmitter,this.interval=n.HEARTBEAT_INTERVAL,this.interval=c?.interval||n.HEARTBEAT_INTERVAL}static init(c){return e.__awaiter(this,void 0,void 0,function*(){const u=new s(c);return yield u.init(),u})}init(){return e.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(c,u){this.events.on(c,u)}once(c,u){this.events.once(c,u)}off(c,u){this.events.off(c,u)}removeListener(c,u){this.events.removeListener(c,u)}initialize(){return e.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(n.HEARTBEAT_EVENTS.pulse)}}return Sr.HeartBeat=s,Sr}var mo;function gf(){return mo||(mo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=At;t.__exportStar(pf(),e),t.__exportStar(pc(),e),t.__exportStar(gc(),e)}(Wi)),Wi}var Vr=gf(),en,vo;function yf(){if(vo)return en;vo=1;function e(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}en=t;function t(r,i,n){var s=n&&n.stringify||e,a=1;if(typeof r=="object"&&r!==null){var c=i.length+a;if(c===1)return r;var u=new Array(c);u[0]=s(r);for(var l=1;l<c;l++)u[l]=s(i[l]);return u.join(" ")}if(typeof r!="string")return r;var h=i.length;if(h===0)return r;for(var p="",w=1-a,v=-1,E=r&&r.length||0,O=0;O<E;){if(r.charCodeAt(O)===37&&O+1<E){switch(v=v>-1?v:0,r.charCodeAt(O+1)){case 100:case 102:if(w>=h||i[w]==null)break;v<O&&(p+=r.slice(v,O)),p+=Number(i[w]),v=O+2,O++;break;case 105:if(w>=h||i[w]==null)break;v<O&&(p+=r.slice(v,O)),p+=Math.floor(Number(i[w])),v=O+2,O++;break;case 79:case 111:case 106:if(w>=h||i[w]===void 0)break;v<O&&(p+=r.slice(v,O));var C=typeof i[w];if(C==="string"){p+="'"+i[w]+"'",v=O+2,O++;break}if(C==="function"){p+=i[w].name||"<anonymous>",v=O+2,O++;break}p+=s(i[w]),v=O+2,O++;break;case 115:if(w>=h)break;v<O&&(p+=r.slice(v,O)),p+=String(i[w]),v=O+2,O++;break;case 37:v<O&&(p+=r.slice(v,O)),p+="%",v=O+2,O++,w--;break}++w}++O}return v===-1?r:(v<E&&(p+=r.slice(v)),p)}return en}var tn,Eo;function wf(){if(Eo)return tn;Eo=1;const e=yf();tn=n;const t=y().console||{},r={mapHttpRequest:E,mapHttpResponse:E,wrapRequestSerializer:O,wrapResponseSerializer:O,wrapErrorSerializer:O,req:E,res:E,err:w};function i(f,o){return Array.isArray(f)?f.filter(function(R){return R!=="!stdSerializers.err"}):f===!0?Object.keys(o):!1}function n(f){f=f||{},f.browser=f.browser||{};const o=f.browser.transmit;if(o&&typeof o.send!="function")throw Error("pino: transmit option must have a send function");const d=f.browser.write||t;f.browser.write&&(f.browser.asObject=!0);const R=f.serializers||{},A=i(f.browser.serialize,R);let N=f.browser.serialize;Array.isArray(f.browser.serialize)&&f.browser.serialize.indexOf("!stdSerializers.err")>-1&&(N=!1);const B=["error","fatal","warn","info","debug","trace"];typeof d=="function"&&(d.error=d.fatal=d.warn=d.info=d.debug=d.trace=d),f.enabled===!1&&(f.level="silent");const V=f.level||"info",U=Object.create(d);U.log||(U.log=C),Object.defineProperty(U,"levelVal",{get:b}),Object.defineProperty(U,"level",{get:S,set:T});const I={transmit:o,serialize:A,asObject:f.browser.asObject,levels:B,timestamp:v(f)};U.levels=n.levels,U.level=V,U.setMaxListeners=U.getMaxListeners=U.emit=U.addListener=U.on=U.prependListener=U.once=U.prependOnceListener=U.removeListener=U.removeAllListeners=U.listeners=U.listenerCount=U.eventNames=U.write=U.flush=C,U.serializers=R,U._serialize=A,U._stdErrSerialize=N,U.child=q,o&&(U._logEvent=p());function b(){return this.level==="silent"?1/0:this.levels.values[this.level]}function S(){return this._level}function T(L){if(L!=="silent"&&!this.levels.values[L])throw Error("unknown level "+L);this._level=L,s(I,U,"error","log"),s(I,U,"fatal","error"),s(I,U,"warn","error"),s(I,U,"info","log"),s(I,U,"debug","log"),s(I,U,"trace","log")}function q(L,H){if(!L)throw new Error("missing bindings for child Pino");H=H||{},A&&L.serializers&&(H.serializers=L.serializers);const K=H.serializers;if(A&&K){var $=Object.assign({},R,K),j=f.browser.serialize===!0?Object.keys($):A;delete L.serializers,u([L],j,$,this._stdErrSerialize)}function M(k){this._childLevel=(k._childLevel|0)+1,this.error=l(k,L,"error"),this.fatal=l(k,L,"fatal"),this.warn=l(k,L,"warn"),this.info=l(k,L,"info"),this.debug=l(k,L,"debug"),this.trace=l(k,L,"trace"),$&&(this.serializers=$,this._serialize=j),o&&(this._logEvent=p([].concat(k._logEvent.bindings,L)))}return M.prototype=this,new M(this)}return U}n.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},n.stdSerializers=r,n.stdTimeFunctions=Object.assign({},{nullTime:P,epochTime:_,unixTime:D,isoTime:g});function s(f,o,d,R){const A=Object.getPrototypeOf(o);o[d]=o.levelVal>o.levels.values[d]?C:A[d]?A[d]:t[d]||t[R]||C,a(f,o,d)}function a(f,o,d){!f.transmit&&o[d]===C||(o[d]=function(R){return function(){const N=f.timestamp(),B=new Array(arguments.length),V=Object.getPrototypeOf&&Object.getPrototypeOf(this)===t?t:this;for(var U=0;U<B.length;U++)B[U]=arguments[U];if(f.serialize&&!f.asObject&&u(B,this._serialize,this.serializers,this._stdErrSerialize),f.asObject?R.call(V,c(this,d,B,N)):R.apply(V,B),f.transmit){const I=f.transmit.level||o.level,b=n.levels.values[I],S=n.levels.values[d];if(S<b)return;h(this,{ts:N,methodLevel:d,methodValue:S,transmitValue:n.levels.values[f.transmit.level||o.level],send:f.transmit.send,val:o.levelVal},B)}}}(o[d]))}function c(f,o,d,R){f._serialize&&u(d,f._serialize,f.serializers,f._stdErrSerialize);const A=d.slice();let N=A[0];const B={};R&&(B.time=R),B.level=n.levels.values[o];let V=(f._childLevel|0)+1;if(V<1&&(V=1),N!==null&&typeof N=="object"){for(;V--&&typeof A[0]=="object";)Object.assign(B,A.shift());N=A.length?e(A.shift(),A):void 0}else typeof N=="string"&&(N=e(A.shift(),A));return N!==void 0&&(B.msg=N),B}function u(f,o,d,R){for(const A in f)if(R&&f[A]instanceof Error)f[A]=n.stdSerializers.err(f[A]);else if(typeof f[A]=="object"&&!Array.isArray(f[A]))for(const N in f[A])o&&o.indexOf(N)>-1&&N in d&&(f[A][N]=d[N](f[A][N]))}function l(f,o,d){return function(){const R=new Array(1+arguments.length);R[0]=o;for(var A=1;A<R.length;A++)R[A]=arguments[A-1];return f[d].apply(this,R)}}function h(f,o,d){const R=o.send,A=o.ts,N=o.methodLevel,B=o.methodValue,V=o.val,U=f._logEvent.bindings;u(d,f._serialize||Object.keys(f.serializers),f.serializers,f._stdErrSerialize===void 0?!0:f._stdErrSerialize),f._logEvent.ts=A,f._logEvent.messages=d.filter(function(I){return U.indexOf(I)===-1}),f._logEvent.level.label=N,f._logEvent.level.value=B,R(N,f._logEvent,V),f._logEvent=p(U)}function p(f){return{ts:0,messages:[],bindings:f||[],level:{label:"",value:0}}}function w(f){const o={type:f.constructor.name,msg:f.message,stack:f.stack};for(const d in f)o[d]===void 0&&(o[d]=f[d]);return o}function v(f){return typeof f.timestamp=="function"?f.timestamp:f.timestamp===!1?P:_}function E(){return{}}function O(f){return f}function C(){}function P(){return!1}function _(){return Date.now()}function D(){return Math.round(Date.now()/1e3)}function g(){return new Date(Date.now()).toISOString()}function y(){function f(o){return typeof o<"u"&&o}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return f(self)||f(window)||f(this)||{}}}return tn}var bf=wf();const es=Ai(bf),mf={level:"info"},Hr="custom_context";var vf=Object.defineProperty,Ef=Object.defineProperties,_f=Object.getOwnPropertyDescriptors,_o=Object.getOwnPropertySymbols,Df=Object.prototype.hasOwnProperty,Sf=Object.prototype.propertyIsEnumerable,Do=(e,t,r)=>t in e?vf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,If=(e,t)=>{for(var r in t||(t={}))Df.call(t,r)&&Do(e,r,t[r]);if(_o)for(var r of _o(t))Sf.call(t,r)&&Do(e,r,t[r]);return e},Of=(e,t)=>Ef(e,_f(t));function ts(e){return Of(If({},e),{level:e?.level||mf.level})}function xf(e,t=Hr){return e[t]||""}function Af(e,t,r=Hr){return e[r]=t,e}function Ge(e,t=Hr){let r="";return typeof e.bindings>"u"?r=xf(e,t):r=e.bindings().context||"",r}function Rf(e,t,r=Hr){const i=Ge(e,r);return i.trim()?`${i}/${t}`:t}function Ye(e,t,r=Hr){const i=Rf(e,t,r),n=e.child({context:i});return Af(n,i,r)}let Cf=class extends ir{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}},Nf=class extends ir{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},Pf=class{constructor(t,r){this.logger=t,this.core=r}};class Tf extends ir{constructor(t,r){super(),this.relayer=t,this.logger=r}}let $f=class extends ir{constructor(t){super()}},Uf=class{constructor(t,r,i,n){this.core=t,this.logger=r,this.name=i}};class Ff extends ir{constructor(t,r){super(),this.relayer=t,this.logger=r}}class Lf extends ir{constructor(t,r){super(),this.core=t,this.logger=r}}class Mf{constructor(t,r){this.projectId=t,this.logger=r}}let Bf=class{constructor(t,r){this.projectId=t,this.logger=r}},jf=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},qf=class{constructor(t){this.client=t}};var G=Zn();function zf(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function yc(e,...t){if(!zf(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function So(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Kf(e,t){yc(e);const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const cr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const rn=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);function Vf(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))}function wc(e){return typeof e=="string"&&(e=Vf(e)),yc(e),e}let Hf=class{clone(){return this._cloneInto()}};function Wf(e){const t=i=>e().update(wc(i)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function bc(e=32){if(cr&&typeof cr.getRandomValues=="function")return cr.getRandomValues(new Uint8Array(e));if(cr&&typeof cr.randomBytes=="function")return cr.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")}function kf(e,t,r,i){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,i);const n=BigInt(32),s=BigInt(4294967295),a=Number(r>>n&s),c=Number(r&s),u=i?4:0,l=i?0:4;e.setUint32(t+u,a,i),e.setUint32(t+l,c,i)}class Gf extends Hf{constructor(t,r,i,n){super(),this.blockLen=t,this.outputLen=r,this.padOffset=i,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=rn(this.buffer)}update(t){So(this);const{view:r,buffer:i,blockLen:n}=this;t=wc(t);const s=t.length;for(let a=0;a<s;){const c=Math.min(n-this.pos,s-a);if(c===n){const u=rn(t);for(;n<=s-a;a+=n)this.process(u,a);continue}i.set(t.subarray(a,a+c),this.pos),this.pos+=c,a+=c,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){So(this),Kf(t,this),this.finished=!0;const{buffer:r,view:i,blockLen:n,isLE:s}=this;let{pos:a}=this;r[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>n-a&&(this.process(i,0),a=0);for(let p=a;p<n;p++)r[p]=0;kf(i,n-8,BigInt(this.length*8),s),this.process(i,0);const c=rn(t),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=u/4,h=this.get();if(l>h.length)throw new Error("_sha2: outputLen bigger than state");for(let p=0;p<l;p++)c.setUint32(4*p,h[p],s)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const i=t.slice(0,r);return this.destroy(),i}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:r,buffer:i,length:n,finished:s,destroyed:a,pos:c}=this;return t.length=n,t.pos=c,t.finished=s,t.destroyed=a,n%r&&t.buffer.set(i),t}}const li=BigInt(2**32-1),jn=BigInt(32);function mc(e,t=!1){return t?{h:Number(e&li),l:Number(e>>jn&li)}:{h:Number(e>>jn&li)|0,l:Number(e&li)|0}}function Yf(e,t=!1){let r=new Uint32Array(e.length),i=new Uint32Array(e.length);for(let n=0;n<e.length;n++){const{h:s,l:a}=mc(e[n],t);[r[n],i[n]]=[s,a]}return[r,i]}const Jf=(e,t)=>BigInt(e>>>0)<<jn|BigInt(t>>>0),Qf=(e,t,r)=>e>>>r,Xf=(e,t,r)=>e<<32-r|t>>>r,Zf=(e,t,r)=>e>>>r|t<<32-r,ed=(e,t,r)=>e<<32-r|t>>>r,td=(e,t,r)=>e<<64-r|t>>>r-32,rd=(e,t,r)=>e>>>r-32|t<<64-r,id=(e,t)=>t,nd=(e,t)=>e,sd=(e,t,r)=>e<<r|t>>>32-r,od=(e,t,r)=>t<<r|e>>>32-r,ad=(e,t,r)=>t<<r-32|e>>>64-r,cd=(e,t,r)=>e<<r-32|t>>>64-r;function ud(e,t,r,i){const n=(t>>>0)+(i>>>0);return{h:e+r+(n/2**32|0)|0,l:n|0}}const ld=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),hd=(e,t,r,i)=>t+r+i+(e/2**32|0)|0,fd=(e,t,r,i)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0),dd=(e,t,r,i,n)=>t+r+i+n+(e/2**32|0)|0,pd=(e,t,r,i,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0)+(n>>>0),gd=(e,t,r,i,n,s)=>t+r+i+n+s+(e/2**32|0)|0,Z={fromBig:mc,split:Yf,toBig:Jf,shrSH:Qf,shrSL:Xf,rotrSH:Zf,rotrSL:ed,rotrBH:td,rotrBL:rd,rotr32H:id,rotr32L:nd,rotlSH:sd,rotlSL:od,rotlBH:ad,rotlBL:cd,add:ud,add3L:ld,add3H:hd,add4L:fd,add4H:dd,add5H:gd,add5L:pd},[yd,wd]=Z.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),$t=new Uint32Array(80),Ut=new Uint32Array(80);let bd=class extends Gf{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:t,Al:r,Bh:i,Bl:n,Ch:s,Cl:a,Dh:c,Dl:u,Eh:l,El:h,Fh:p,Fl:w,Gh:v,Gl:E,Hh:O,Hl:C}=this;return[t,r,i,n,s,a,c,u,l,h,p,w,v,E,O,C]}set(t,r,i,n,s,a,c,u,l,h,p,w,v,E,O,C){this.Ah=t|0,this.Al=r|0,this.Bh=i|0,this.Bl=n|0,this.Ch=s|0,this.Cl=a|0,this.Dh=c|0,this.Dl=u|0,this.Eh=l|0,this.El=h|0,this.Fh=p|0,this.Fl=w|0,this.Gh=v|0,this.Gl=E|0,this.Hh=O|0,this.Hl=C|0}process(t,r){for(let D=0;D<16;D++,r+=4)$t[D]=t.getUint32(r),Ut[D]=t.getUint32(r+=4);for(let D=16;D<80;D++){const g=$t[D-15]|0,y=Ut[D-15]|0,f=Z.rotrSH(g,y,1)^Z.rotrSH(g,y,8)^Z.shrSH(g,y,7),o=Z.rotrSL(g,y,1)^Z.rotrSL(g,y,8)^Z.shrSL(g,y,7),d=$t[D-2]|0,R=Ut[D-2]|0,A=Z.rotrSH(d,R,19)^Z.rotrBH(d,R,61)^Z.shrSH(d,R,6),N=Z.rotrSL(d,R,19)^Z.rotrBL(d,R,61)^Z.shrSL(d,R,6),B=Z.add4L(o,N,Ut[D-7],Ut[D-16]),V=Z.add4H(B,f,A,$t[D-7],$t[D-16]);$t[D]=V|0,Ut[D]=B|0}let{Ah:i,Al:n,Bh:s,Bl:a,Ch:c,Cl:u,Dh:l,Dl:h,Eh:p,El:w,Fh:v,Fl:E,Gh:O,Gl:C,Hh:P,Hl:_}=this;for(let D=0;D<80;D++){const g=Z.rotrSH(p,w,14)^Z.rotrSH(p,w,18)^Z.rotrBH(p,w,41),y=Z.rotrSL(p,w,14)^Z.rotrSL(p,w,18)^Z.rotrBL(p,w,41),f=p&v^~p&O,o=w&E^~w&C,d=Z.add5L(_,y,o,wd[D],Ut[D]),R=Z.add5H(d,P,g,f,yd[D],$t[D]),A=d|0,N=Z.rotrSH(i,n,28)^Z.rotrBH(i,n,34)^Z.rotrBH(i,n,39),B=Z.rotrSL(i,n,28)^Z.rotrBL(i,n,34)^Z.rotrBL(i,n,39),V=i&s^i&c^s&c,U=n&a^n&u^a&u;P=O|0,_=C|0,O=v|0,C=E|0,v=p|0,E=w|0,{h:p,l:w}=Z.add(l|0,h|0,R|0,A|0),l=c|0,h=u|0,c=s|0,u=a|0,s=i|0,a=n|0;const I=Z.add3L(A,B,U);i=Z.add3H(I,R,N,V),n=I|0}({h:i,l:n}=Z.add(this.Ah|0,this.Al|0,i|0,n|0)),{h:s,l:a}=Z.add(this.Bh|0,this.Bl|0,s|0,a|0),{h:c,l:u}=Z.add(this.Ch|0,this.Cl|0,c|0,u|0),{h:l,l:h}=Z.add(this.Dh|0,this.Dl|0,l|0,h|0),{h:p,l:w}=Z.add(this.Eh|0,this.El|0,p|0,w|0),{h:v,l:E}=Z.add(this.Fh|0,this.Fl|0,v|0,E|0),{h:O,l:C}=Z.add(this.Gh|0,this.Gl|0,O|0,C|0),{h:P,l:_}=Z.add(this.Hh|0,this.Hl|0,P|0,_|0),this.set(i,n,s,a,c,u,l,h,p,w,v,E,O,C,P,_)}roundClean(){$t.fill(0),Ut.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const md=Wf(()=>new bd);const rs=BigInt(0),vc=BigInt(1),vd=BigInt(2);function is(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function ns(e){if(!is(e))throw new Error("Uint8Array expected")}function nn(e,t){if(typeof t!="boolean")throw new Error(e+" boolean expected, got "+t)}const Ed=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function ss(e){ns(e);let t="";for(let r=0;r<e.length;r++)t+=Ed[e[r]];return t}function Ec(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?rs:BigInt("0x"+e)}const vt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Io(e){if(e>=vt._0&&e<=vt._9)return e-vt._0;if(e>=vt.A&&e<=vt.F)return e-(vt.A-10);if(e>=vt.a&&e<=vt.f)return e-(vt.a-10)}function _c(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const i=new Uint8Array(r);for(let n=0,s=0;n<r;n++,s+=2){const a=Io(e.charCodeAt(s)),c=Io(e.charCodeAt(s+1));if(a===void 0||c===void 0){const u=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+u+'" at index '+s)}i[n]=a*16+c}return i}function _d(e){return Ec(ss(e))}function vi(e){return ns(e),Ec(ss(Uint8Array.from(e).reverse()))}function Dc(e,t){return _c(e.toString(16).padStart(t*2,"0"))}function qn(e,t){return Dc(e,t).reverse()}function Et(e,t,r){let i;if(typeof t=="string")try{i=_c(t)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else if(is(t))i=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");const n=i.length;if(typeof r=="number"&&n!==r)throw new Error(e+" of length "+r+" expected, got "+n);return i}function Oo(...e){let t=0;for(let i=0;i<e.length;i++){const n=e[i];ns(n),t+=n.length}const r=new Uint8Array(t);for(let i=0,n=0;i<e.length;i++){const s=e[i];r.set(s,n),n+=s.length}return r}const sn=e=>typeof e=="bigint"&&rs<=e;function Dd(e,t,r){return sn(e)&&sn(t)&&sn(r)&&t<=e&&e<r}function Ar(e,t,r,i){if(!Dd(t,r,i))throw new Error("expected valid "+e+": "+r+" <= n < "+i+", got "+t)}function Sd(e){let t;for(t=0;e>rs;e>>=vc,t+=1);return t}const Id=e=>(vd<<BigInt(e-1))-vc,Od={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||is(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function os(e,t,r={}){const i=(n,s,a)=>{const c=Od[s];if(typeof c!="function")throw new Error("invalid validator function");const u=e[n];if(!(a&&u===void 0)&&!c(u,e))throw new Error("param "+String(n)+" is invalid. Expected "+s+", got "+u)};for(const[n,s]of Object.entries(t))i(n,s,!1);for(const[n,s]of Object.entries(r))i(n,s,!0);return e}function xo(e){const t=new WeakMap;return(r,...i)=>{const n=t.get(r);if(n!==void 0)return n;const s=e(r,...i);return t.set(r,s),s}}const Te=BigInt(0),De=BigInt(1),Zt=BigInt(2),xd=BigInt(3),zn=BigInt(4),Ao=BigInt(5),Ro=BigInt(8);function xe(e,t){const r=e%t;return r>=Te?r:t+r}function Ad(e,t,r){if(t<Te)throw new Error("invalid exponent, negatives unsupported");if(r<=Te)throw new Error("invalid modulus");if(r===De)return Te;let i=De;for(;t>Te;)t&De&&(i=i*e%r),e=e*e%r,t>>=De;return i}function dt(e,t,r){let i=e;for(;t-- >Te;)i*=i,i%=r;return i}function Co(e,t){if(e===Te)throw new Error("invert: expected non-zero number");if(t<=Te)throw new Error("invert: expected positive modulus, got "+t);let r=xe(e,t),i=t,n=Te,s=De;for(;r!==Te;){const a=i/r,c=i%r,u=n-s*a;i=r,r=c,n=s,s=u}if(i!==De)throw new Error("invert: does not exist");return xe(n,t)}function Rd(e){const t=(e-De)/Zt;let r,i,n;for(r=e-De,i=0;r%Zt===Te;r/=Zt,i++);for(n=Zt;n<e&&Ad(n,t,e)!==e-De;n++)if(n>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const a=(e+De)/zn;return function(c,u){const l=c.pow(u,a);if(!c.eql(c.sqr(l),u))throw new Error("Cannot find square root");return l}}const s=(r+De)/Zt;return function(a,c){if(a.pow(c,t)===a.neg(a.ONE))throw new Error("Cannot find square root");let u=i,l=a.pow(a.mul(a.ONE,n),r),h=a.pow(c,s),p=a.pow(c,r);for(;!a.eql(p,a.ONE);){if(a.eql(p,a.ZERO))return a.ZERO;let w=1;for(let E=a.sqr(p);w<u&&!a.eql(E,a.ONE);w++)E=a.sqr(E);const v=a.pow(l,De<<BigInt(u-w-1));l=a.sqr(v),h=a.mul(h,v),p=a.mul(p,l),u=w}return h}}function Cd(e){if(e%zn===xd){const t=(e+De)/zn;return function(r,i){const n=r.pow(i,t);if(!r.eql(r.sqr(n),i))throw new Error("Cannot find square root");return n}}if(e%Ro===Ao){const t=(e-Ao)/Ro;return function(r,i){const n=r.mul(i,Zt),s=r.pow(n,t),a=r.mul(i,s),c=r.mul(r.mul(a,Zt),s),u=r.mul(a,r.sub(c,r.ONE));if(!r.eql(r.sqr(u),i))throw new Error("Cannot find square root");return u}}return Rd(e)}const Nd=(e,t)=>(xe(e,t)&De)===De,Pd=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Td(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=Pd.reduce((i,n)=>(i[n]="function",i),t);return os(e,r)}function $d(e,t,r){if(r<Te)throw new Error("invalid exponent, negatives unsupported");if(r===Te)return e.ONE;if(r===De)return t;let i=e.ONE,n=t;for(;r>Te;)r&De&&(i=e.mul(i,n)),n=e.sqr(n),r>>=De;return i}function Ud(e,t){const r=new Array(t.length),i=t.reduce((s,a,c)=>e.is0(a)?s:(r[c]=s,e.mul(s,a)),e.ONE),n=e.inv(i);return t.reduceRight((s,a,c)=>e.is0(a)?s:(r[c]=e.mul(s,r[c]),e.mul(s,a)),n),r}function Sc(e,t){const r=t!==void 0?t:e.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function Ic(e,t,r=!1,i={}){if(e<=Te)throw new Error("invalid field: expected ORDER > 0, got "+e);const{nBitLength:n,nByteLength:s}=Sc(e,t);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let a;const c=Object.freeze({ORDER:e,isLE:r,BITS:n,BYTES:s,MASK:Id(n),ZERO:Te,ONE:De,create:u=>xe(u,e),isValid:u=>{if(typeof u!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof u);return Te<=u&&u<e},is0:u=>u===Te,isOdd:u=>(u&De)===De,neg:u=>xe(-u,e),eql:(u,l)=>u===l,sqr:u=>xe(u*u,e),add:(u,l)=>xe(u+l,e),sub:(u,l)=>xe(u-l,e),mul:(u,l)=>xe(u*l,e),pow:(u,l)=>$d(c,u,l),div:(u,l)=>xe(u*Co(l,e),e),sqrN:u=>u*u,addN:(u,l)=>u+l,subN:(u,l)=>u-l,mulN:(u,l)=>u*l,inv:u=>Co(u,e),sqrt:i.sqrt||(u=>(a||(a=Cd(e)),a(c,u))),invertBatch:u=>Ud(c,u),cmov:(u,l,h)=>h?l:u,toBytes:u=>r?qn(u,s):Dc(u,s),fromBytes:u=>{if(u.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+u.length);return r?vi(u):_d(u)}});return Object.freeze(c)}const No=BigInt(0),hi=BigInt(1);function on(e,t){const r=t.negate();return e?r:t}function Oc(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function an(e,t){Oc(e,t);const r=Math.ceil(t/e)+1,i=2**(e-1);return{windows:r,windowSize:i}}function Fd(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((r,i)=>{if(!(r instanceof t))throw new Error("invalid point at index "+i)})}function Ld(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((r,i)=>{if(!t.isValid(r))throw new Error("invalid scalar at index "+i)})}const cn=new WeakMap,xc=new WeakMap;function un(e){return xc.get(e)||1}function Md(e,t){return{constTimeNegate:on,hasPrecomputes(r){return un(r)!==1},unsafeLadder(r,i,n=e.ZERO){let s=r;for(;i>No;)i&hi&&(n=n.add(s)),s=s.double(),i>>=hi;return n},precomputeWindow(r,i){const{windows:n,windowSize:s}=an(i,t),a=[];let c=r,u=c;for(let l=0;l<n;l++){u=c,a.push(u);for(let h=1;h<s;h++)u=u.add(c),a.push(u);c=u.double()}return a},wNAF(r,i,n){const{windows:s,windowSize:a}=an(r,t);let c=e.ZERO,u=e.BASE;const l=BigInt(2**r-1),h=2**r,p=BigInt(r);for(let w=0;w<s;w++){const v=w*a;let E=Number(n&l);n>>=p,E>a&&(E-=h,n+=hi);const O=v,C=v+Math.abs(E)-1,P=w%2!==0,_=E<0;E===0?u=u.add(on(P,i[O])):c=c.add(on(_,i[C]))}return{p:c,f:u}},wNAFUnsafe(r,i,n,s=e.ZERO){const{windows:a,windowSize:c}=an(r,t),u=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let p=0;p<a;p++){const w=p*c;if(n===No)break;let v=Number(n&u);if(n>>=h,v>c&&(v-=l,n+=hi),v===0)continue;let E=i[w+Math.abs(v)-1];v<0&&(E=E.negate()),s=s.add(E)}return s},getPrecomputes(r,i,n){let s=cn.get(i);return s||(s=this.precomputeWindow(i,r),r!==1&&cn.set(i,n(s))),s},wNAFCached(r,i,n){const s=un(r);return this.wNAF(s,this.getPrecomputes(s,r,n),i)},wNAFCachedUnsafe(r,i,n,s){const a=un(r);return a===1?this.unsafeLadder(r,i,s):this.wNAFUnsafe(a,this.getPrecomputes(a,r,n),i,s)},setWindowSize(r,i){Oc(i,t),xc.set(r,i),cn.delete(r)}}}function Bd(e,t,r,i){if(Fd(r,e),Ld(i,t),r.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const n=e.ZERO,s=Sd(BigInt(r.length)),a=s>12?s-3:s>4?s-2:s?2:1,c=(1<<a)-1,u=new Array(c+1).fill(n),l=Math.floor((t.BITS-1)/a)*a;let h=n;for(let p=l;p>=0;p-=a){u.fill(n);for(let v=0;v<i.length;v++){const E=i[v],O=Number(E>>BigInt(p)&BigInt(c));u[O]=u[O].add(r[v])}let w=n;for(let v=u.length-1,E=n;v>0;v--)E=E.add(u[v]),w=w.add(E);if(h=h.add(w),p!==0)for(let v=0;v<a;v++)h=h.double()}return h}function jd(e){return Td(e.Fp),os(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Sc(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}const st=BigInt(0),He=BigInt(1),fi=BigInt(2),qd=BigInt(8),zd={zip215:!0};function Kd(e){const t=jd(e);return os(e,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}function Vd(e){const t=Kd(e),{Fp:r,n:i,prehash:n,hash:s,randomBytes:a,nByteLength:c,h:u}=t,l=fi<<BigInt(c*8)-He,h=r.create,p=Ic(t.n,t.nBitLength),w=t.uvRatio||((I,b)=>{try{return{isValid:!0,value:r.sqrt(I*r.inv(b))}}catch{return{isValid:!1,value:st}}}),v=t.adjustScalarBytes||(I=>I),E=t.domain||((I,b,S)=>{if(nn("phflag",S),b.length||S)throw new Error("Contexts/pre-hash are not supported");return I});function O(I,b){Ar("coordinate "+I,b,st,l)}function C(I){if(!(I instanceof D))throw new Error("ExtendedPoint expected")}const P=xo((I,b)=>{const{ex:S,ey:T,ez:q}=I,L=I.is0();b==null&&(b=L?qd:r.inv(q));const H=h(S*b),K=h(T*b),$=h(q*b);if(L)return{x:st,y:He};if($!==He)throw new Error("invZ was invalid");return{x:H,y:K}}),_=xo(I=>{const{a:b,d:S}=t;if(I.is0())throw new Error("bad point: ZERO");const{ex:T,ey:q,ez:L,et:H}=I,K=h(T*T),$=h(q*q),j=h(L*L),M=h(j*j),k=h(K*b),Q=h(j*h(k+$)),Y=h(M+h(S*h(K*$)));if(Q!==Y)throw new Error("bad point: equation left != right (1)");const J=h(T*q),ee=h(L*H);if(J!==ee)throw new Error("bad point: equation left != right (2)");return!0});class D{constructor(b,S,T,q){this.ex=b,this.ey=S,this.ez=T,this.et=q,O("x",b),O("y",S),O("z",T),O("t",q),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(b){if(b instanceof D)throw new Error("extended point not allowed");const{x:S,y:T}=b||{};return O("x",S),O("y",T),new D(S,T,He,h(S*T))}static normalizeZ(b){const S=r.invertBatch(b.map(T=>T.ez));return b.map((T,q)=>T.toAffine(S[q])).map(D.fromAffine)}static msm(b,S){return Bd(D,p,b,S)}_setWindowSize(b){f.setWindowSize(this,b)}assertValidity(){_(this)}equals(b){C(b);const{ex:S,ey:T,ez:q}=this,{ex:L,ey:H,ez:K}=b,$=h(S*K),j=h(L*q),M=h(T*K),k=h(H*q);return $===j&&M===k}is0(){return this.equals(D.ZERO)}negate(){return new D(h(-this.ex),this.ey,this.ez,h(-this.et))}double(){const{a:b}=t,{ex:S,ey:T,ez:q}=this,L=h(S*S),H=h(T*T),K=h(fi*h(q*q)),$=h(b*L),j=S+T,M=h(h(j*j)-L-H),k=$+H,Q=k-K,Y=$-H,J=h(M*Q),ee=h(k*Y),re=h(M*Y),ie=h(Q*k);return new D(J,ee,ie,re)}add(b){C(b);const{a:S,d:T}=t,{ex:q,ey:L,ez:H,et:K}=this,{ex:$,ey:j,ez:M,et:k}=b;if(S===BigInt(-1)){const qt=h((L-q)*(j+$)),de=h((L+q)*(j-$)),le=h(de-qt);if(le===st)return this.double();const pe=h(H*fi*k),ge=h(K*fi*M),ye=ge+pe,we=de+qt,be=ge-pe,ce=h(ye*le),he=h(we*be),me=h(ye*be),se=h(le*we);return new D(ce,he,se,me)}const Q=h(q*$),Y=h(L*j),J=h(K*T*k),ee=h(H*M),re=h((q+L)*($+j)-Q-Y),ie=ee-J,ne=ee+J,Je=h(Y-S*Q),lt=h(re*ie),wt=h(ne*Je),Ct=h(re*Je),jt=h(ie*ne);return new D(lt,wt,jt,Ct)}subtract(b){return this.add(b.negate())}wNAF(b){return f.wNAFCached(this,b,D.normalizeZ)}multiply(b){const S=b;Ar("scalar",S,He,i);const{p:T,f:q}=this.wNAF(S);return D.normalizeZ([T,q])[0]}multiplyUnsafe(b,S=D.ZERO){const T=b;return Ar("scalar",T,st,i),T===st?y:this.is0()||T===He?this:f.wNAFCachedUnsafe(this,T,D.normalizeZ,S)}isSmallOrder(){return this.multiplyUnsafe(u).is0()}isTorsionFree(){return f.unsafeLadder(this,i).is0()}toAffine(b){return P(this,b)}clearCofactor(){const{h:b}=t;return b===He?this:this.multiplyUnsafe(b)}static fromHex(b,S=!1){const{d:T,a:q}=t,L=r.BYTES;b=Et("pointHex",b,L),nn("zip215",S);const H=b.slice(),K=b[L-1];H[L-1]=K&-129;const $=vi(H),j=S?l:r.ORDER;Ar("pointHex.y",$,st,j);const M=h($*$),k=h(M-He),Q=h(T*M-q);let{isValid:Y,value:J}=w(k,Q);if(!Y)throw new Error("Point.fromHex: invalid y coordinate");const ee=(J&He)===He,re=(K&128)!==0;if(!S&&J===st&&re)throw new Error("Point.fromHex: x=0 and x_0=1");return re!==ee&&(J=h(-J)),D.fromAffine({x:J,y:$})}static fromPrivateKey(b){return R(b).point}toRawBytes(){const{x:b,y:S}=this.toAffine(),T=qn(S,r.BYTES);return T[T.length-1]|=b&He?128:0,T}toHex(){return ss(this.toRawBytes())}}D.BASE=new D(t.Gx,t.Gy,He,h(t.Gx*t.Gy)),D.ZERO=new D(st,He,He,st);const{BASE:g,ZERO:y}=D,f=Md(D,c*8);function o(I){return xe(I,i)}function d(I){return o(vi(I))}function R(I){const b=r.BYTES;I=Et("private key",I,b);const S=Et("hashed private key",s(I),2*b),T=v(S.slice(0,b)),q=S.slice(b,2*b),L=d(T),H=g.multiply(L),K=H.toRawBytes();return{head:T,prefix:q,scalar:L,point:H,pointBytes:K}}function A(I){return R(I).pointBytes}function N(I=new Uint8Array,...b){const S=Oo(...b);return d(s(E(S,Et("context",I),!!n)))}function B(I,b,S={}){I=Et("message",I),n&&(I=n(I));const{prefix:T,scalar:q,pointBytes:L}=R(b),H=N(S.context,T,I),K=g.multiply(H).toRawBytes(),$=N(S.context,K,L,I),j=o(H+$*q);Ar("signature.s",j,st,i);const M=Oo(K,qn(j,r.BYTES));return Et("result",M,r.BYTES*2)}const V=zd;function U(I,b,S,T=V){const{context:q,zip215:L}=T,H=r.BYTES;I=Et("signature",I,2*H),b=Et("message",b),S=Et("publicKey",S,H),L!==void 0&&nn("zip215",L),n&&(b=n(b));const K=vi(I.slice(H,2*H));let $,j,M;try{$=D.fromHex(S,L),j=D.fromHex(I.slice(0,H),L),M=g.multiplyUnsafe(K)}catch{return!1}if(!L&&$.isSmallOrder())return!1;const k=N(q,j.toRawBytes(),$.toRawBytes(),b);return j.add($.multiplyUnsafe(k)).subtract(M).clearCofactor().equals(D.ZERO)}return g._setWindowSize(8),{CURVE:t,getPublicKey:A,sign:B,verify:U,ExtendedPoint:D,utils:{getExtendedPublicKey:R,randomPrivateKey:()=>a(r.BYTES),precompute(I=8,b=D.BASE){return b._setWindowSize(I),b.multiply(BigInt(3)),b}}}}BigInt(0),BigInt(1);const as=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Po=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Hd=BigInt(1),To=BigInt(2);BigInt(3);const Wd=BigInt(5),kd=BigInt(8);function Gd(e){const t=BigInt(10),r=BigInt(20),i=BigInt(40),n=BigInt(80),s=as,a=e*e%s*e%s,c=dt(a,To,s)*a%s,u=dt(c,Hd,s)*e%s,l=dt(u,Wd,s)*u%s,h=dt(l,t,s)*l%s,p=dt(h,r,s)*h%s,w=dt(p,i,s)*p%s,v=dt(w,n,s)*w%s,E=dt(v,n,s)*w%s,O=dt(E,t,s)*l%s;return{pow_p_5_8:dt(O,To,s)*e%s,b2:a}}function Yd(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}function Jd(e,t){const r=as,i=xe(t*t*t,r),n=xe(i*i*t,r),s=Gd(e*n).pow_p_5_8;let a=xe(e*i*s,r);const c=xe(t*a*a,r),u=a,l=xe(a*Po,r),h=c===e,p=c===xe(-e,r),w=c===xe(-e*Po,r);return h&&(a=u),(p||w)&&(a=l),Nd(a,r)&&(a=xe(-a,r)),{isValid:h||p,value:a}}const Qd=Ic(as,void 0,!0),Xd={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Qd,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:kd,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:md,randomBytes:bc,adjustScalarBytes:Yd,uvRatio:Jd},Ac=Vd(Xd),Zd="EdDSA",ep="JWT",Rc=".",Cc="base64url",tp="utf8",rp="utf8",ip=":",np="did",sp="key",$o="base58btc",op="z",ap="K36",cp=32;function cs(e){return globalThis.Buffer!=null?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function Nc(e=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?cs(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Pc(e,t){t||(t=e.reduce((n,s)=>n+s.length,0));const r=Nc(t);let i=0;for(const n of e)r.set(n,i),i+=n.length;return cs(r)}function up(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<e.length;n++){var s=e.charAt(n),a=s.charCodeAt(0);if(r[a]!==255)throw new TypeError(s+" is ambiguous");r[a]=n}var c=e.length,u=e.charAt(0),l=Math.log(c)/Math.log(256),h=Math.log(256)/Math.log(c);function p(E){if(E instanceof Uint8Array||(ArrayBuffer.isView(E)?E=new Uint8Array(E.buffer,E.byteOffset,E.byteLength):Array.isArray(E)&&(E=Uint8Array.from(E))),!(E instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(E.length===0)return"";for(var O=0,C=0,P=0,_=E.length;P!==_&&E[P]===0;)P++,O++;for(var D=(_-P)*h+1>>>0,g=new Uint8Array(D);P!==_;){for(var y=E[P],f=0,o=D-1;(y!==0||f<C)&&o!==-1;o--,f++)y+=256*g[o]>>>0,g[o]=y%c>>>0,y=y/c>>>0;if(y!==0)throw new Error("Non-zero carry");C=f,P++}for(var d=D-C;d!==D&&g[d]===0;)d++;for(var R=u.repeat(O);d<D;++d)R+=e.charAt(g[d]);return R}function w(E){if(typeof E!="string")throw new TypeError("Expected String");if(E.length===0)return new Uint8Array;var O=0;if(E[O]!==" "){for(var C=0,P=0;E[O]===u;)C++,O++;for(var _=(E.length-O)*l+1>>>0,D=new Uint8Array(_);E[O];){var g=r[E.charCodeAt(O)];if(g===255)return;for(var y=0,f=_-1;(g!==0||y<P)&&f!==-1;f--,y++)g+=c*D[f]>>>0,D[f]=g%256>>>0,g=g/256>>>0;if(g!==0)throw new Error("Non-zero carry");P=y,O++}if(E[O]!==" "){for(var o=_-P;o!==_&&D[o]===0;)o++;for(var d=new Uint8Array(C+(_-o)),R=C;o!==_;)d[R++]=D[o++];return d}}}function v(E){var O=w(E);if(O)return O;throw new Error(`Non-${t} character`)}return{encode:p,decodeUnsafe:w,decode:v}}var lp=up,hp=lp;const Tc=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},fp=e=>new TextEncoder().encode(e),dp=e=>new TextDecoder().decode(e);let pp=class{constructor(t,r,i){this.name=t,this.prefix=r,this.baseEncode=i}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},gp=class{constructor(t,r,i){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return $c(this,t)}};class yp{constructor(t){this.decoders=t}or(t){return $c(this,t)}decode(t){const r=t[0],i=this.decoders[r];if(i)return i.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const $c=(e,t)=>new yp({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});let wp=class{constructor(t,r,i,n){this.name=t,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new pp(t,r,i),this.decoder=new gp(t,r,n)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};const Ci=({name:e,prefix:t,encode:r,decode:i})=>new wp(e,t,r,i),Wr=({prefix:e,name:t,alphabet:r})=>{const{encode:i,decode:n}=hp(r,t);return Ci({prefix:e,name:t,encode:i,decode:s=>Tc(n(s))})},bp=(e,t,r,i)=>{const n={};for(let h=0;h<t.length;++h)n[t[h]]=h;let s=e.length;for(;e[s-1]==="=";)--s;const a=new Uint8Array(s*r/8|0);let c=0,u=0,l=0;for(let h=0;h<s;++h){const p=n[e[h]];if(p===void 0)throw new SyntaxError(`Non-${i} character`);u=u<<r|p,c+=r,c>=8&&(c-=8,a[l++]=255&u>>c)}if(c>=r||255&u<<8-c)throw new SyntaxError("Unexpected end of data");return a},mp=(e,t,r)=>{const i=t[t.length-1]==="=",n=(1<<r)-1;let s="",a=0,c=0;for(let u=0;u<e.length;++u)for(c=c<<8|e[u],a+=8;a>r;)a-=r,s+=t[n&c>>a];if(a&&(s+=t[n&c<<r-a]),i)for(;s.length*r&7;)s+="=";return s},Ue=({name:e,prefix:t,bitsPerChar:r,alphabet:i})=>Ci({prefix:t,name:e,encode(n){return mp(n,i,r)},decode(n){return bp(n,i,r,e)}}),vp=Ci({prefix:"\0",name:"identity",encode:e=>dp(e),decode:e=>fp(e)});var Ep=Object.freeze({__proto__:null,identity:vp});const _p=Ue({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Dp=Object.freeze({__proto__:null,base2:_p});const Sp=Ue({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Ip=Object.freeze({__proto__:null,base8:Sp});const Op=Wr({prefix:"9",name:"base10",alphabet:"0123456789"});var xp=Object.freeze({__proto__:null,base10:Op});const Ap=Ue({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Rp=Ue({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Cp=Object.freeze({__proto__:null,base16:Ap,base16upper:Rp});const Np=Ue({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Pp=Ue({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Tp=Ue({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),$p=Ue({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Up=Ue({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Fp=Ue({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Lp=Ue({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Mp=Ue({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Bp=Ue({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var jp=Object.freeze({__proto__:null,base32:Np,base32upper:Pp,base32pad:Tp,base32padupper:$p,base32hex:Up,base32hexupper:Fp,base32hexpad:Lp,base32hexpadupper:Mp,base32z:Bp});const qp=Wr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),zp=Wr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Kp=Object.freeze({__proto__:null,base36:qp,base36upper:zp});const Vp=Wr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Hp=Wr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Wp=Object.freeze({__proto__:null,base58btc:Vp,base58flickr:Hp});const kp=Ue({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Gp=Ue({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Yp=Ue({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Jp=Ue({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Qp=Object.freeze({__proto__:null,base64:kp,base64pad:Gp,base64url:Yp,base64urlpad:Jp});const Uc=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Xp=Uc.reduce((e,t,r)=>(e[r]=t,e),[]),Zp=Uc.reduce((e,t,r)=>(e[t.codePointAt(0)]=r,e),[]);function eg(e){return e.reduce((t,r)=>(t+=Xp[r],t),"")}function tg(e){const t=[];for(const r of e){const i=Zp[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(i)}return new Uint8Array(t)}const rg=Ci({prefix:"🚀",name:"base256emoji",encode:eg,decode:tg});var ig=Object.freeze({__proto__:null,base256emoji:rg}),ng=Fc,Uo=128,sg=-128,og=Math.pow(2,31);function Fc(e,t,r){t=t||[],r=r||0;for(var i=r;e>=og;)t[r++]=e&255|Uo,e/=128;for(;e&sg;)t[r++]=e&255|Uo,e>>>=7;return t[r]=e|0,Fc.bytes=r-i+1,t}var ag=Kn,cg=128,Fo=127;function Kn(e,i){var r=0,i=i||0,n=0,s=i,a,c=e.length;do{if(s>=c)throw Kn.bytes=0,new RangeError("Could not decode varint");a=e[s++],r+=n<28?(a&Fo)<<n:(a&Fo)*Math.pow(2,n),n+=7}while(a>=cg);return Kn.bytes=s-i,r}var ug=Math.pow(2,7),lg=Math.pow(2,14),hg=Math.pow(2,21),fg=Math.pow(2,28),dg=Math.pow(2,35),pg=Math.pow(2,42),gg=Math.pow(2,49),yg=Math.pow(2,56),wg=Math.pow(2,63),bg=function(e){return e<ug?1:e<lg?2:e<hg?3:e<fg?4:e<dg?5:e<pg?6:e<gg?7:e<yg?8:e<wg?9:10},mg={encode:ng,decode:ag,encodingLength:bg},Lc=mg;const Lo=(e,t,r=0)=>(Lc.encode(e,t,r),t),Mo=e=>Lc.encodingLength(e),Vn=(e,t)=>{const r=t.byteLength,i=Mo(e),n=i+Mo(r),s=new Uint8Array(n+r);return Lo(e,s,0),Lo(r,s,i),s.set(t,n),new vg(e,r,t,s)};class vg{constructor(t,r,i,n){this.code=t,this.size=r,this.digest=i,this.bytes=n}}const Mc=({name:e,code:t,encode:r})=>new Eg(e,t,r);class Eg{constructor(t,r,i){this.name=t,this.code=r,this.encode=i}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?Vn(this.code,r):r.then(i=>Vn(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Bc=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),_g=Mc({name:"sha2-256",code:18,encode:Bc("SHA-256")}),Dg=Mc({name:"sha2-512",code:19,encode:Bc("SHA-512")});var Sg=Object.freeze({__proto__:null,sha256:_g,sha512:Dg});const jc=0,Ig="identity",qc=Tc,Og=e=>Vn(jc,qc(e)),xg={code:jc,name:Ig,encode:qc,digest:Og};var Ag=Object.freeze({__proto__:null,identity:xg});new TextEncoder,new TextDecoder;const Bo={...Ep,...Dp,...Ip,...xp,...Cp,...jp,...Kp,...Wp,...Qp,...ig};({...Sg,...Ag});function zc(e,t,r,i){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:i}}}const jo=zc("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),ln=zc("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);const t=Nc(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),Kc={utf8:jo,"utf-8":jo,hex:Bo.base16,latin1:ln,ascii:ln,binary:ln,...Bo};function us(e,t="utf8"){const r=Kc[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8"):r.encoder.encode(e).substring(1)}function ls(e,t="utf8"){const r=Kc[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?cs(globalThis.Buffer.from(e,"utf-8")):r.decoder.decode(`${r.prefix}${e}`)}function Di(e){return us(ls(Kr(e),tp),Cc)}function Vc(e){const t=ls(ap,$o),r=op+us(Pc([t,e]),$o);return[np,sp,r].join(ip)}function Rg(e){return us(e,Cc)}function Cg(e){return ls([Di(e.header),Di(e.payload)].join(Rc),rp)}function Ng(e){return[Di(e.header),Di(e.payload),Rg(e.signature)].join(Rc)}function qo(e=bc(cp)){const t=Ac.getPublicKey(e);return{secretKey:Pc([e,t]),publicKey:t}}async function Pg(e,t,r,i,n=G.fromMiliseconds(Date.now())){const s={alg:Zd,typ:ep},a=Vc(i.publicKey),c=n+r,u={iss:a,sub:e,aud:t,iat:n,exp:c},l=Cg({header:s,payload:u}),h=Ac.sign(l,i.secretKey.slice(0,32));return Ng({header:s,payload:u,signature:h})}var hn={},Rr={},te={},fn={},zo;function Tg(){return zo||(zo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});function t(c,u){var l=c>>>16&65535,h=c&65535,p=u>>>16&65535,w=u&65535;return h*w+(l*w+h*p<<16>>>0)|0}e.mul=Math.imul||t;function r(c,u){return c+u|0}e.add=r;function i(c,u){return c-u|0}e.sub=i;function n(c,u){return c<<u|c>>>32-u}e.rotl=n;function s(c,u){return c<<32-u|c>>>u}e.rotr=s;function a(c){return typeof c=="number"&&isFinite(c)&&Math.floor(c)===c}e.isInteger=Number.isInteger||a,e.MAX_SAFE_INTEGER=9007199254740991,e.isSafeInteger=function(c){return e.isInteger(c)&&c>=-e.MAX_SAFE_INTEGER&&c<=e.MAX_SAFE_INTEGER}}(fn)),fn}var Ko;function Ni(){if(Ko)return te;Ko=1,Object.defineProperty(te,"__esModule",{value:!0});var e=Tg();function t(I,b){return b===void 0&&(b=0),(I[b+0]<<8|I[b+1])<<16>>16}te.readInt16BE=t;function r(I,b){return b===void 0&&(b=0),(I[b+0]<<8|I[b+1])>>>0}te.readUint16BE=r;function i(I,b){return b===void 0&&(b=0),(I[b+1]<<8|I[b])<<16>>16}te.readInt16LE=i;function n(I,b){return b===void 0&&(b=0),(I[b+1]<<8|I[b])>>>0}te.readUint16LE=n;function s(I,b,S){return b===void 0&&(b=new Uint8Array(2)),S===void 0&&(S=0),b[S+0]=I>>>8,b[S+1]=I>>>0,b}te.writeUint16BE=s,te.writeInt16BE=s;function a(I,b,S){return b===void 0&&(b=new Uint8Array(2)),S===void 0&&(S=0),b[S+0]=I>>>0,b[S+1]=I>>>8,b}te.writeUint16LE=a,te.writeInt16LE=a;function c(I,b){return b===void 0&&(b=0),I[b]<<24|I[b+1]<<16|I[b+2]<<8|I[b+3]}te.readInt32BE=c;function u(I,b){return b===void 0&&(b=0),(I[b]<<24|I[b+1]<<16|I[b+2]<<8|I[b+3])>>>0}te.readUint32BE=u;function l(I,b){return b===void 0&&(b=0),I[b+3]<<24|I[b+2]<<16|I[b+1]<<8|I[b]}te.readInt32LE=l;function h(I,b){return b===void 0&&(b=0),(I[b+3]<<24|I[b+2]<<16|I[b+1]<<8|I[b])>>>0}te.readUint32LE=h;function p(I,b,S){return b===void 0&&(b=new Uint8Array(4)),S===void 0&&(S=0),b[S+0]=I>>>24,b[S+1]=I>>>16,b[S+2]=I>>>8,b[S+3]=I>>>0,b}te.writeUint32BE=p,te.writeInt32BE=p;function w(I,b,S){return b===void 0&&(b=new Uint8Array(4)),S===void 0&&(S=0),b[S+0]=I>>>0,b[S+1]=I>>>8,b[S+2]=I>>>16,b[S+3]=I>>>24,b}te.writeUint32LE=w,te.writeInt32LE=w;function v(I,b){b===void 0&&(b=0);var S=c(I,b),T=c(I,b+4);return S*4294967296+T-(T>>31)*4294967296}te.readInt64BE=v;function E(I,b){b===void 0&&(b=0);var S=u(I,b),T=u(I,b+4);return S*4294967296+T}te.readUint64BE=E;function O(I,b){b===void 0&&(b=0);var S=l(I,b),T=l(I,b+4);return T*4294967296+S-(S>>31)*4294967296}te.readInt64LE=O;function C(I,b){b===void 0&&(b=0);var S=h(I,b),T=h(I,b+4);return T*4294967296+S}te.readUint64LE=C;function P(I,b,S){return b===void 0&&(b=new Uint8Array(8)),S===void 0&&(S=0),p(I/4294967296>>>0,b,S),p(I>>>0,b,S+4),b}te.writeUint64BE=P,te.writeInt64BE=P;function _(I,b,S){return b===void 0&&(b=new Uint8Array(8)),S===void 0&&(S=0),w(I>>>0,b,S),w(I/4294967296>>>0,b,S+4),b}te.writeUint64LE=_,te.writeInt64LE=_;function D(I,b,S){if(S===void 0&&(S=0),I%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(I/8>b.length-S)throw new Error("readUintBE: array is too short for the given bitLength");for(var T=0,q=1,L=I/8+S-1;L>=S;L--)T+=b[L]*q,q*=256;return T}te.readUintBE=D;function g(I,b,S){if(S===void 0&&(S=0),I%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(I/8>b.length-S)throw new Error("readUintLE: array is too short for the given bitLength");for(var T=0,q=1,L=S;L<S+I/8;L++)T+=b[L]*q,q*=256;return T}te.readUintLE=g;function y(I,b,S,T){if(S===void 0&&(S=new Uint8Array(I/8)),T===void 0&&(T=0),I%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!e.isSafeInteger(b))throw new Error("writeUintBE value must be an integer");for(var q=1,L=I/8+T-1;L>=T;L--)S[L]=b/q&255,q*=256;return S}te.writeUintBE=y;function f(I,b,S,T){if(S===void 0&&(S=new Uint8Array(I/8)),T===void 0&&(T=0),I%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!e.isSafeInteger(b))throw new Error("writeUintLE value must be an integer");for(var q=1,L=T;L<T+I/8;L++)S[L]=b/q&255,q*=256;return S}te.writeUintLE=f;function o(I,b){b===void 0&&(b=0);var S=new DataView(I.buffer,I.byteOffset,I.byteLength);return S.getFloat32(b)}te.readFloat32BE=o;function d(I,b){b===void 0&&(b=0);var S=new DataView(I.buffer,I.byteOffset,I.byteLength);return S.getFloat32(b,!0)}te.readFloat32LE=d;function R(I,b){b===void 0&&(b=0);var S=new DataView(I.buffer,I.byteOffset,I.byteLength);return S.getFloat64(b)}te.readFloat64BE=R;function A(I,b){b===void 0&&(b=0);var S=new DataView(I.buffer,I.byteOffset,I.byteLength);return S.getFloat64(b,!0)}te.readFloat64LE=A;function N(I,b,S){b===void 0&&(b=new Uint8Array(4)),S===void 0&&(S=0);var T=new DataView(b.buffer,b.byteOffset,b.byteLength);return T.setFloat32(S,I),b}te.writeFloat32BE=N;function B(I,b,S){b===void 0&&(b=new Uint8Array(4)),S===void 0&&(S=0);var T=new DataView(b.buffer,b.byteOffset,b.byteLength);return T.setFloat32(S,I,!0),b}te.writeFloat32LE=B;function V(I,b,S){b===void 0&&(b=new Uint8Array(8)),S===void 0&&(S=0);var T=new DataView(b.buffer,b.byteOffset,b.byteLength);return T.setFloat64(S,I),b}te.writeFloat64BE=V;function U(I,b,S){b===void 0&&(b=new Uint8Array(8)),S===void 0&&(S=0);var T=new DataView(b.buffer,b.byteOffset,b.byteLength);return T.setFloat64(S,I,!0),b}return te.writeFloat64LE=U,te}var di={},Vo;function Rt(){if(Vo)return di;Vo=1,Object.defineProperty(di,"__esModule",{value:!0});function e(t){for(var r=0;r<t.length;r++)t[r]=0;return t}return di.wipe=e,di}var Ho;function $g(){if(Ho)return Rr;Ho=1,Object.defineProperty(Rr,"__esModule",{value:!0});var e=Ni(),t=Rt(),r=20;function i(c,u,l){for(var h=1634760805,p=857760878,w=2036477234,v=1797285236,E=l[3]<<24|l[2]<<16|l[1]<<8|l[0],O=l[7]<<24|l[6]<<16|l[5]<<8|l[4],C=l[11]<<24|l[10]<<16|l[9]<<8|l[8],P=l[15]<<24|l[14]<<16|l[13]<<8|l[12],_=l[19]<<24|l[18]<<16|l[17]<<8|l[16],D=l[23]<<24|l[22]<<16|l[21]<<8|l[20],g=l[27]<<24|l[26]<<16|l[25]<<8|l[24],y=l[31]<<24|l[30]<<16|l[29]<<8|l[28],f=u[3]<<24|u[2]<<16|u[1]<<8|u[0],o=u[7]<<24|u[6]<<16|u[5]<<8|u[4],d=u[11]<<24|u[10]<<16|u[9]<<8|u[8],R=u[15]<<24|u[14]<<16|u[13]<<8|u[12],A=h,N=p,B=w,V=v,U=E,I=O,b=C,S=P,T=_,q=D,L=g,H=y,K=f,$=o,j=d,M=R,k=0;k<r;k+=2)A=A+U|0,K^=A,K=K>>>16|K<<16,T=T+K|0,U^=T,U=U>>>20|U<<12,N=N+I|0,$^=N,$=$>>>16|$<<16,q=q+$|0,I^=q,I=I>>>20|I<<12,B=B+b|0,j^=B,j=j>>>16|j<<16,L=L+j|0,b^=L,b=b>>>20|b<<12,V=V+S|0,M^=V,M=M>>>16|M<<16,H=H+M|0,S^=H,S=S>>>20|S<<12,B=B+b|0,j^=B,j=j>>>24|j<<8,L=L+j|0,b^=L,b=b>>>25|b<<7,V=V+S|0,M^=V,M=M>>>24|M<<8,H=H+M|0,S^=H,S=S>>>25|S<<7,N=N+I|0,$^=N,$=$>>>24|$<<8,q=q+$|0,I^=q,I=I>>>25|I<<7,A=A+U|0,K^=A,K=K>>>24|K<<8,T=T+K|0,U^=T,U=U>>>25|U<<7,A=A+I|0,M^=A,M=M>>>16|M<<16,L=L+M|0,I^=L,I=I>>>20|I<<12,N=N+b|0,K^=N,K=K>>>16|K<<16,H=H+K|0,b^=H,b=b>>>20|b<<12,B=B+S|0,$^=B,$=$>>>16|$<<16,T=T+$|0,S^=T,S=S>>>20|S<<12,V=V+U|0,j^=V,j=j>>>16|j<<16,q=q+j|0,U^=q,U=U>>>20|U<<12,B=B+S|0,$^=B,$=$>>>24|$<<8,T=T+$|0,S^=T,S=S>>>25|S<<7,V=V+U|0,j^=V,j=j>>>24|j<<8,q=q+j|0,U^=q,U=U>>>25|U<<7,N=N+b|0,K^=N,K=K>>>24|K<<8,H=H+K|0,b^=H,b=b>>>25|b<<7,A=A+I|0,M^=A,M=M>>>24|M<<8,L=L+M|0,I^=L,I=I>>>25|I<<7;e.writeUint32LE(A+h|0,c,0),e.writeUint32LE(N+p|0,c,4),e.writeUint32LE(B+w|0,c,8),e.writeUint32LE(V+v|0,c,12),e.writeUint32LE(U+E|0,c,16),e.writeUint32LE(I+O|0,c,20),e.writeUint32LE(b+C|0,c,24),e.writeUint32LE(S+P|0,c,28),e.writeUint32LE(T+_|0,c,32),e.writeUint32LE(q+D|0,c,36),e.writeUint32LE(L+g|0,c,40),e.writeUint32LE(H+y|0,c,44),e.writeUint32LE(K+f|0,c,48),e.writeUint32LE($+o|0,c,52),e.writeUint32LE(j+d|0,c,56),e.writeUint32LE(M+R|0,c,60)}function n(c,u,l,h,p){if(p===void 0&&(p=0),c.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(h.length<l.length)throw new Error("ChaCha: destination is shorter than source");var w,v;if(p===0){if(u.length!==8&&u.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");w=new Uint8Array(16),v=w.length-u.length,w.set(u,v)}else{if(u.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");w=u,v=p}for(var E=new Uint8Array(64),O=0;O<l.length;O+=64){i(E,w,c);for(var C=O;C<O+64&&C<l.length;C++)h[C]=l[C]^E[C-O];a(w,0,v)}return t.wipe(E),p===0&&t.wipe(w),h}Rr.streamXOR=n;function s(c,u,l,h){return h===void 0&&(h=0),t.wipe(l),n(c,u,l,l,h)}Rr.stream=s;function a(c,u,l){for(var h=1;l--;)h=h+(c[u]&255)|0,c[u]=h&255,h>>>=8,u++;if(h>0)throw new Error("ChaCha: counter overflow")}return Rr}var dn={},Xt={},Wo;function hs(){if(Wo)return Xt;Wo=1,Object.defineProperty(Xt,"__esModule",{value:!0});function e(n,s,a){return~(n-1)&s|n-1&a}Xt.select=e;function t(n,s){return(n|0)-(s|0)-1>>>31&1}Xt.lessOrEqual=t;function r(n,s){if(n.length!==s.length)return 0;for(var a=0,c=0;c<n.length;c++)a|=n[c]^s[c];return 1&a-1>>>8}Xt.compare=r;function i(n,s){return n.length===0||s.length===0?!1:r(n,s)!==0}return Xt.equal=i,Xt}var ko;function Ug(){return ko||(ko=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=hs(),r=Rt();e.DIGEST_LENGTH=16;var i=function(){function a(c){this.digestLength=e.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var u=c[0]|c[1]<<8;this._r[0]=u&8191;var l=c[2]|c[3]<<8;this._r[1]=(u>>>13|l<<3)&8191;var h=c[4]|c[5]<<8;this._r[2]=(l>>>10|h<<6)&7939;var p=c[6]|c[7]<<8;this._r[3]=(h>>>7|p<<9)&8191;var w=c[8]|c[9]<<8;this._r[4]=(p>>>4|w<<12)&255,this._r[5]=w>>>1&8190;var v=c[10]|c[11]<<8;this._r[6]=(w>>>14|v<<2)&8191;var E=c[12]|c[13]<<8;this._r[7]=(v>>>11|E<<5)&8065;var O=c[14]|c[15]<<8;this._r[8]=(E>>>8|O<<8)&8191,this._r[9]=O>>>5&127,this._pad[0]=c[16]|c[17]<<8,this._pad[1]=c[18]|c[19]<<8,this._pad[2]=c[20]|c[21]<<8,this._pad[3]=c[22]|c[23]<<8,this._pad[4]=c[24]|c[25]<<8,this._pad[5]=c[26]|c[27]<<8,this._pad[6]=c[28]|c[29]<<8,this._pad[7]=c[30]|c[31]<<8}return a.prototype._blocks=function(c,u,l){for(var h=this._fin?0:2048,p=this._h[0],w=this._h[1],v=this._h[2],E=this._h[3],O=this._h[4],C=this._h[5],P=this._h[6],_=this._h[7],D=this._h[8],g=this._h[9],y=this._r[0],f=this._r[1],o=this._r[2],d=this._r[3],R=this._r[4],A=this._r[5],N=this._r[6],B=this._r[7],V=this._r[8],U=this._r[9];l>=16;){var I=c[u+0]|c[u+1]<<8;p+=I&8191;var b=c[u+2]|c[u+3]<<8;w+=(I>>>13|b<<3)&8191;var S=c[u+4]|c[u+5]<<8;v+=(b>>>10|S<<6)&8191;var T=c[u+6]|c[u+7]<<8;E+=(S>>>7|T<<9)&8191;var q=c[u+8]|c[u+9]<<8;O+=(T>>>4|q<<12)&8191,C+=q>>>1&8191;var L=c[u+10]|c[u+11]<<8;P+=(q>>>14|L<<2)&8191;var H=c[u+12]|c[u+13]<<8;_+=(L>>>11|H<<5)&8191;var K=c[u+14]|c[u+15]<<8;D+=(H>>>8|K<<8)&8191,g+=K>>>5|h;var $=0,j=$;j+=p*y,j+=w*(5*U),j+=v*(5*V),j+=E*(5*B),j+=O*(5*N),$=j>>>13,j&=8191,j+=C*(5*A),j+=P*(5*R),j+=_*(5*d),j+=D*(5*o),j+=g*(5*f),$+=j>>>13,j&=8191;var M=$;M+=p*f,M+=w*y,M+=v*(5*U),M+=E*(5*V),M+=O*(5*B),$=M>>>13,M&=8191,M+=C*(5*N),M+=P*(5*A),M+=_*(5*R),M+=D*(5*d),M+=g*(5*o),$+=M>>>13,M&=8191;var k=$;k+=p*o,k+=w*f,k+=v*y,k+=E*(5*U),k+=O*(5*V),$=k>>>13,k&=8191,k+=C*(5*B),k+=P*(5*N),k+=_*(5*A),k+=D*(5*R),k+=g*(5*d),$+=k>>>13,k&=8191;var Q=$;Q+=p*d,Q+=w*o,Q+=v*f,Q+=E*y,Q+=O*(5*U),$=Q>>>13,Q&=8191,Q+=C*(5*V),Q+=P*(5*B),Q+=_*(5*N),Q+=D*(5*A),Q+=g*(5*R),$+=Q>>>13,Q&=8191;var Y=$;Y+=p*R,Y+=w*d,Y+=v*o,Y+=E*f,Y+=O*y,$=Y>>>13,Y&=8191,Y+=C*(5*U),Y+=P*(5*V),Y+=_*(5*B),Y+=D*(5*N),Y+=g*(5*A),$+=Y>>>13,Y&=8191;var J=$;J+=p*A,J+=w*R,J+=v*d,J+=E*o,J+=O*f,$=J>>>13,J&=8191,J+=C*y,J+=P*(5*U),J+=_*(5*V),J+=D*(5*B),J+=g*(5*N),$+=J>>>13,J&=8191;var ee=$;ee+=p*N,ee+=w*A,ee+=v*R,ee+=E*d,ee+=O*o,$=ee>>>13,ee&=8191,ee+=C*f,ee+=P*y,ee+=_*(5*U),ee+=D*(5*V),ee+=g*(5*B),$+=ee>>>13,ee&=8191;var re=$;re+=p*B,re+=w*N,re+=v*A,re+=E*R,re+=O*d,$=re>>>13,re&=8191,re+=C*o,re+=P*f,re+=_*y,re+=D*(5*U),re+=g*(5*V),$+=re>>>13,re&=8191;var ie=$;ie+=p*V,ie+=w*B,ie+=v*N,ie+=E*A,ie+=O*R,$=ie>>>13,ie&=8191,ie+=C*d,ie+=P*o,ie+=_*f,ie+=D*y,ie+=g*(5*U),$+=ie>>>13,ie&=8191;var ne=$;ne+=p*U,ne+=w*V,ne+=v*B,ne+=E*N,ne+=O*A,$=ne>>>13,ne&=8191,ne+=C*R,ne+=P*d,ne+=_*o,ne+=D*f,ne+=g*y,$+=ne>>>13,ne&=8191,$=($<<2)+$|0,$=$+j|0,j=$&8191,$=$>>>13,M+=$,p=j,w=M,v=k,E=Q,O=Y,C=J,P=ee,_=re,D=ie,g=ne,u+=16,l-=16}this._h[0]=p,this._h[1]=w,this._h[2]=v,this._h[3]=E,this._h[4]=O,this._h[5]=C,this._h[6]=P,this._h[7]=_,this._h[8]=D,this._h[9]=g},a.prototype.finish=function(c,u){u===void 0&&(u=0);var l=new Uint16Array(10),h,p,w,v;if(this._leftover){for(v=this._leftover,this._buffer[v++]=1;v<16;v++)this._buffer[v]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(h=this._h[1]>>>13,this._h[1]&=8191,v=2;v<10;v++)this._h[v]+=h,h=this._h[v]>>>13,this._h[v]&=8191;for(this._h[0]+=h*5,h=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=h,h=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=h,l[0]=this._h[0]+5,h=l[0]>>>13,l[0]&=8191,v=1;v<10;v++)l[v]=this._h[v]+h,h=l[v]>>>13,l[v]&=8191;for(l[9]-=8192,p=(h^1)-1,v=0;v<10;v++)l[v]&=p;for(p=~p,v=0;v<10;v++)this._h[v]=this._h[v]&p|l[v];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,w=this._h[0]+this._pad[0],this._h[0]=w&65535,v=1;v<8;v++)w=(this._h[v]+this._pad[v]|0)+(w>>>16)|0,this._h[v]=w&65535;return c[u+0]=this._h[0]>>>0,c[u+1]=this._h[0]>>>8,c[u+2]=this._h[1]>>>0,c[u+3]=this._h[1]>>>8,c[u+4]=this._h[2]>>>0,c[u+5]=this._h[2]>>>8,c[u+6]=this._h[3]>>>0,c[u+7]=this._h[3]>>>8,c[u+8]=this._h[4]>>>0,c[u+9]=this._h[4]>>>8,c[u+10]=this._h[5]>>>0,c[u+11]=this._h[5]>>>8,c[u+12]=this._h[6]>>>0,c[u+13]=this._h[6]>>>8,c[u+14]=this._h[7]>>>0,c[u+15]=this._h[7]>>>8,this._finished=!0,this},a.prototype.update=function(c){var u=0,l=c.length,h;if(this._leftover){h=16-this._leftover,h>l&&(h=l);for(var p=0;p<h;p++)this._buffer[this._leftover+p]=c[u+p];if(l-=h,u+=h,this._leftover+=h,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(l>=16&&(h=l-l%16,this._blocks(c,u,h),u+=h,l-=h),l){for(var p=0;p<l;p++)this._buffer[this._leftover+p]=c[u+p];this._leftover+=l}return this},a.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var c=new Uint8Array(16);return this.finish(c),c},a.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},a}();e.Poly1305=i;function n(a,c){var u=new i(a);u.update(c);var l=u.digest();return u.clean(),l}e.oneTimeAuth=n;function s(a,c){return a.length!==e.DIGEST_LENGTH||c.length!==e.DIGEST_LENGTH?!1:t.equal(a,c)}e.equal=s}(dn)),dn}var Go;function Fg(){return Go||(Go=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=$g(),r=Ug(),i=Rt(),n=Ni(),s=hs();e.KEY_LENGTH=32,e.NONCE_LENGTH=12,e.TAG_LENGTH=16;var a=new Uint8Array(16),c=function(){function u(l){if(this.nonceLength=e.NONCE_LENGTH,this.tagLength=e.TAG_LENGTH,l.length!==e.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(l)}return u.prototype.seal=function(l,h,p,w){if(l.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var v=new Uint8Array(16);v.set(l,v.length-l.length);var E=new Uint8Array(32);t.stream(this._key,v,E,4);var O=h.length+this.tagLength,C;if(w){if(w.length!==O)throw new Error("ChaCha20Poly1305: incorrect destination length");C=w}else C=new Uint8Array(O);return t.streamXOR(this._key,v,h,C,4),this._authenticate(C.subarray(C.length-this.tagLength,C.length),E,C.subarray(0,C.length-this.tagLength),p),i.wipe(v),C},u.prototype.open=function(l,h,p,w){if(l.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(h.length<this.tagLength)return null;var v=new Uint8Array(16);v.set(l,v.length-l.length);var E=new Uint8Array(32);t.stream(this._key,v,E,4);var O=new Uint8Array(this.tagLength);if(this._authenticate(O,E,h.subarray(0,h.length-this.tagLength),p),!s.equal(O,h.subarray(h.length-this.tagLength,h.length)))return null;var C=h.length-this.tagLength,P;if(w){if(w.length!==C)throw new Error("ChaCha20Poly1305: incorrect destination length");P=w}else P=new Uint8Array(C);return t.streamXOR(this._key,v,h.subarray(0,h.length-this.tagLength),P,4),i.wipe(v),P},u.prototype.clean=function(){return i.wipe(this._key),this},u.prototype._authenticate=function(l,h,p,w){var v=new r.Poly1305(h);w&&(v.update(w),w.length%16>0&&v.update(a.subarray(w.length%16))),v.update(p),p.length%16>0&&v.update(a.subarray(p.length%16));var E=new Uint8Array(8);w&&n.writeUint64LE(w.length,E),v.update(E),n.writeUint64LE(p.length,E),v.update(E);for(var O=v.digest(),C=0;C<O.length;C++)l[C]=O[C];v.clean(),i.wipe(O),i.wipe(E)},u}();e.ChaCha20Poly1305=c}(hn)),hn}var Hc=Fg(),pi={},ur={},gi={},Yo;function Lg(){if(Yo)return gi;Yo=1,Object.defineProperty(gi,"__esModule",{value:!0});function e(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}return gi.isSerializableHash=e,gi}var Jo;function Mg(){if(Jo)return ur;Jo=1,Object.defineProperty(ur,"__esModule",{value:!0});var e=Lg(),t=hs(),r=Rt(),i=function(){function s(a,c){this._finished=!1,this._inner=new a,this._outer=new a,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var u=new Uint8Array(this.blockSize);c.length>this.blockSize?this._inner.update(c).finish(u).clean():u.set(c);for(var l=0;l<u.length;l++)u[l]^=54;this._inner.update(u);for(var l=0;l<u.length;l++)u[l]^=106;this._outer.update(u),e.isSerializableHash(this._inner)&&e.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),r.wipe(u)}return s.prototype.reset=function(){if(!e.isSerializableHash(this._inner)||!e.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},s.prototype.clean=function(){e.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),e.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},s.prototype.update=function(a){return this._inner.update(a),this},s.prototype.finish=function(a){return this._finished?(this._outer.finish(a),this):(this._inner.finish(a),this._outer.update(a.subarray(0,this.digestLength)).finish(a),this._finished=!0,this)},s.prototype.digest=function(){var a=new Uint8Array(this.digestLength);return this.finish(a),a},s.prototype.saveState=function(){if(!e.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},s.prototype.restoreState=function(a){if(!e.isSerializableHash(this._inner)||!e.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(a),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},s.prototype.cleanSavedState=function(a){if(!e.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(a)},s}();ur.HMAC=i;function n(s,a,c){var u=new i(s,a);u.update(c);var l=u.digest();return u.clean(),l}return ur.hmac=n,ur.equal=t.equal,ur}var Qo;function Bg(){if(Qo)return pi;Qo=1,Object.defineProperty(pi,"__esModule",{value:!0});var e=Mg(),t=Rt(),r=function(){function i(n,s,a,c){a===void 0&&(a=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=n,this._info=c;var u=e.hmac(this._hash,a,s);this._hmac=new e.HMAC(n,u),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return i.prototype._fillBuffer=function(){this._counter[0]++;var n=this._counter[0];if(n===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),n>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},i.prototype.expand=function(n){for(var s=new Uint8Array(n),a=0;a<s.length;a++)this._bufpos===this._buffer.length&&this._fillBuffer(),s[a]=this._buffer[this._bufpos++];return s},i.prototype.clean=function(){this._hmac.clean(),t.wipe(this._buffer),t.wipe(this._counter),this._bufpos=0},i}();return pi.HKDF=r,pi}var jg=Bg(),pn={},Cr={},Nr={},Xo;function qg(){if(Xo)return Nr;Xo=1,Object.defineProperty(Nr,"__esModule",{value:!0}),Nr.BrowserRandomSource=void 0;const e=65536;class t{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const i=typeof self<"u"?self.crypto||self.msCrypto:null;i&&i.getRandomValues!==void 0&&(this._crypto=i,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(i){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const n=new Uint8Array(i);for(let s=0;s<n.length;s+=e)this._crypto.getRandomValues(n.subarray(s,s+Math.min(n.length-s,e)));return n}}return Nr.BrowserRandomSource=t,Nr}var Pr={},Zo;function zg(){if(Zo)return Pr;Zo=1,Object.defineProperty(Pr,"__esModule",{value:!0}),Pr.NodeRandomSource=void 0;const e=Rt();class t{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof Tl<"u"){const i=$l;i&&i.randomBytes&&(this._crypto=i,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(i){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let n=this._crypto.randomBytes(i);if(n.length!==i)throw new Error("NodeRandomSource: got fewer bytes than requested");const s=new Uint8Array(i);for(let a=0;a<s.length;a++)s[a]=n[a];return(0,e.wipe)(n),s}}return Pr.NodeRandomSource=t,Pr}var ea;function Kg(){if(ea)return Cr;ea=1,Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.SystemRandomSource=void 0;const e=qg(),t=zg();class r{constructor(){if(this.isAvailable=!1,this.name="",this._source=new e.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new t.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(n){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(n)}}return Cr.SystemRandomSource=r,Cr}var ta;function Wc(){return ta||(ta=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.randomStringForEntropy=e.randomString=e.randomUint32=e.randomBytes=e.defaultRandomSource=void 0;const t=Kg(),r=Ni(),i=Rt();e.defaultRandomSource=new t.SystemRandomSource;function n(l,h=e.defaultRandomSource){return h.randomBytes(l)}e.randomBytes=n;function s(l=e.defaultRandomSource){const h=n(4,l),p=(0,r.readUint32LE)(h);return(0,i.wipe)(h),p}e.randomUint32=s;const a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(l,h=a,p=e.defaultRandomSource){if(h.length<2)throw new Error("randomString charset is too short");if(h.length>256)throw new Error("randomString charset is too long");let w="";const v=h.length,E=256-256%v;for(;l>0;){const O=n(Math.ceil(l*256/E),p);for(let C=0;C<O.length&&l>0;C++){const P=O[C];P<E&&(w+=h.charAt(P%v),l--)}(0,i.wipe)(O)}return w}e.randomString=c;function u(l,h=a,p=e.defaultRandomSource){const w=Math.ceil(l/(Math.log(h.length)/Math.LN2));return c(w,h,p)}e.randomStringForEntropy=u}(pn)),pn}var kc=Wc(),gn={},ra;function Vg(){return ra||(ra=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Ni(),r=Rt();e.DIGEST_LENGTH=32,e.BLOCK_SIZE=64;var i=function(){function c(){this.digestLength=e.DIGEST_LENGTH,this.blockSize=e.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},c.prototype.update=function(u,l){if(l===void 0&&(l=u.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var h=0;if(this._bytesHashed+=l,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&l>0;)this._buffer[this._bufferLength++]=u[h++],l--;this._bufferLength===this.blockSize&&(s(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(l>=this.blockSize&&(h=s(this._temp,this._state,u,h,l),l%=this.blockSize);l>0;)this._buffer[this._bufferLength++]=u[h++],l--;return this},c.prototype.finish=function(u){if(!this._finished){var l=this._bytesHashed,h=this._bufferLength,p=l/536870912|0,w=l<<3,v=l%64<56?64:128;this._buffer[h]=128;for(var E=h+1;E<v-8;E++)this._buffer[E]=0;t.writeUint32BE(p,this._buffer,v-8),t.writeUint32BE(w,this._buffer,v-4),s(this._temp,this._state,this._buffer,0,v),this._finished=!0}for(var E=0;E<this.digestLength/4;E++)t.writeUint32BE(this._state[E],u,E*4);return this},c.prototype.digest=function(){var u=new Uint8Array(this.digestLength);return this.finish(u),u},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(u){return this._state.set(u.state),this._bufferLength=u.bufferLength,u.buffer&&this._buffer.set(u.buffer),this._bytesHashed=u.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(u){r.wipe(u.state),u.buffer&&r.wipe(u.buffer),u.bufferLength=0,u.bytesHashed=0},c}();e.SHA256=i;var n=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function s(c,u,l,h,p){for(;p>=64;){for(var w=u[0],v=u[1],E=u[2],O=u[3],C=u[4],P=u[5],_=u[6],D=u[7],g=0;g<16;g++){var y=h+g*4;c[g]=t.readUint32BE(l,y)}for(var g=16;g<64;g++){var f=c[g-2],o=(f>>>17|f<<15)^(f>>>19|f<<13)^f>>>10;f=c[g-15];var d=(f>>>7|f<<25)^(f>>>18|f<<14)^f>>>3;c[g]=(o+c[g-7]|0)+(d+c[g-16]|0)}for(var g=0;g<64;g++){var o=(((C>>>6|C<<26)^(C>>>11|C<<21)^(C>>>25|C<<7))+(C&P^~C&_)|0)+(D+(n[g]+c[g]|0)|0)|0,d=((w>>>2|w<<30)^(w>>>13|w<<19)^(w>>>22|w<<10))+(w&v^w&E^v&E)|0;D=_,_=P,P=C,C=O+o|0,O=E,E=v,v=w,w=o+d|0}u[0]+=w,u[1]+=v,u[2]+=E,u[3]+=O,u[4]+=C,u[5]+=P,u[6]+=_,u[7]+=D,h+=64,p-=64}return h}function a(c){var u=new i;u.update(c);var l=u.digest();return u.clean(),l}e.hash=a}(gn)),gn}var fs=Vg(),yn={},ia;function Hg(){return ia||(ia=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.sharedKey=e.generateKeyPair=e.generateKeyPairFromSeed=e.scalarMultBase=e.scalarMult=e.SHARED_KEY_LENGTH=e.SECRET_KEY_LENGTH=e.PUBLIC_KEY_LENGTH=void 0;const t=Wc(),r=Rt();e.PUBLIC_KEY_LENGTH=32,e.SECRET_KEY_LENGTH=32,e.SHARED_KEY_LENGTH=32;function i(g){const y=new Float64Array(16);if(g)for(let f=0;f<g.length;f++)y[f]=g[f];return y}const n=new Uint8Array(32);n[0]=9;const s=i([56129,1]);function a(g){let y=1;for(let f=0;f<16;f++){let o=g[f]+y+65535;y=Math.floor(o/65536),g[f]=o-y*65536}g[0]+=y-1+37*(y-1)}function c(g,y,f){const o=~(f-1);for(let d=0;d<16;d++){const R=o&(g[d]^y[d]);g[d]^=R,y[d]^=R}}function u(g,y){const f=i(),o=i();for(let d=0;d<16;d++)o[d]=y[d];a(o),a(o),a(o);for(let d=0;d<2;d++){f[0]=o[0]-65517;for(let A=1;A<15;A++)f[A]=o[A]-65535-(f[A-1]>>16&1),f[A-1]&=65535;f[15]=o[15]-32767-(f[14]>>16&1);const R=f[15]>>16&1;f[14]&=65535,c(o,f,1-R)}for(let d=0;d<16;d++)g[2*d]=o[d]&255,g[2*d+1]=o[d]>>8}function l(g,y){for(let f=0;f<16;f++)g[f]=y[2*f]+(y[2*f+1]<<8);g[15]&=32767}function h(g,y,f){for(let o=0;o<16;o++)g[o]=y[o]+f[o]}function p(g,y,f){for(let o=0;o<16;o++)g[o]=y[o]-f[o]}function w(g,y,f){let o,d,R=0,A=0,N=0,B=0,V=0,U=0,I=0,b=0,S=0,T=0,q=0,L=0,H=0,K=0,$=0,j=0,M=0,k=0,Q=0,Y=0,J=0,ee=0,re=0,ie=0,ne=0,Je=0,lt=0,wt=0,Ct=0,jt=0,qt=0,de=f[0],le=f[1],pe=f[2],ge=f[3],ye=f[4],we=f[5],be=f[6],ce=f[7],he=f[8],me=f[9],se=f[10],Se=f[11],Ie=f[12],Ae=f[13],Oe=f[14],ve=f[15];o=y[0],R+=o*de,A+=o*le,N+=o*pe,B+=o*ge,V+=o*ye,U+=o*we,I+=o*be,b+=o*ce,S+=o*he,T+=o*me,q+=o*se,L+=o*Se,H+=o*Ie,K+=o*Ae,$+=o*Oe,j+=o*ve,o=y[1],A+=o*de,N+=o*le,B+=o*pe,V+=o*ge,U+=o*ye,I+=o*we,b+=o*be,S+=o*ce,T+=o*he,q+=o*me,L+=o*se,H+=o*Se,K+=o*Ie,$+=o*Ae,j+=o*Oe,M+=o*ve,o=y[2],N+=o*de,B+=o*le,V+=o*pe,U+=o*ge,I+=o*ye,b+=o*we,S+=o*be,T+=o*ce,q+=o*he,L+=o*me,H+=o*se,K+=o*Se,$+=o*Ie,j+=o*Ae,M+=o*Oe,k+=o*ve,o=y[3],B+=o*de,V+=o*le,U+=o*pe,I+=o*ge,b+=o*ye,S+=o*we,T+=o*be,q+=o*ce,L+=o*he,H+=o*me,K+=o*se,$+=o*Se,j+=o*Ie,M+=o*Ae,k+=o*Oe,Q+=o*ve,o=y[4],V+=o*de,U+=o*le,I+=o*pe,b+=o*ge,S+=o*ye,T+=o*we,q+=o*be,L+=o*ce,H+=o*he,K+=o*me,$+=o*se,j+=o*Se,M+=o*Ie,k+=o*Ae,Q+=o*Oe,Y+=o*ve,o=y[5],U+=o*de,I+=o*le,b+=o*pe,S+=o*ge,T+=o*ye,q+=o*we,L+=o*be,H+=o*ce,K+=o*he,$+=o*me,j+=o*se,M+=o*Se,k+=o*Ie,Q+=o*Ae,Y+=o*Oe,J+=o*ve,o=y[6],I+=o*de,b+=o*le,S+=o*pe,T+=o*ge,q+=o*ye,L+=o*we,H+=o*be,K+=o*ce,$+=o*he,j+=o*me,M+=o*se,k+=o*Se,Q+=o*Ie,Y+=o*Ae,J+=o*Oe,ee+=o*ve,o=y[7],b+=o*de,S+=o*le,T+=o*pe,q+=o*ge,L+=o*ye,H+=o*we,K+=o*be,$+=o*ce,j+=o*he,M+=o*me,k+=o*se,Q+=o*Se,Y+=o*Ie,J+=o*Ae,ee+=o*Oe,re+=o*ve,o=y[8],S+=o*de,T+=o*le,q+=o*pe,L+=o*ge,H+=o*ye,K+=o*we,$+=o*be,j+=o*ce,M+=o*he,k+=o*me,Q+=o*se,Y+=o*Se,J+=o*Ie,ee+=o*Ae,re+=o*Oe,ie+=o*ve,o=y[9],T+=o*de,q+=o*le,L+=o*pe,H+=o*ge,K+=o*ye,$+=o*we,j+=o*be,M+=o*ce,k+=o*he,Q+=o*me,Y+=o*se,J+=o*Se,ee+=o*Ie,re+=o*Ae,ie+=o*Oe,ne+=o*ve,o=y[10],q+=o*de,L+=o*le,H+=o*pe,K+=o*ge,$+=o*ye,j+=o*we,M+=o*be,k+=o*ce,Q+=o*he,Y+=o*me,J+=o*se,ee+=o*Se,re+=o*Ie,ie+=o*Ae,ne+=o*Oe,Je+=o*ve,o=y[11],L+=o*de,H+=o*le,K+=o*pe,$+=o*ge,j+=o*ye,M+=o*we,k+=o*be,Q+=o*ce,Y+=o*he,J+=o*me,ee+=o*se,re+=o*Se,ie+=o*Ie,ne+=o*Ae,Je+=o*Oe,lt+=o*ve,o=y[12],H+=o*de,K+=o*le,$+=o*pe,j+=o*ge,M+=o*ye,k+=o*we,Q+=o*be,Y+=o*ce,J+=o*he,ee+=o*me,re+=o*se,ie+=o*Se,ne+=o*Ie,Je+=o*Ae,lt+=o*Oe,wt+=o*ve,o=y[13],K+=o*de,$+=o*le,j+=o*pe,M+=o*ge,k+=o*ye,Q+=o*we,Y+=o*be,J+=o*ce,ee+=o*he,re+=o*me,ie+=o*se,ne+=o*Se,Je+=o*Ie,lt+=o*Ae,wt+=o*Oe,Ct+=o*ve,o=y[14],$+=o*de,j+=o*le,M+=o*pe,k+=o*ge,Q+=o*ye,Y+=o*we,J+=o*be,ee+=o*ce,re+=o*he,ie+=o*me,ne+=o*se,Je+=o*Se,lt+=o*Ie,wt+=o*Ae,Ct+=o*Oe,jt+=o*ve,o=y[15],j+=o*de,M+=o*le,k+=o*pe,Q+=o*ge,Y+=o*ye,J+=o*we,ee+=o*be,re+=o*ce,ie+=o*he,ne+=o*me,Je+=o*se,lt+=o*Se,wt+=o*Ie,Ct+=o*Ae,jt+=o*Oe,qt+=o*ve,R+=38*M,A+=38*k,N+=38*Q,B+=38*Y,V+=38*J,U+=38*ee,I+=38*re,b+=38*ie,S+=38*ne,T+=38*Je,q+=38*lt,L+=38*wt,H+=38*Ct,K+=38*jt,$+=38*qt,d=1,o=R+d+65535,d=Math.floor(o/65536),R=o-d*65536,o=A+d+65535,d=Math.floor(o/65536),A=o-d*65536,o=N+d+65535,d=Math.floor(o/65536),N=o-d*65536,o=B+d+65535,d=Math.floor(o/65536),B=o-d*65536,o=V+d+65535,d=Math.floor(o/65536),V=o-d*65536,o=U+d+65535,d=Math.floor(o/65536),U=o-d*65536,o=I+d+65535,d=Math.floor(o/65536),I=o-d*65536,o=b+d+65535,d=Math.floor(o/65536),b=o-d*65536,o=S+d+65535,d=Math.floor(o/65536),S=o-d*65536,o=T+d+65535,d=Math.floor(o/65536),T=o-d*65536,o=q+d+65535,d=Math.floor(o/65536),q=o-d*65536,o=L+d+65535,d=Math.floor(o/65536),L=o-d*65536,o=H+d+65535,d=Math.floor(o/65536),H=o-d*65536,o=K+d+65535,d=Math.floor(o/65536),K=o-d*65536,o=$+d+65535,d=Math.floor(o/65536),$=o-d*65536,o=j+d+65535,d=Math.floor(o/65536),j=o-d*65536,R+=d-1+37*(d-1),d=1,o=R+d+65535,d=Math.floor(o/65536),R=o-d*65536,o=A+d+65535,d=Math.floor(o/65536),A=o-d*65536,o=N+d+65535,d=Math.floor(o/65536),N=o-d*65536,o=B+d+65535,d=Math.floor(o/65536),B=o-d*65536,o=V+d+65535,d=Math.floor(o/65536),V=o-d*65536,o=U+d+65535,d=Math.floor(o/65536),U=o-d*65536,o=I+d+65535,d=Math.floor(o/65536),I=o-d*65536,o=b+d+65535,d=Math.floor(o/65536),b=o-d*65536,o=S+d+65535,d=Math.floor(o/65536),S=o-d*65536,o=T+d+65535,d=Math.floor(o/65536),T=o-d*65536,o=q+d+65535,d=Math.floor(o/65536),q=o-d*65536,o=L+d+65535,d=Math.floor(o/65536),L=o-d*65536,o=H+d+65535,d=Math.floor(o/65536),H=o-d*65536,o=K+d+65535,d=Math.floor(o/65536),K=o-d*65536,o=$+d+65535,d=Math.floor(o/65536),$=o-d*65536,o=j+d+65535,d=Math.floor(o/65536),j=o-d*65536,R+=d-1+37*(d-1),g[0]=R,g[1]=A,g[2]=N,g[3]=B,g[4]=V,g[5]=U,g[6]=I,g[7]=b,g[8]=S,g[9]=T,g[10]=q,g[11]=L,g[12]=H,g[13]=K,g[14]=$,g[15]=j}function v(g,y){w(g,y,y)}function E(g,y){const f=i();for(let o=0;o<16;o++)f[o]=y[o];for(let o=253;o>=0;o--)v(f,f),o!==2&&o!==4&&w(f,f,y);for(let o=0;o<16;o++)g[o]=f[o]}function O(g,y){const f=new Uint8Array(32),o=new Float64Array(80),d=i(),R=i(),A=i(),N=i(),B=i(),V=i();for(let S=0;S<31;S++)f[S]=g[S];f[31]=g[31]&127|64,f[0]&=248,l(o,y);for(let S=0;S<16;S++)R[S]=o[S];d[0]=N[0]=1;for(let S=254;S>=0;--S){const T=f[S>>>3]>>>(S&7)&1;c(d,R,T),c(A,N,T),h(B,d,A),p(d,d,A),h(A,R,N),p(R,R,N),v(N,B),v(V,d),w(d,A,d),w(A,R,B),h(B,d,A),p(d,d,A),v(R,d),p(A,N,V),w(d,A,s),h(d,d,N),w(A,A,d),w(d,N,V),w(N,R,o),v(R,B),c(d,R,T),c(A,N,T)}for(let S=0;S<16;S++)o[S+16]=d[S],o[S+32]=A[S],o[S+48]=R[S],o[S+64]=N[S];const U=o.subarray(32),I=o.subarray(16);E(U,U),w(I,I,U);const b=new Uint8Array(32);return u(b,I),b}e.scalarMult=O;function C(g){return O(g,n)}e.scalarMultBase=C;function P(g){if(g.length!==e.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${e.SECRET_KEY_LENGTH} bytes`);const y=new Uint8Array(g);return{publicKey:C(y),secretKey:y}}e.generateKeyPairFromSeed=P;function _(g){const y=(0,t.randomBytes)(32,g),f=P(y);return(0,r.wipe)(y),f}e.generateKeyPair=_;function D(g,y,f=!1){if(g.length!==e.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(y.length!==e.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const o=O(g,y);if(f){let d=0;for(let R=0;R<o.length;R++)d|=o[R];if(d===0)throw new Error("X25519: invalid shared key")}return o}e.sharedKey=D}(yn)),yn}var Gc=Hg();function ds(e){return globalThis.Buffer!=null?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function Yc(e=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ds(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function na(e,t){t||(t=e.reduce((n,s)=>n+s.length,0));const r=Yc(t);let i=0;for(const n of e)r.set(n,i),i+=n.length;return ds(r)}function Wg(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<e.length;n++){var s=e.charAt(n),a=s.charCodeAt(0);if(r[a]!==255)throw new TypeError(s+" is ambiguous");r[a]=n}var c=e.length,u=e.charAt(0),l=Math.log(c)/Math.log(256),h=Math.log(256)/Math.log(c);function p(E){if(E instanceof Uint8Array||(ArrayBuffer.isView(E)?E=new Uint8Array(E.buffer,E.byteOffset,E.byteLength):Array.isArray(E)&&(E=Uint8Array.from(E))),!(E instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(E.length===0)return"";for(var O=0,C=0,P=0,_=E.length;P!==_&&E[P]===0;)P++,O++;for(var D=(_-P)*h+1>>>0,g=new Uint8Array(D);P!==_;){for(var y=E[P],f=0,o=D-1;(y!==0||f<C)&&o!==-1;o--,f++)y+=256*g[o]>>>0,g[o]=y%c>>>0,y=y/c>>>0;if(y!==0)throw new Error("Non-zero carry");C=f,P++}for(var d=D-C;d!==D&&g[d]===0;)d++;for(var R=u.repeat(O);d<D;++d)R+=e.charAt(g[d]);return R}function w(E){if(typeof E!="string")throw new TypeError("Expected String");if(E.length===0)return new Uint8Array;var O=0;if(E[O]!==" "){for(var C=0,P=0;E[O]===u;)C++,O++;for(var _=(E.length-O)*l+1>>>0,D=new Uint8Array(_);E[O];){var g=r[E.charCodeAt(O)];if(g===255)return;for(var y=0,f=_-1;(g!==0||y<P)&&f!==-1;f--,y++)g+=c*D[f]>>>0,D[f]=g%256>>>0,g=g/256>>>0;if(g!==0)throw new Error("Non-zero carry");P=y,O++}if(E[O]!==" "){for(var o=_-P;o!==_&&D[o]===0;)o++;for(var d=new Uint8Array(C+(_-o)),R=C;o!==_;)d[R++]=D[o++];return d}}}function v(E){var O=w(E);if(O)return O;throw new Error(`Non-${t} character`)}return{encode:p,decodeUnsafe:w,decode:v}}var kg=Wg,Gg=kg;const Yg=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},Jg=e=>new TextEncoder().encode(e),Qg=e=>new TextDecoder().decode(e);class Xg{constructor(t,r,i){this.name=t,this.prefix=r,this.baseEncode=i}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class Zg{constructor(t,r,i){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Jc(this,t)}}class ey{constructor(t){this.decoders=t}or(t){return Jc(this,t)}decode(t){const r=t[0],i=this.decoders[r];if(i)return i.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Jc=(e,t)=>new ey({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class ty{constructor(t,r,i,n){this.name=t,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new Xg(t,r,i),this.decoder=new Zg(t,r,n)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Pi=({name:e,prefix:t,encode:r,decode:i})=>new ty(e,t,r,i),kr=({prefix:e,name:t,alphabet:r})=>{const{encode:i,decode:n}=Gg(r,t);return Pi({prefix:e,name:t,encode:i,decode:s=>Yg(n(s))})},ry=(e,t,r,i)=>{const n={};for(let h=0;h<t.length;++h)n[t[h]]=h;let s=e.length;for(;e[s-1]==="=";)--s;const a=new Uint8Array(s*r/8|0);let c=0,u=0,l=0;for(let h=0;h<s;++h){const p=n[e[h]];if(p===void 0)throw new SyntaxError(`Non-${i} character`);u=u<<r|p,c+=r,c>=8&&(c-=8,a[l++]=255&u>>c)}if(c>=r||255&u<<8-c)throw new SyntaxError("Unexpected end of data");return a},iy=(e,t,r)=>{const i=t[t.length-1]==="=",n=(1<<r)-1;let s="",a=0,c=0;for(let u=0;u<e.length;++u)for(c=c<<8|e[u],a+=8;a>r;)a-=r,s+=t[n&c>>a];if(a&&(s+=t[n&c<<r-a]),i)for(;s.length*r&7;)s+="=";return s},Fe=({name:e,prefix:t,bitsPerChar:r,alphabet:i})=>Pi({prefix:t,name:e,encode(n){return iy(n,i,r)},decode(n){return ry(n,i,r,e)}}),ny=Pi({prefix:"\0",name:"identity",encode:e=>Qg(e),decode:e=>Jg(e)}),sy=Object.freeze(Object.defineProperty({__proto__:null,identity:ny},Symbol.toStringTag,{value:"Module"})),oy=Fe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),ay=Object.freeze(Object.defineProperty({__proto__:null,base2:oy},Symbol.toStringTag,{value:"Module"})),cy=Fe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),uy=Object.freeze(Object.defineProperty({__proto__:null,base8:cy},Symbol.toStringTag,{value:"Module"})),ly=kr({prefix:"9",name:"base10",alphabet:"0123456789"}),hy=Object.freeze(Object.defineProperty({__proto__:null,base10:ly},Symbol.toStringTag,{value:"Module"})),fy=Fe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),dy=Fe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),py=Object.freeze(Object.defineProperty({__proto__:null,base16:fy,base16upper:dy},Symbol.toStringTag,{value:"Module"})),gy=Fe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),yy=Fe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),wy=Fe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),by=Fe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),my=Fe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),vy=Fe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ey=Fe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),_y=Fe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Dy=Fe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Sy=Object.freeze(Object.defineProperty({__proto__:null,base32:gy,base32hex:my,base32hexpad:Ey,base32hexpadupper:_y,base32hexupper:vy,base32pad:wy,base32padupper:by,base32upper:yy,base32z:Dy},Symbol.toStringTag,{value:"Module"})),Iy=kr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Oy=kr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),xy=Object.freeze(Object.defineProperty({__proto__:null,base36:Iy,base36upper:Oy},Symbol.toStringTag,{value:"Module"})),Ay=kr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Ry=kr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Cy=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Ay,base58flickr:Ry},Symbol.toStringTag,{value:"Module"})),Ny=Fe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Py=Fe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ty=Fe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),$y=Fe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Uy=Object.freeze(Object.defineProperty({__proto__:null,base64:Ny,base64pad:Py,base64url:Ty,base64urlpad:$y},Symbol.toStringTag,{value:"Module"})),Qc=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Fy=Qc.reduce((e,t,r)=>(e[r]=t,e),[]),Ly=Qc.reduce((e,t,r)=>(e[t.codePointAt(0)]=r,e),[]);function My(e){return e.reduce((t,r)=>(t+=Fy[r],t),"")}function By(e){const t=[];for(const r of e){const i=Ly[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(i)}return new Uint8Array(t)}const jy=Pi({prefix:"🚀",name:"base256emoji",encode:My,decode:By}),qy=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:jy},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const sa={...sy,...ay,...uy,...hy,...py,...Sy,...xy,...Cy,...Uy,...qy};function Xc(e,t,r,i){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:i}}}const oa=Xc("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),wn=Xc("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);const t=Yc(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),Zc={utf8:oa,"utf-8":oa,hex:sa.base16,latin1:wn,ascii:wn,binary:wn,...sa};function ut(e,t="utf8"){const r=Zc[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ds(globalThis.Buffer.from(e,"utf-8")):r.decoder.decode(`${r.prefix}${e}`)}function it(e,t="utf8"){const r=Zc[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8"):r.encoder.encode(e).substring(1)}var aa=function(e,t,r){if(r||arguments.length===2)for(var i=0,n=t.length,s;i<n;i++)(s||!(i in t))&&(s||(s=Array.prototype.slice.call(t,0,i)),s[i]=t[i]);return e.concat(s||Array.prototype.slice.call(t))},zy=function(){function e(t,r,i){this.name=t,this.version=r,this.os=i,this.type="browser"}return e}(),Ky=function(){function e(t){this.version=t,this.type="node",this.name="node",this.os=process.platform}return e}(),Vy=function(){function e(t,r,i,n){this.name=t,this.version=r,this.os=i,this.bot=n,this.type="bot-device"}return e}(),Hy=function(){function e(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return e}(),Wy=function(){function e(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return e}(),ky=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Gy=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,ca=3,Yy=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",ky]],ua=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Jy(e){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Wy:typeof navigator<"u"?Xy(navigator.userAgent):ew()}function Qy(e){return e!==""&&Yy.reduce(function(t,r){var i=r[0],n=r[1];if(t)return t;var s=n.exec(e);return!!s&&[i,s]},!1)}function Xy(e){var t=Qy(e);if(!t)return null;var r=t[0],i=t[1];if(r==="searchbot")return new Hy;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<ca&&(n=aa(aa([],n,!0),tw(ca-n.length),!0)):n=[];var s=n.join("."),a=Zy(e),c=Gy.exec(e);return c&&c[1]?new Vy(r,s,a,c[1]):new zy(r,s,a)}function Zy(e){for(var t=0,r=ua.length;t<r;t++){var i=ua[t],n=i[0],s=i[1],a=s.exec(e);if(a)return n}return null}function ew(){var e=typeof process<"u"&&process.version;return e?new Ky(process.version.slice(1)):null}function tw(e){for(var t=[],r=0;r<e;r++)t.push("0");return t}var oe={},la;function eu(){if(la)return oe;la=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.getLocalStorage=oe.getLocalStorageOrThrow=oe.getCrypto=oe.getCryptoOrThrow=oe.getLocation=oe.getLocationOrThrow=oe.getNavigator=oe.getNavigatorOrThrow=oe.getDocument=oe.getDocumentOrThrow=oe.getFromWindowOrThrow=oe.getFromWindow=void 0;function e(w){let v;return typeof window<"u"&&typeof window[w]<"u"&&(v=window[w]),v}oe.getFromWindow=e;function t(w){const v=e(w);if(!v)throw new Error(`${w} is not defined in Window`);return v}oe.getFromWindowOrThrow=t;function r(){return t("document")}oe.getDocumentOrThrow=r;function i(){return e("document")}oe.getDocument=i;function n(){return t("navigator")}oe.getNavigatorOrThrow=n;function s(){return e("navigator")}oe.getNavigator=s;function a(){return t("location")}oe.getLocationOrThrow=a;function c(){return e("location")}oe.getLocation=c;function u(){return t("crypto")}oe.getCryptoOrThrow=u;function l(){return e("crypto")}oe.getCrypto=l;function h(){return t("localStorage")}oe.getLocalStorageOrThrow=h;function p(){return e("localStorage")}return oe.getLocalStorage=p,oe}var jr=eu(),Tr={},ha;function rw(){if(ha)return Tr;ha=1,Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.getWindowMetadata=void 0;const e=eu();function t(){let r,i;try{r=e.getDocumentOrThrow(),i=e.getLocationOrThrow()}catch{return null}function n(){const v=r.getElementsByTagName("link"),E=[];for(let O=0;O<v.length;O++){const C=v[O],P=C.getAttribute("rel");if(P&&P.toLowerCase().indexOf("icon")>-1){const _=C.getAttribute("href");if(_)if(_.toLowerCase().indexOf("https:")===-1&&_.toLowerCase().indexOf("http:")===-1&&_.indexOf("//")!==0){let D=i.protocol+"//"+i.host;if(_.indexOf("/")===0)D+=_;else{const g=i.pathname.split("/");g.pop();const y=g.join("/");D+=y+"/"+_}E.push(D)}else if(_.indexOf("//")===0){const D=i.protocol+_;E.push(D)}else E.push(_)}}return E}function s(...v){const E=r.getElementsByTagName("meta");for(let O=0;O<E.length;O++){const C=E[O],P=["itemprop","property","name"].map(_=>C.getAttribute(_)).filter(_=>_?v.includes(_):!1);if(P.length&&P){const _=C.getAttribute("content");if(_)return _}}return""}function a(){let v=s("name","og:site_name","og:title","twitter:title");return v||(v=r.title),v}function c(){return s("description","og:description","twitter:description","keywords")}const u=a(),l=c(),h=i.origin,p=n();return{description:l,url:h,icons:p,name:u}}return Tr.getWindowMetadata=t,Tr}var iw=rw(),bn={},mn,fa;function nw(){return fa||(fa=1,mn=e=>encodeURIComponent(e).replace(/[!'()*]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`)),mn}var vn,da;function sw(){if(da)return vn;da=1;var e="%[a-f0-9]{2}",t=new RegExp("("+e+")|([^%]+?)","gi"),r=new RegExp("("+e+")+","gi");function i(a,c){try{return[decodeURIComponent(a.join(""))]}catch{}if(a.length===1)return a;c=c||1;var u=a.slice(0,c),l=a.slice(c);return Array.prototype.concat.call([],i(u),i(l))}function n(a){try{return decodeURIComponent(a)}catch{for(var c=a.match(t)||[],u=1;u<c.length;u++)a=i(c,u).join(""),c=a.match(t)||[];return a}}function s(a){for(var c={"%FE%FF":"��","%FF%FE":"��"},u=r.exec(a);u;){try{c[u[0]]=decodeURIComponent(u[0])}catch{var l=n(u[0]);l!==u[0]&&(c[u[0]]=l)}u=r.exec(a)}c["%C2"]="�";for(var h=Object.keys(c),p=0;p<h.length;p++){var w=h[p];a=a.replace(new RegExp(w,"g"),c[w])}return a}return vn=function(a){if(typeof a!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof a+"`");try{return a=a.replace(/\+/g," "),decodeURIComponent(a)}catch{return s(a)}},vn}var En,pa;function ow(){return pa||(pa=1,En=(e,t)=>{if(!(typeof e=="string"&&typeof t=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(t==="")return[e];const r=e.indexOf(t);return r===-1?[e]:[e.slice(0,r),e.slice(r+t.length)]}),En}var _n,ga;function aw(){return ga||(ga=1,_n=function(e,t){for(var r={},i=Object.keys(e),n=Array.isArray(t),s=0;s<i.length;s++){var a=i[s],c=e[a];(n?t.indexOf(a)!==-1:t(a,c,e))&&(r[a]=c)}return r}),_n}var ya;function cw(){return ya||(ya=1,function(e){const t=nw(),r=sw(),i=ow(),n=aw(),s=_=>_==null,a=Symbol("encodeFragmentIdentifier");function c(_){switch(_.arrayFormat){case"index":return D=>(g,y)=>{const f=g.length;return y===void 0||_.skipNull&&y===null||_.skipEmptyString&&y===""?g:y===null?[...g,[h(D,_),"[",f,"]"].join("")]:[...g,[h(D,_),"[",h(f,_),"]=",h(y,_)].join("")]};case"bracket":return D=>(g,y)=>y===void 0||_.skipNull&&y===null||_.skipEmptyString&&y===""?g:y===null?[...g,[h(D,_),"[]"].join("")]:[...g,[h(D,_),"[]=",h(y,_)].join("")];case"colon-list-separator":return D=>(g,y)=>y===void 0||_.skipNull&&y===null||_.skipEmptyString&&y===""?g:y===null?[...g,[h(D,_),":list="].join("")]:[...g,[h(D,_),":list=",h(y,_)].join("")];case"comma":case"separator":case"bracket-separator":{const D=_.arrayFormat==="bracket-separator"?"[]=":"=";return g=>(y,f)=>f===void 0||_.skipNull&&f===null||_.skipEmptyString&&f===""?y:(f=f===null?"":f,y.length===0?[[h(g,_),D,h(f,_)].join("")]:[[y,h(f,_)].join(_.arrayFormatSeparator)])}default:return D=>(g,y)=>y===void 0||_.skipNull&&y===null||_.skipEmptyString&&y===""?g:y===null?[...g,h(D,_)]:[...g,[h(D,_),"=",h(y,_)].join("")]}}function u(_){let D;switch(_.arrayFormat){case"index":return(g,y,f)=>{if(D=/\[(\d*)\]$/.exec(g),g=g.replace(/\[\d*\]$/,""),!D){f[g]=y;return}f[g]===void 0&&(f[g]={}),f[g][D[1]]=y};case"bracket":return(g,y,f)=>{if(D=/(\[\])$/.exec(g),g=g.replace(/\[\]$/,""),!D){f[g]=y;return}if(f[g]===void 0){f[g]=[y];return}f[g]=[].concat(f[g],y)};case"colon-list-separator":return(g,y,f)=>{if(D=/(:list)$/.exec(g),g=g.replace(/:list$/,""),!D){f[g]=y;return}if(f[g]===void 0){f[g]=[y];return}f[g]=[].concat(f[g],y)};case"comma":case"separator":return(g,y,f)=>{const o=typeof y=="string"&&y.includes(_.arrayFormatSeparator),d=typeof y=="string"&&!o&&p(y,_).includes(_.arrayFormatSeparator);y=d?p(y,_):y;const R=o||d?y.split(_.arrayFormatSeparator).map(A=>p(A,_)):y===null?y:p(y,_);f[g]=R};case"bracket-separator":return(g,y,f)=>{const o=/(\[\])$/.test(g);if(g=g.replace(/\[\]$/,""),!o){f[g]=y&&p(y,_);return}const d=y===null?[]:y.split(_.arrayFormatSeparator).map(R=>p(R,_));if(f[g]===void 0){f[g]=d;return}f[g]=[].concat(f[g],d)};default:return(g,y,f)=>{if(f[g]===void 0){f[g]=y;return}f[g]=[].concat(f[g],y)}}}function l(_){if(typeof _!="string"||_.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function h(_,D){return D.encode?D.strict?t(_):encodeURIComponent(_):_}function p(_,D){return D.decode?r(_):_}function w(_){return Array.isArray(_)?_.sort():typeof _=="object"?w(Object.keys(_)).sort((D,g)=>Number(D)-Number(g)).map(D=>_[D]):_}function v(_){const D=_.indexOf("#");return D!==-1&&(_=_.slice(0,D)),_}function E(_){let D="";const g=_.indexOf("#");return g!==-1&&(D=_.slice(g)),D}function O(_){_=v(_);const D=_.indexOf("?");return D===-1?"":_.slice(D+1)}function C(_,D){return D.parseNumbers&&!Number.isNaN(Number(_))&&typeof _=="string"&&_.trim()!==""?_=Number(_):D.parseBooleans&&_!==null&&(_.toLowerCase()==="true"||_.toLowerCase()==="false")&&(_=_.toLowerCase()==="true"),_}function P(_,D){D=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},D),l(D.arrayFormatSeparator);const g=u(D),y=Object.create(null);if(typeof _!="string"||(_=_.trim().replace(/^[?#&]/,""),!_))return y;for(const f of _.split("&")){if(f==="")continue;let[o,d]=i(D.decode?f.replace(/\+/g," "):f,"=");d=d===void 0?null:["comma","separator","bracket-separator"].includes(D.arrayFormat)?d:p(d,D),g(p(o,D),d,y)}for(const f of Object.keys(y)){const o=y[f];if(typeof o=="object"&&o!==null)for(const d of Object.keys(o))o[d]=C(o[d],D);else y[f]=C(o,D)}return D.sort===!1?y:(D.sort===!0?Object.keys(y).sort():Object.keys(y).sort(D.sort)).reduce((f,o)=>{const d=y[o];return d&&typeof d=="object"&&!Array.isArray(d)?f[o]=w(d):f[o]=d,f},Object.create(null))}e.extract=O,e.parse=P,e.stringify=(_,D)=>{if(!_)return"";D=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},D),l(D.arrayFormatSeparator);const g=d=>D.skipNull&&s(_[d])||D.skipEmptyString&&_[d]==="",y=c(D),f={};for(const d of Object.keys(_))g(d)||(f[d]=_[d]);const o=Object.keys(f);return D.sort!==!1&&o.sort(D.sort),o.map(d=>{const R=_[d];return R===void 0?"":R===null?h(d,D):Array.isArray(R)?R.length===0&&D.arrayFormat==="bracket-separator"?h(d,D)+"[]":R.reduce(y(d),[]).join("&"):h(d,D)+"="+h(R,D)}).filter(d=>d.length>0).join("&")},e.parseUrl=(_,D)=>{D=Object.assign({decode:!0},D);const[g,y]=i(_,"#");return Object.assign({url:g.split("?")[0]||"",query:P(O(_),D)},D&&D.parseFragmentIdentifier&&y?{fragmentIdentifier:p(y,D)}:{})},e.stringifyUrl=(_,D)=>{D=Object.assign({encode:!0,strict:!0,[a]:!0},D);const g=v(_.url).split("?")[0]||"",y=e.extract(_.url),f=e.parse(y,{sort:!1}),o=Object.assign(f,_.query);let d=e.stringify(o,D);d&&(d=`?${d}`);let R=E(_.url);return _.fragmentIdentifier&&(R=`#${D[a]?h(_.fragmentIdentifier,D):_.fragmentIdentifier}`),`${g}${d}${R}`},e.pick=(_,D,g)=>{g=Object.assign({parseFragmentIdentifier:!0,[a]:!1},g);const{url:y,query:f,fragmentIdentifier:o}=e.parseUrl(_,g);return e.stringifyUrl({url:y,query:n(f,D),fragmentIdentifier:o},g)},e.exclude=(_,D,g)=>{const y=Array.isArray(D)?f=>!D.includes(f):(f,o)=>!D(f,o);return e.pick(_,y,g)}}(bn)),bn}var Si=cw();const uw={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};function tu(e,t){return e.includes(":")?[e]:t.chains||[]}const ru="base10",Ve="base16",Hn="base64pad",ps="utf8",iu=0,nr=1,lw=0,wa=1,Wn=12,gs=32;function hw(){const e=Gc.generateKeyPair();return{privateKey:it(e.secretKey,Ve),publicKey:it(e.publicKey,Ve)}}function kn(){const e=kc.randomBytes(gs);return it(e,Ve)}function fw(e,t){const r=Gc.sharedKey(ut(e,Ve),ut(t,Ve),!0),i=new jg.HKDF(fs.SHA256,r).expand(gs);return it(i,Ve)}function dw(e){const t=fs.hash(ut(e,Ve));return it(t,Ve)}function dr(e){const t=fs.hash(ut(e,ps));return it(t,Ve)}function pw(e){return ut(`${e}`,ru)}function Gr(e){return Number(it(e,ru))}function gw(e){const t=pw(typeof e.type<"u"?e.type:iu);if(Gr(t)===nr&&typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof e.senderPublicKey<"u"?ut(e.senderPublicKey,Ve):void 0,i=typeof e.iv<"u"?ut(e.iv,Ve):kc.randomBytes(Wn),n=new Hc.ChaCha20Poly1305(ut(e.symKey,Ve)).seal(i,ut(e.message,ps));return ww({type:t,sealed:n,iv:i,senderPublicKey:r})}function yw(e){const t=new Hc.ChaCha20Poly1305(ut(e.symKey,Ve)),{sealed:r,iv:i}=Ii(e.encoded),n=t.open(i,r);if(n===null)throw new Error("Failed to decrypt");return it(n,ps)}function ww(e){if(Gr(e.type)===nr){if(typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return it(na([e.type,e.senderPublicKey,e.iv,e.sealed]),Hn)}return it(na([e.type,e.iv,e.sealed]),Hn)}function Ii(e){const t=ut(e,Hn),r=t.slice(lw,wa),i=wa;if(Gr(r)===nr){const c=i+gs,u=c+Wn,l=t.slice(i,c),h=t.slice(c,u),p=t.slice(u);return{type:r,sealed:p,iv:h,senderPublicKey:l}}const n=i+Wn,s=t.slice(i,n),a=t.slice(n);return{type:r,sealed:a,iv:s}}function bw(e,t){const r=Ii(e);return nu({type:Gr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?it(r.senderPublicKey,Ve):void 0,receiverPublicKey:t?.receiverPublicKey})}function nu(e){const t=e?.type||iu;if(t===nr){if(typeof e?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof e?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:e?.senderPublicKey,receiverPublicKey:e?.receiverPublicKey}}function ba(e){return e.type===nr&&typeof e.senderPublicKey=="string"&&typeof e.receiverPublicKey=="string"}var mw=Object.defineProperty,ma=Object.getOwnPropertySymbols,vw=Object.prototype.hasOwnProperty,Ew=Object.prototype.propertyIsEnumerable,va=(e,t,r)=>t in e?mw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ea=(e,t)=>{for(var r in t||(t={}))vw.call(t,r)&&va(e,r,t[r]);if(ma)for(var r of ma(t))Ew.call(t,r)&&va(e,r,t[r]);return e};const _w="ReactNative",Ze={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Dw="js";function ys(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function yr(){return!jr.getDocument()&&!!jr.getNavigator()&&navigator.product===_w}function wr(){return!ys()&&!!jr.getNavigator()&&!!jr.getDocument()}function Yr(){return yr()?Ze.reactNative:ys()?Ze.node:wr()?Ze.browser:Ze.unknown}function Sw(){var e;try{return yr()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(e=global.Application)==null?void 0:e.applicationId:void 0}catch{return}}function Iw(e,t){let r=Si.parse(e);return r=Ea(Ea({},r),t),e=Si.stringify(r),e}function Ow(){return iw.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function xw(){if(Yr()===Ze.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:i}=global.Platform;return[r,i].join("-")}const e=Jy();if(e===null)return"unknown";const t=e.os?e.os.replace(" ","").toLowerCase():"unknown";return e.type==="browser"?[t,e.name,e.version].join("-"):[t,e.version].join("-")}function Aw(){var e;const t=Yr();return t===Ze.browser?[t,((e=jr.getLocation())==null?void 0:e.host)||"unknown"].join(":"):t}function Rw(e,t,r){const i=xw(),n=Aw();return[[e,t].join("-"),[Dw,r].join("-"),i,n].join("/")}function Cw({protocol:e,version:t,relayUrl:r,sdkVersion:i,auth:n,projectId:s,useOnCloseEvent:a,bundleId:c}){const u=r.split("?"),l=Rw(e,t,i),h={auth:n,ua:l,projectId:s,useOnCloseEvent:a,origin:c||void 0},p=Iw(u[1]||"",h);return u[0]+"?"+p}function er(e,t){return e.filter(r=>t.includes(r)).length===e.length}function su(e){return Object.fromEntries(e.entries())}function ou(e){return new Map(Object.entries(e))}function hr(e=G.FIVE_MINUTES,t){const r=G.toMiliseconds(e||G.FIVE_MINUTES);let i,n,s;return{resolve:a=>{s&&i&&(clearTimeout(s),i(a))},reject:a=>{s&&n&&(clearTimeout(s),n(a))},done:()=>new Promise((a,c)=>{s=setTimeout(()=>{c(new Error(t))},r),i=a,n=c})}}function qr(e,t,r){return new Promise(async(i,n)=>{const s=setTimeout(()=>n(new Error(r)),t);try{const a=await e;i(a)}catch(a){n(a)}clearTimeout(s)})}function au(e,t){if(typeof t=="string"&&t.startsWith(`${e}:`))return t;if(e.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(e.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${e}`)}function Nw(e){return au("topic",e)}function Pw(e){return au("id",e)}function cu(e){const[t,r]=e.split(":"),i={id:void 0,topic:void 0};if(t==="topic"&&typeof r=="string")i.topic=r;else if(t==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return i}function Xe(e,t){return G.fromMiliseconds(Date.now()+G.toMiliseconds(e))}function Lt(e){return Date.now()>=G.toMiliseconds(e)}function Ee(e,t){return`${e}${t?`:${t}`:""}`}async function Tw({id:e,topic:t,wcDeepLink:r}){try{if(!r)return;let n=(typeof r=="string"?JSON.parse(r):r)?.href;if(typeof n!="string")return;n.endsWith("/")&&(n=n.slice(0,-1));const s=`${n}/wc?requestId=${e}&sessionTopic=${t}`,a=Yr();a===Ze.browser?s.startsWith("https://")?window.open(s,"_blank","noreferrer noopener"):window.open(s,"_self","noreferrer noopener"):a===Ze.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(s)}catch(i){console.error(i)}}async function $w(e,t){try{return await e.getItem(t)||(wr()?localStorage.getItem(t):void 0)}catch(r){console.error(r)}}const Uw="irn";function Gn(e){return e?.relay||{protocol:Uw}}function Ei(e){const t=uw[e];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${e}`);return t}var Fw=Object.defineProperty,Lw=Object.defineProperties,Mw=Object.getOwnPropertyDescriptors,_a=Object.getOwnPropertySymbols,Bw=Object.prototype.hasOwnProperty,jw=Object.prototype.propertyIsEnumerable,Da=(e,t,r)=>t in e?Fw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,qw=(e,t)=>{for(var r in t||(t={}))Bw.call(t,r)&&Da(e,r,t[r]);if(_a)for(var r of _a(t))jw.call(t,r)&&Da(e,r,t[r]);return e},zw=(e,t)=>Lw(e,Mw(t));function Kw(e,t="-"){const r={},i="relay"+t;return Object.keys(e).forEach(n=>{if(n.startsWith(i)){const s=n.replace(i,""),a=e[n];r[s]=a}}),r}function Sa(e){e=e.includes("wc://")?e.replace("wc://",""):e,e=e.includes("wc:")?e.replace("wc:",""):e;const t=e.indexOf(":"),r=e.indexOf("?")!==-1?e.indexOf("?"):void 0,i=e.substring(0,t),n=e.substring(t+1,r).split("@"),s=typeof r<"u"?e.substring(r):"",a=Si.parse(s);return{protocol:i,topic:Vw(n[0]),version:parseInt(n[1],10),symKey:a.symKey,relay:Kw(a),expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function Vw(e){return e.startsWith("//")?e.substring(2):e}function Hw(e,t="-"){const r="relay",i={};return Object.keys(e).forEach(n=>{const s=r+t+n;e[n]&&(i[s]=e[n])}),i}function Ww(e){return`${e.protocol}:${e.topic}@${e.version}?`+Si.stringify(zw(qw({symKey:e.symKey},Hw(e.relay)),{expiryTimestamp:e.expiryTimestamp}))}function br(e){const t=[];return e.forEach(r=>{const[i,n]=r.split(":");t.push(`${i}:${n}`)}),t}function kw(e){const t=[];return Object.values(e).forEach(r=>{t.push(...br(r.accounts))}),t}function Gw(e,t){const r=[];return Object.values(e).forEach(i=>{br(i.accounts).includes(t)&&r.push(...i.methods)}),r}function Yw(e,t){const r=[];return Object.values(e).forEach(i=>{br(i.accounts).includes(t)&&r.push(...i.events)}),r}const Jw={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Qw={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function z(e,t){const{message:r,code:i}=Qw[e];return{message:t?`${r} ${t}`:r,code:i}}function _e(e,t){const{message:r,code:i}=Jw[e];return{message:t?`${r} ${t}`:r,code:i}}function Jr(e,t){return!!Array.isArray(e)}function Oi(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function Ke(e){return typeof e>"u"}function Pe(e,t){return t&&Ke(e)?!0:typeof e=="string"&&!!e.trim().length}function ws(e,t){return t&&Ke(e)?!0:typeof e=="number"&&!isNaN(e)}function Xw(e,t){const{requiredNamespaces:r}=t,i=Object.keys(e.namespaces),n=Object.keys(r);let s=!0;return er(n,i)?(i.forEach(a=>{const{accounts:c,methods:u,events:l}=e.namespaces[a],h=br(c),p=r[a];(!er(tu(a,p),h)||!er(p.methods,u)||!er(p.events,l))&&(s=!1)}),s):!1}function xi(e){return Pe(e,!1)&&e.includes(":")?e.split(":").length===2:!1}function Zw(e){if(Pe(e,!1)&&e.includes(":")){const t=e.split(":");if(t.length===3){const r=t[0]+":"+t[1];return!!t[2]&&xi(r)}}return!1}function eb(e){if(Pe(e,!1))try{return typeof new URL(e)<"u"}catch{return!1}return!1}function tb(e){var t;return(t=e?.proposer)==null?void 0:t.publicKey}function rb(e){return e?.topic}function ib(e,t){let r=null;return Pe(e?.publicKey,!1)||(r=z("MISSING_OR_INVALID",`${t} controller public key should be a string`)),r}function Ia(e){let t=!0;return Jr(e)?e.length&&(t=e.every(r=>Pe(r,!1))):t=!1,t}function nb(e,t,r){let i=null;return Jr(t)&&t.length?t.forEach(n=>{i||xi(n)||(i=_e("UNSUPPORTED_CHAINS",`${r}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):xi(e)||(i=_e("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function sb(e,t,r){let i=null;return Object.entries(e).forEach(([n,s])=>{if(i)return;const a=nb(n,tu(n,s),`${t} ${r}`);a&&(i=a)}),i}function ob(e,t){let r=null;return Jr(e)?e.forEach(i=>{r||Zw(i)||(r=_e("UNSUPPORTED_ACCOUNTS",`${t}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=_e("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function ab(e,t){let r=null;return Object.values(e).forEach(i=>{if(r)return;const n=ob(i?.accounts,`${t} namespace`);n&&(r=n)}),r}function cb(e,t){let r=null;return Ia(e?.methods)?Ia(e?.events)||(r=_e("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):r=_e("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),r}function uu(e,t){let r=null;return Object.values(e).forEach(i=>{if(r)return;const n=cb(i,`${t}, namespace`);n&&(r=n)}),r}function ub(e,t,r){let i=null;if(e&&Oi(e)){const n=uu(e,t);n&&(i=n);const s=sb(e,t,r);s&&(i=s)}else i=z("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return i}function Dn(e,t){let r=null;if(e&&Oi(e)){const i=uu(e,t);i&&(r=i);const n=ab(e,t);n&&(r=n)}else r=z("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function lu(e){return Pe(e.protocol,!0)}function lb(e,t){let r=!1;return e?e&&Jr(e)&&e.length&&e.forEach(i=>{r=lu(i)}):r=!0,r}function hb(e){return typeof e=="number"}function ke(e){return typeof e<"u"&&typeof e!==null}function fb(e){return!(!e||typeof e!="object"||!e.code||!ws(e.code,!1)||!e.message||!Pe(e.message,!1))}function db(e){return!(Ke(e)||!Pe(e.method,!1))}function pb(e){return!(Ke(e)||Ke(e.result)&&Ke(e.error)||!ws(e.id,!1)||!Pe(e.jsonrpc,!1))}function gb(e){return!(Ke(e)||!Pe(e.name,!1))}function Oa(e,t){return!(!xi(t)||!kw(e).includes(t))}function yb(e,t,r){return Pe(r,!1)?Gw(e,t).includes(r):!1}function wb(e,t,r){return Pe(r,!1)?Yw(e,t).includes(r):!1}function xa(e,t,r){let i=null;const n=bb(e),s=mb(t),a=Object.keys(n),c=Object.keys(s),u=Aa(Object.keys(e)),l=Aa(Object.keys(t)),h=u.filter(p=>!l.includes(p));return h.length&&(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${h.toString()}
      Received: ${Object.keys(t).toString()}`)),er(a,c)||(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${a.toString()}
      Approved: ${c.toString()}`)),Object.keys(t).forEach(p=>{if(!p.includes(":")||i)return;const w=br(t[p].accounts);w.includes(p)||(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${p}
        Required: ${p}
        Approved: ${w.toString()}`))}),a.forEach(p=>{i||(er(n[p].methods,s[p].methods)?er(n[p].events,s[p].events)||(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${p}`)):i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${p}`))}),i}function bb(e){const t={};return Object.keys(e).forEach(r=>{var i;r.includes(":")?t[r]=e[r]:(i=e[r].chains)==null||i.forEach(n=>{t[n]={methods:e[r].methods,events:e[r].events}})}),t}function Aa(e){return[...new Set(e.map(t=>t.includes(":")?t.split(":")[0]:t))]}function mb(e){const t={};return Object.keys(e).forEach(r=>{r.includes(":")?t[r]=e[r]:br(e[r].accounts)?.forEach(n=>{t[n]={accounts:e[r].accounts.filter(s=>s.includes(`${n}:`)),methods:e[r].methods,events:e[r].events}})}),t}function vb(e,t){return ws(e,!1)&&e<=t.max&&e>=t.min}function Ra(){const e=Yr();return new Promise(t=>{switch(e){case Ze.browser:t(Eb());break;case Ze.reactNative:t(_b());break;case Ze.node:t(Db());break;default:t(!0)}})}function Eb(){return wr()&&navigator?.onLine}async function _b(){return yr()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function Db(){return!0}function Sb(e){switch(Yr()){case Ze.browser:Ib(e);break;case Ze.reactNative:Ob(e);break}}function Ib(e){!yr()&&wr()&&(window.addEventListener("online",()=>e(!0)),window.addEventListener("offline",()=>e(!1)))}function Ob(e){yr()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(t=>e(t?.isConnected))}const Sn={};let yi=class{static get(t){return Sn[t]}static set(t,r){Sn[t]=r}static delete(t){delete Sn[t]}};const xb="PARSE_ERROR",Ab="INVALID_REQUEST",Rb="METHOD_NOT_FOUND",Cb="INVALID_PARAMS",hu="INTERNAL_ERROR",bs="SERVER_ERROR",Nb=[-32700,-32600,-32601,-32602,-32603],Mr={[xb]:{code:-32700,message:"Parse error"},[Ab]:{code:-32600,message:"Invalid Request"},[Rb]:{code:-32601,message:"Method not found"},[Cb]:{code:-32602,message:"Invalid params"},[hu]:{code:-32603,message:"Internal error"},[bs]:{code:-32e3,message:"Server error"}},fu=bs;function Pb(e){return Nb.includes(e)}function Ca(e){return Object.keys(Mr).includes(e)?Mr[e]:Mr[fu]}function Tb(e){const t=Object.values(Mr).find(r=>r.code===e);return t||Mr[fu]}function $b(e,t,r){return e.message.includes("getaddrinfo ENOTFOUND")||e.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${t}`):e}var In={},_t={},Na;function Ub(){if(Na)return _t;Na=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.isBrowserCryptoAvailable=_t.getSubtleCrypto=_t.getBrowerCrypto=void 0;function e(){return(gt===null||gt===void 0?void 0:gt.crypto)||(gt===null||gt===void 0?void 0:gt.msCrypto)||{}}_t.getBrowerCrypto=e;function t(){const i=e();return i.subtle||i.webkitSubtle}_t.getSubtleCrypto=t;function r(){return!!e()&&!!t()}return _t.isBrowserCryptoAvailable=r,_t}var Dt={},Pa;function Fb(){if(Pa)return Dt;Pa=1,Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.isBrowser=Dt.isNode=Dt.isReactNative=void 0;function e(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Dt.isReactNative=e;function t(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Dt.isNode=t;function r(){return!e()&&!t()}return Dt.isBrowser=r,Dt}var Ta;function Lb(){return Ta||(Ta=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=At;t.__exportStar(Ub(),e),t.__exportStar(Fb(),e)}(In)),In}var Mb=Lb();function ms(e=3){const t=Date.now()*Math.pow(10,e),r=Math.floor(Math.random()*Math.pow(10,e));return t+r}function du(e=6){return BigInt(ms(e))}function pr(e,t,r){return{id:r||ms(),jsonrpc:"2.0",method:e,params:t}}function vs(e,t){return{id:e,jsonrpc:"2.0",result:t}}function Es(e,t,r){return{id:e,jsonrpc:"2.0",error:Bb(t)}}function Bb(e,t){return typeof e>"u"?Ca(hu):(typeof e=="string"&&(e=Object.assign(Object.assign({},Ca(bs)),{message:e})),Pb(e.code)&&(e=Tb(e.code)),e)}class jb{}class qb extends jb{constructor(){super()}}class zb extends qb{constructor(t){super()}}const Kb="^wss?:";function Vb(e){const t=e.match(new RegExp(/^\w+:/,"gi"));if(!(!t||!t.length))return t[0]}function Hb(e,t){const r=Vb(e);return typeof r>"u"?!1:new RegExp(t).test(r)}function $a(e){return Hb(e,Kb)}function Wb(e){return new RegExp("wss?://localhost(:d{2,5})?").test(e)}function pu(e){return typeof e=="object"&&"id"in e&&"jsonrpc"in e&&e.jsonrpc==="2.0"}function _s(e){return pu(e)&&"method"in e}function Ti(e){return pu(e)&&(xt(e)||at(e))}function xt(e){return"result"in e}function at(e){return"error"in e}class kb extends zb{constructor(t){super(t),this.events=new yt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(pr(t.method,t.params||[],t.id||du().toString()),r)}async requestStrict(t,r){return new Promise(async(i,n)=>{if(!this.connection.connected)try{await this.open()}catch(s){n(s)}this.events.on(`${t.id}`,s=>{at(s)?n(s.error):i(s.result)});try{await this.connection.send(t,r)}catch(s){n(s)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),Ti(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Gb=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Yb=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Ua=e=>e.split("?")[0],Fa=10,Jb=Gb();class Qb{constructor(t){if(this.url=t,this.events=new yt.EventEmitter,this.registering=!1,!$a(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Kr(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!$a(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),n(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,i)=>{const n=new URLSearchParams(t).get("origin"),s=Mb.isReactNative()?{headers:{origin:n}}:{rejectUnauthorized:!Wb(t)},a=new Jb(t,[],s);Yb()?a.onerror=c=>{const u=c;i(this.emitError(u.error))}:a.on("error",c=>{i(this.emitError(c))}),a.onopen=()=>{this.onOpen(a),r(a)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?Ri(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const i=this.parseError(r),n=i.message||i.toString(),s=Es(t,n);this.events.emit("payload",s)}parseError(t,r=this.url){return $b(t,Ua(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Fa&&this.events.setMaxListeners(Fa)}emitError(t){const r=this.parseError(new Error(t?.message||`WebSocket connection failed for host: ${Ua(this.url)}`));return this.events.emit("register_error",r),r}}var Fr={exports:{}};Fr.exports;var La;function Xb(){return La||(La=1,function(e,t){var r=200,i="__lodash_hash_undefined__",n=1,s=2,a=9007199254740991,c="[object Arguments]",u="[object Array]",l="[object AsyncFunction]",h="[object Boolean]",p="[object Date]",w="[object Error]",v="[object Function]",E="[object GeneratorFunction]",O="[object Map]",C="[object Number]",P="[object Null]",_="[object Object]",D="[object Promise]",g="[object Proxy]",y="[object RegExp]",f="[object Set]",o="[object String]",d="[object Symbol]",R="[object Undefined]",A="[object WeakMap]",N="[object ArrayBuffer]",B="[object DataView]",V="[object Float32Array]",U="[object Float64Array]",I="[object Int8Array]",b="[object Int16Array]",S="[object Int32Array]",T="[object Uint8Array]",q="[object Uint8ClampedArray]",L="[object Uint16Array]",H="[object Uint32Array]",K=/[\\^$.*+?()[\]{}|]/g,$=/^\[object .+?Constructor\]$/,j=/^(?:0|[1-9]\d*)$/,M={};M[V]=M[U]=M[I]=M[b]=M[S]=M[T]=M[q]=M[L]=M[H]=!0,M[c]=M[u]=M[N]=M[h]=M[B]=M[p]=M[w]=M[v]=M[O]=M[C]=M[_]=M[y]=M[f]=M[o]=M[A]=!1;var k=typeof gt=="object"&&gt&&gt.Object===Object&&gt,Q=typeof self=="object"&&self&&self.Object===Object&&self,Y=k||Q||Function("return this")(),J=t&&!t.nodeType&&t,ee=J&&!0&&e&&!e.nodeType&&e,re=ee&&ee.exports===J,ie=re&&k.process,ne=function(){try{return ie&&ie.binding&&ie.binding("util")}catch{}}(),Je=ne&&ne.isTypedArray;function lt(m,x){for(var F=-1,W=m==null?0:m.length,ae=0,X=[];++F<W;){var fe=m[F];x(fe,F,m)&&(X[ae++]=fe)}return X}function wt(m,x){for(var F=-1,W=x.length,ae=m.length;++F<W;)m[ae+F]=x[F];return m}function Ct(m,x){for(var F=-1,W=m==null?0:m.length;++F<W;)if(x(m[F],F,m))return!0;return!1}function jt(m,x){for(var F=-1,W=Array(m);++F<m;)W[F]=x(F);return W}function qt(m){return function(x){return m(x)}}function de(m,x){return m.has(x)}function le(m,x){return m?.[x]}function pe(m){var x=-1,F=Array(m.size);return m.forEach(function(W,ae){F[++x]=[ae,W]}),F}function ge(m,x){return function(F){return m(x(F))}}function ye(m){var x=-1,F=Array(m.size);return m.forEach(function(W){F[++x]=W}),F}var we=Array.prototype,be=Function.prototype,ce=Object.prototype,he=Y["__core-js_shared__"],me=be.toString,se=ce.hasOwnProperty,Se=function(){var m=/[^.]+$/.exec(he&&he.keys&&he.keys.IE_PROTO||"");return m?"Symbol(src)_1."+m:""}(),Ie=ce.toString,Ae=RegExp("^"+me.call(se).replace(K,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Oe=re?Y.Buffer:void 0,ve=Y.Symbol,Os=Y.Uint8Array,xs=ce.propertyIsEnumerable,Uu=we.splice,zt=ve?ve.toStringTag:void 0,As=Object.getOwnPropertySymbols,Fu=Oe?Oe.isBuffer:void 0,Lu=ge(Object.keys,Object),Fi=sr(Y,"DataView"),mr=sr(Y,"Map"),Li=sr(Y,"Promise"),Mi=sr(Y,"Set"),Bi=sr(Y,"WeakMap"),vr=sr(Object,"create"),Mu=Ht(Fi),Bu=Ht(mr),ju=Ht(Li),qu=Ht(Mi),zu=Ht(Bi),Rs=ve?ve.prototype:void 0,ji=Rs?Rs.valueOf:void 0;function Kt(m){var x=-1,F=m==null?0:m.length;for(this.clear();++x<F;){var W=m[x];this.set(W[0],W[1])}}function Ku(){this.__data__=vr?vr(null):{},this.size=0}function Vu(m){var x=this.has(m)&&delete this.__data__[m];return this.size-=x?1:0,x}function Hu(m){var x=this.__data__;if(vr){var F=x[m];return F===i?void 0:F}return se.call(x,m)?x[m]:void 0}function Wu(m){var x=this.__data__;return vr?x[m]!==void 0:se.call(x,m)}function ku(m,x){var F=this.__data__;return this.size+=this.has(m)?0:1,F[m]=vr&&x===void 0?i:x,this}Kt.prototype.clear=Ku,Kt.prototype.delete=Vu,Kt.prototype.get=Hu,Kt.prototype.has=Wu,Kt.prototype.set=ku;function bt(m){var x=-1,F=m==null?0:m.length;for(this.clear();++x<F;){var W=m[x];this.set(W[0],W[1])}}function Gu(){this.__data__=[],this.size=0}function Yu(m){var x=this.__data__,F=Zr(x,m);if(F<0)return!1;var W=x.length-1;return F==W?x.pop():Uu.call(x,F,1),--this.size,!0}function Ju(m){var x=this.__data__,F=Zr(x,m);return F<0?void 0:x[F][1]}function Qu(m){return Zr(this.__data__,m)>-1}function Xu(m,x){var F=this.__data__,W=Zr(F,m);return W<0?(++this.size,F.push([m,x])):F[W][1]=x,this}bt.prototype.clear=Gu,bt.prototype.delete=Yu,bt.prototype.get=Ju,bt.prototype.has=Qu,bt.prototype.set=Xu;function Vt(m){var x=-1,F=m==null?0:m.length;for(this.clear();++x<F;){var W=m[x];this.set(W[0],W[1])}}function Zu(){this.size=0,this.__data__={hash:new Kt,map:new(mr||bt),string:new Kt}}function el(m){var x=ei(this,m).delete(m);return this.size-=x?1:0,x}function tl(m){return ei(this,m).get(m)}function rl(m){return ei(this,m).has(m)}function il(m,x){var F=ei(this,m),W=F.size;return F.set(m,x),this.size+=F.size==W?0:1,this}Vt.prototype.clear=Zu,Vt.prototype.delete=el,Vt.prototype.get=tl,Vt.prototype.has=rl,Vt.prototype.set=il;function Xr(m){var x=-1,F=m==null?0:m.length;for(this.__data__=new Vt;++x<F;)this.add(m[x])}function nl(m){return this.__data__.set(m,i),this}function sl(m){return this.__data__.has(m)}Xr.prototype.add=Xr.prototype.push=nl,Xr.prototype.has=sl;function Nt(m){var x=this.__data__=new bt(m);this.size=x.size}function ol(){this.__data__=new bt,this.size=0}function al(m){var x=this.__data__,F=x.delete(m);return this.size=x.size,F}function cl(m){return this.__data__.get(m)}function ul(m){return this.__data__.has(m)}function ll(m,x){var F=this.__data__;if(F instanceof bt){var W=F.__data__;if(!mr||W.length<r-1)return W.push([m,x]),this.size=++F.size,this;F=this.__data__=new Vt(W)}return F.set(m,x),this.size=F.size,this}Nt.prototype.clear=ol,Nt.prototype.delete=al,Nt.prototype.get=cl,Nt.prototype.has=ul,Nt.prototype.set=ll;function hl(m,x){var F=ti(m),W=!F&&Ol(m),ae=!F&&!W&&qi(m),X=!F&&!W&&!ae&&Ms(m),fe=F||W||ae||X,Re=fe?jt(m.length,String):[],$e=Re.length;for(var ue in m)se.call(m,ue)&&!(fe&&(ue=="length"||ae&&(ue=="offset"||ue=="parent")||X&&(ue=="buffer"||ue=="byteLength"||ue=="byteOffset")||El(ue,$e)))&&Re.push(ue);return Re}function Zr(m,x){for(var F=m.length;F--;)if($s(m[F][0],x))return F;return-1}function fl(m,x,F){var W=x(m);return ti(m)?W:wt(W,F(m))}function Er(m){return m==null?m===void 0?R:P:zt&&zt in Object(m)?ml(m):Il(m)}function Cs(m){return _r(m)&&Er(m)==c}function Ns(m,x,F,W,ae){return m===x?!0:m==null||x==null||!_r(m)&&!_r(x)?m!==m&&x!==x:dl(m,x,F,W,Ns,ae)}function dl(m,x,F,W,ae,X){var fe=ti(m),Re=ti(x),$e=fe?u:Pt(m),ue=Re?u:Pt(x);$e=$e==c?_:$e,ue=ue==c?_:ue;var Qe=$e==_,nt=ue==_,Me=$e==ue;if(Me&&qi(m)){if(!qi(x))return!1;fe=!0,Qe=!1}if(Me&&!Qe)return X||(X=new Nt),fe||Ms(m)?Ps(m,x,F,W,ae,X):wl(m,x,$e,F,W,ae,X);if(!(F&n)){var et=Qe&&se.call(m,"__wrapped__"),tt=nt&&se.call(x,"__wrapped__");if(et||tt){var Tt=et?m.value():m,mt=tt?x.value():x;return X||(X=new Nt),ae(Tt,mt,F,W,X)}}return Me?(X||(X=new Nt),bl(m,x,F,W,ae,X)):!1}function pl(m){if(!Ls(m)||Dl(m))return!1;var x=Us(m)?Ae:$;return x.test(Ht(m))}function gl(m){return _r(m)&&Fs(m.length)&&!!M[Er(m)]}function yl(m){if(!Sl(m))return Lu(m);var x=[];for(var F in Object(m))se.call(m,F)&&F!="constructor"&&x.push(F);return x}function Ps(m,x,F,W,ae,X){var fe=F&n,Re=m.length,$e=x.length;if(Re!=$e&&!(fe&&$e>Re))return!1;var ue=X.get(m);if(ue&&X.get(x))return ue==x;var Qe=-1,nt=!0,Me=F&s?new Xr:void 0;for(X.set(m,x),X.set(x,m);++Qe<Re;){var et=m[Qe],tt=x[Qe];if(W)var Tt=fe?W(tt,et,Qe,x,m,X):W(et,tt,Qe,m,x,X);if(Tt!==void 0){if(Tt)continue;nt=!1;break}if(Me){if(!Ct(x,function(mt,Wt){if(!de(Me,Wt)&&(et===mt||ae(et,mt,F,W,X)))return Me.push(Wt)})){nt=!1;break}}else if(!(et===tt||ae(et,tt,F,W,X))){nt=!1;break}}return X.delete(m),X.delete(x),nt}function wl(m,x,F,W,ae,X,fe){switch(F){case B:if(m.byteLength!=x.byteLength||m.byteOffset!=x.byteOffset)return!1;m=m.buffer,x=x.buffer;case N:return!(m.byteLength!=x.byteLength||!X(new Os(m),new Os(x)));case h:case p:case C:return $s(+m,+x);case w:return m.name==x.name&&m.message==x.message;case y:case o:return m==x+"";case O:var Re=pe;case f:var $e=W&n;if(Re||(Re=ye),m.size!=x.size&&!$e)return!1;var ue=fe.get(m);if(ue)return ue==x;W|=s,fe.set(m,x);var Qe=Ps(Re(m),Re(x),W,ae,X,fe);return fe.delete(m),Qe;case d:if(ji)return ji.call(m)==ji.call(x)}return!1}function bl(m,x,F,W,ae,X){var fe=F&n,Re=Ts(m),$e=Re.length,ue=Ts(x),Qe=ue.length;if($e!=Qe&&!fe)return!1;for(var nt=$e;nt--;){var Me=Re[nt];if(!(fe?Me in x:se.call(x,Me)))return!1}var et=X.get(m);if(et&&X.get(x))return et==x;var tt=!0;X.set(m,x),X.set(x,m);for(var Tt=fe;++nt<$e;){Me=Re[nt];var mt=m[Me],Wt=x[Me];if(W)var Bs=fe?W(Wt,mt,Me,x,m,X):W(mt,Wt,Me,m,x,X);if(!(Bs===void 0?mt===Wt||ae(mt,Wt,F,W,X):Bs)){tt=!1;break}Tt||(Tt=Me=="constructor")}if(tt&&!Tt){var ri=m.constructor,ii=x.constructor;ri!=ii&&"constructor"in m&&"constructor"in x&&!(typeof ri=="function"&&ri instanceof ri&&typeof ii=="function"&&ii instanceof ii)&&(tt=!1)}return X.delete(m),X.delete(x),tt}function Ts(m){return fl(m,Rl,vl)}function ei(m,x){var F=m.__data__;return _l(x)?F[typeof x=="string"?"string":"hash"]:F.map}function sr(m,x){var F=le(m,x);return pl(F)?F:void 0}function ml(m){var x=se.call(m,zt),F=m[zt];try{m[zt]=void 0;var W=!0}catch{}var ae=Ie.call(m);return W&&(x?m[zt]=F:delete m[zt]),ae}var vl=As?function(m){return m==null?[]:(m=Object(m),lt(As(m),function(x){return xs.call(m,x)}))}:Cl,Pt=Er;(Fi&&Pt(new Fi(new ArrayBuffer(1)))!=B||mr&&Pt(new mr)!=O||Li&&Pt(Li.resolve())!=D||Mi&&Pt(new Mi)!=f||Bi&&Pt(new Bi)!=A)&&(Pt=function(m){var x=Er(m),F=x==_?m.constructor:void 0,W=F?Ht(F):"";if(W)switch(W){case Mu:return B;case Bu:return O;case ju:return D;case qu:return f;case zu:return A}return x});function El(m,x){return x=x??a,!!x&&(typeof m=="number"||j.test(m))&&m>-1&&m%1==0&&m<x}function _l(m){var x=typeof m;return x=="string"||x=="number"||x=="symbol"||x=="boolean"?m!=="__proto__":m===null}function Dl(m){return!!Se&&Se in m}function Sl(m){var x=m&&m.constructor,F=typeof x=="function"&&x.prototype||ce;return m===F}function Il(m){return Ie.call(m)}function Ht(m){if(m!=null){try{return me.call(m)}catch{}try{return m+""}catch{}}return""}function $s(m,x){return m===x||m!==m&&x!==x}var Ol=Cs(function(){return arguments}())?Cs:function(m){return _r(m)&&se.call(m,"callee")&&!xs.call(m,"callee")},ti=Array.isArray;function xl(m){return m!=null&&Fs(m.length)&&!Us(m)}var qi=Fu||Nl;function Al(m,x){return Ns(m,x)}function Us(m){if(!Ls(m))return!1;var x=Er(m);return x==v||x==E||x==l||x==g}function Fs(m){return typeof m=="number"&&m>-1&&m%1==0&&m<=a}function Ls(m){var x=typeof m;return m!=null&&(x=="object"||x=="function")}function _r(m){return m!=null&&typeof m=="object"}var Ms=Je?qt(Je):gl;function Rl(m){return xl(m)?hl(m):yl(m)}function Cl(){return[]}function Nl(){return!1}e.exports=Al}(Fr,Fr.exports)),Fr.exports}var Zb=Xb();const em=Ai(Zb);function tm(e,t){return t=t||{},new Promise(function(r,i){var n=new XMLHttpRequest,s=[],a=[],c={},u=function(){return{ok:(n.status/100|0)==2,statusText:n.statusText,status:n.status,url:n.responseURL,text:function(){return Promise.resolve(n.responseText)},json:function(){return Promise.resolve(n.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([n.response]))},clone:u,headers:{keys:function(){return s},entries:function(){return a},get:function(h){return c[h.toLowerCase()]},has:function(h){return h.toLowerCase()in c}}}};for(var l in n.open(t.method||"get",e,!0),n.onload=function(){n.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(h,p,w){s.push(p=p.toLowerCase()),a.push([p,w]),c[p]=c[p]?c[p]+","+w:w}),r(u())},n.onerror=i,n.withCredentials=t.credentials=="include",t.headers)n.setRequestHeader(l,t.headers[l]);n.send(t.body||null)})}const rm=Object.freeze(Object.defineProperty({__proto__:null,default:tm},Symbol.toStringTag,{value:"Module"})),Ma=Xn(rm);var On,Ba;function im(){return Ba||(Ba=1,On=self.fetch||(self.fetch=Ma.default||Ma)),On}var nm=im();const sm=Ai(nm);var om={};function am(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<e.length;n++){var s=e.charAt(n),a=s.charCodeAt(0);if(r[a]!==255)throw new TypeError(s+" is ambiguous");r[a]=n}var c=e.length,u=e.charAt(0),l=Math.log(c)/Math.log(256),h=Math.log(256)/Math.log(c);function p(E){if(E instanceof Uint8Array||(ArrayBuffer.isView(E)?E=new Uint8Array(E.buffer,E.byteOffset,E.byteLength):Array.isArray(E)&&(E=Uint8Array.from(E))),!(E instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(E.length===0)return"";for(var O=0,C=0,P=0,_=E.length;P!==_&&E[P]===0;)P++,O++;for(var D=(_-P)*h+1>>>0,g=new Uint8Array(D);P!==_;){for(var y=E[P],f=0,o=D-1;(y!==0||f<C)&&o!==-1;o--,f++)y+=256*g[o]>>>0,g[o]=y%c>>>0,y=y/c>>>0;if(y!==0)throw new Error("Non-zero carry");C=f,P++}for(var d=D-C;d!==D&&g[d]===0;)d++;for(var R=u.repeat(O);d<D;++d)R+=e.charAt(g[d]);return R}function w(E){if(typeof E!="string")throw new TypeError("Expected String");if(E.length===0)return new Uint8Array;var O=0;if(E[O]!==" "){for(var C=0,P=0;E[O]===u;)C++,O++;for(var _=(E.length-O)*l+1>>>0,D=new Uint8Array(_);E[O];){var g=r[E.charCodeAt(O)];if(g===255)return;for(var y=0,f=_-1;(g!==0||y<P)&&f!==-1;f--,y++)g+=c*D[f]>>>0,D[f]=g%256>>>0,g=g/256>>>0;if(g!==0)throw new Error("Non-zero carry");P=y,O++}if(E[O]!==" "){for(var o=_-P;o!==_&&D[o]===0;)o++;for(var d=new Uint8Array(C+(_-o)),R=C;o!==_;)d[R++]=D[o++];return d}}}function v(E){var O=w(E);if(O)return O;throw new Error(`Non-${t} character`)}return{encode:p,decodeUnsafe:w,decode:v}}var cm=am,um=cm;const gu=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},lm=e=>new TextEncoder().encode(e),hm=e=>new TextDecoder().decode(e);class fm{constructor(t,r,i){this.name=t,this.prefix=r,this.baseEncode=i}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class dm{constructor(t,r,i){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return yu(this,t)}}class pm{constructor(t){this.decoders=t}or(t){return yu(this,t)}decode(t){const r=t[0],i=this.decoders[r];if(i)return i.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const yu=(e,t)=>new pm({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class gm{constructor(t,r,i,n){this.name=t,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new fm(t,r,i),this.decoder=new dm(t,r,n)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const $i=({name:e,prefix:t,encode:r,decode:i})=>new gm(e,t,r,i),Qr=({prefix:e,name:t,alphabet:r})=>{const{encode:i,decode:n}=um(r,t);return $i({prefix:e,name:t,encode:i,decode:s=>gu(n(s))})},ym=(e,t,r,i)=>{const n={};for(let h=0;h<t.length;++h)n[t[h]]=h;let s=e.length;for(;e[s-1]==="=";)--s;const a=new Uint8Array(s*r/8|0);let c=0,u=0,l=0;for(let h=0;h<s;++h){const p=n[e[h]];if(p===void 0)throw new SyntaxError(`Non-${i} character`);u=u<<r|p,c+=r,c>=8&&(c-=8,a[l++]=255&u>>c)}if(c>=r||255&u<<8-c)throw new SyntaxError("Unexpected end of data");return a},wm=(e,t,r)=>{const i=t[t.length-1]==="=",n=(1<<r)-1;let s="",a=0,c=0;for(let u=0;u<e.length;++u)for(c=c<<8|e[u],a+=8;a>r;)a-=r,s+=t[n&c>>a];if(a&&(s+=t[n&c<<r-a]),i)for(;s.length*r&7;)s+="=";return s},Le=({name:e,prefix:t,bitsPerChar:r,alphabet:i})=>$i({prefix:t,name:e,encode(n){return wm(n,i,r)},decode(n){return ym(n,i,r,e)}}),bm=$i({prefix:"\0",name:"identity",encode:e=>hm(e),decode:e=>lm(e)});var mm=Object.freeze({__proto__:null,identity:bm});const vm=Le({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Em=Object.freeze({__proto__:null,base2:vm});const _m=Le({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Dm=Object.freeze({__proto__:null,base8:_m});const Sm=Qr({prefix:"9",name:"base10",alphabet:"0123456789"});var Im=Object.freeze({__proto__:null,base10:Sm});const Om=Le({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),xm=Le({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Am=Object.freeze({__proto__:null,base16:Om,base16upper:xm});const Rm=Le({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Cm=Le({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Nm=Le({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Pm=Le({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Tm=Le({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),$m=Le({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Um=Le({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Fm=Le({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Lm=Le({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Mm=Object.freeze({__proto__:null,base32:Rm,base32upper:Cm,base32pad:Nm,base32padupper:Pm,base32hex:Tm,base32hexupper:$m,base32hexpad:Um,base32hexpadupper:Fm,base32z:Lm});const Bm=Qr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),jm=Qr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var qm=Object.freeze({__proto__:null,base36:Bm,base36upper:jm});const zm=Qr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Km=Qr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Vm=Object.freeze({__proto__:null,base58btc:zm,base58flickr:Km});const Hm=Le({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Wm=Le({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),km=Le({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Gm=Le({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Ym=Object.freeze({__proto__:null,base64:Hm,base64pad:Wm,base64url:km,base64urlpad:Gm});const wu=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Jm=wu.reduce((e,t,r)=>(e[r]=t,e),[]),Qm=wu.reduce((e,t,r)=>(e[t.codePointAt(0)]=r,e),[]);function Xm(e){return e.reduce((t,r)=>(t+=Jm[r],t),"")}function Zm(e){const t=[];for(const r of e){const i=Qm[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(i)}return new Uint8Array(t)}const e0=$i({prefix:"🚀",name:"base256emoji",encode:Xm,decode:Zm});var t0=Object.freeze({__proto__:null,base256emoji:e0}),r0=bu,ja=128,i0=-128,n0=Math.pow(2,31);function bu(e,t,r){t=t||[],r=r||0;for(var i=r;e>=n0;)t[r++]=e&255|ja,e/=128;for(;e&i0;)t[r++]=e&255|ja,e>>>=7;return t[r]=e|0,bu.bytes=r-i+1,t}var s0=Yn,o0=128,qa=127;function Yn(e,i){var r=0,i=i||0,n=0,s=i,a,c=e.length;do{if(s>=c)throw Yn.bytes=0,new RangeError("Could not decode varint");a=e[s++],r+=n<28?(a&qa)<<n:(a&qa)*Math.pow(2,n),n+=7}while(a>=o0);return Yn.bytes=s-i,r}var a0=Math.pow(2,7),c0=Math.pow(2,14),u0=Math.pow(2,21),l0=Math.pow(2,28),h0=Math.pow(2,35),f0=Math.pow(2,42),d0=Math.pow(2,49),p0=Math.pow(2,56),g0=Math.pow(2,63),y0=function(e){return e<a0?1:e<c0?2:e<u0?3:e<l0?4:e<h0?5:e<f0?6:e<d0?7:e<p0?8:e<g0?9:10},w0={encode:r0,decode:s0,encodingLength:y0},mu=w0;const za=(e,t,r=0)=>(mu.encode(e,t,r),t),Ka=e=>mu.encodingLength(e),Jn=(e,t)=>{const r=t.byteLength,i=Ka(e),n=i+Ka(r),s=new Uint8Array(n+r);return za(e,s,0),za(r,s,i),s.set(t,n),new b0(e,r,t,s)};class b0{constructor(t,r,i,n){this.code=t,this.size=r,this.digest=i,this.bytes=n}}const vu=({name:e,code:t,encode:r})=>new m0(e,t,r);class m0{constructor(t,r,i){this.name=t,this.code=r,this.encode=i}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?Jn(this.code,r):r.then(i=>Jn(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Eu=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),v0=vu({name:"sha2-256",code:18,encode:Eu("SHA-256")}),E0=vu({name:"sha2-512",code:19,encode:Eu("SHA-512")});var _0=Object.freeze({__proto__:null,sha256:v0,sha512:E0});const _u=0,D0="identity",Du=gu,S0=e=>Jn(_u,Du(e)),I0={code:_u,name:D0,encode:Du,digest:S0};var O0=Object.freeze({__proto__:null,identity:I0});new TextEncoder,new TextDecoder;const Va={...mm,...Em,...Dm,...Im,...Am,...Mm,...qm,...Vm,...Ym,...t0};({..._0,...O0});function Su(e){return globalThis.Buffer!=null?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function x0(e=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Su(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Iu(e,t,r,i){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:i}}}const Ha=Iu("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),xn=Iu("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);const t=x0(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),A0={utf8:Ha,"utf-8":Ha,hex:Va.base16,latin1:xn,ascii:xn,binary:xn,...Va};function R0(e,t="utf8"){const r=A0[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Su(globalThis.Buffer.from(e,"utf-8")):r.decoder.decode(`${r.prefix}${e}`)}const Ou="wc",C0=2,xu="core",Mt=`${Ou}@2:${xu}:`,N0={logger:"error"},P0={database:":memory:"},T0="crypto",Wa="client_ed25519_seed",$0=G.ONE_DAY,U0="keychain",F0="0.3",L0="messages",M0="0.3",B0=G.SIX_HOURS,j0="publisher",Au="irn",q0="error",Ru="wss://relay.walletconnect.com",ka="wss://relay.walletconnect.org",z0="relayer",qe={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},K0="_subscription",St={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},V0=G.ONE_SECOND,H0="2.11.2",W0=1e4,k0="0.3",G0="WALLETCONNECT_CLIENT_ID",ot={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Y0="subscription",J0="0.3",Q0=G.FIVE_SECONDS*1e3,X0="pairing",Z0="0.3",$r={wc_pairingDelete:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:G.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:G.ONE_DAY,prompt:!1,tag:0},res:{ttl:G.ONE_DAY,prompt:!1,tag:0}}},Lr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},pt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},e1="history",t1="0.3",r1="expirer",rt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},i1="0.3",An="verify-api",fr="https://verify.walletconnect.com",Qn="https://verify.walletconnect.org",n1=[fr,Qn],s1="echo",o1="https://echo.walletconnect.com";class a1{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=U0,this.version=F0,this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,n)=>{this.isInitialized(),this.keychain.set(i,n),await this.persist()},this.get=i=>{this.isInitialized();const n=this.keychain.get(i);if(typeof n>"u"){const{message:s}=z("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return n},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=t,this.logger=Ye(r,this.name)}get context(){return Ge(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,su(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?ou(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class c1{constructor(t,r,i){this.core=t,this.logger=r,this.name=T0,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=n=>(this.isInitialized(),this.keychain.has(n)),this.getClientId=async()=>{this.isInitialized();const n=await this.getClientSeed(),s=qo(n);return Vc(s.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const n=hw();return this.setPrivateKey(n.publicKey,n.privateKey)},this.signJWT=async n=>{this.isInitialized();const s=await this.getClientSeed(),a=qo(s),c=kn();return await Pg(c,n,$0,a)},this.generateSharedKey=(n,s,a)=>{this.isInitialized();const c=this.getPrivateKey(n),u=fw(c,s);return this.setSymKey(u,a)},this.setSymKey=async(n,s)=>{this.isInitialized();const a=s||dw(n);return await this.keychain.set(a,n),a},this.deleteKeyPair=async n=>{this.isInitialized(),await this.keychain.del(n)},this.deleteSymKey=async n=>{this.isInitialized(),await this.keychain.del(n)},this.encode=async(n,s,a)=>{this.isInitialized();const c=nu(a),u=Kr(s);if(ba(c)){const w=c.senderPublicKey,v=c.receiverPublicKey;n=await this.generateSharedKey(w,v)}const l=this.getSymKey(n),{type:h,senderPublicKey:p}=c;return gw({type:h,symKey:l,message:u,senderPublicKey:p})},this.decode=async(n,s,a)=>{this.isInitialized();const c=bw(s,a);if(ba(c)){const u=c.receiverPublicKey,l=c.senderPublicKey;n=await this.generateSharedKey(u,l)}try{const u=this.getSymKey(n),l=yw({symKey:u,encoded:s});return Ri(l)}catch(u){this.logger.error(`Failed to decode message from topic: '${n}', clientId: '${await this.getClientId()}'`),this.logger.error(u)}},this.getPayloadType=n=>{const s=Ii(n);return Gr(s.type)},this.getPayloadSenderPublicKey=n=>{const s=Ii(n);return s.senderPublicKey?it(s.senderPublicKey,Ve):void 0},this.core=t,this.logger=Ye(r,this.name),this.keychain=i||new a1(this.core,this.logger)}get context(){return Ge(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(Wa)}catch{t=kn(),await this.keychain.set(Wa,t)}return R0(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class u1 extends Pf{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=L0,this.version=M0,this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,n)=>{this.isInitialized();const s=dr(n);let a=this.messages.get(i);return typeof a>"u"&&(a={}),typeof a[s]<"u"||(a[s]=n,this.messages.set(i,a),await this.persist()),s},this.get=i=>{this.isInitialized();let n=this.messages.get(i);return typeof n>"u"&&(n={}),n},this.has=(i,n)=>{this.isInitialized();const s=this.get(i),a=dr(n);return typeof s[a]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=Ye(t,this.name),this.core=r}get context(){return Ge(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,su(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?ou(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class l1 extends Tf{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new yt.EventEmitter,this.name=j0,this.queue=new Map,this.publishTimeout=G.toMiliseconds(G.TEN_SECONDS*2),this.needsTransportRestart=!1,this.publish=async(i,n,s)=>{var a;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:s}});try{const c=s?.ttl||B0,u=Gn(s),l=s?.prompt||!1,h=s?.tag||0,p=s?.id||du().toString(),w={topic:i,message:n,opts:{ttl:c,relay:u,prompt:l,tag:h,id:p}},v=setTimeout(()=>this.queue.set(p,w),this.publishTimeout);try{await await qr(this.rpcPublish(i,n,c,u,l,h,p),this.publishTimeout,`Failed to publish payload, please try again. id:${p} tag:${h}`),this.removeRequestFromQueue(p),this.relayer.events.emit(qe.publish,w)}catch(E){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(a=s?.internal)!=null&&a.throwOnFailedPublish)throw this.removeRequestFromQueue(p),E;return}finally{clearTimeout(v)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:s}})}catch(c){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(c),c}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.relayer=t,this.logger=Ye(r,this.name),this.registerEventListeners()}get context(){return Ge(this.logger)}rpcPublish(t,r,i,n,s,a,c){var u,l,h,p;const w={method:Ei(n.protocol).publish,params:{topic:t,message:r,ttl:i,prompt:s,tag:a},id:c};return Ke((u=w.params)==null?void 0:u.prompt)&&((l=w.params)==null||delete l.prompt),Ke((h=w.params)==null?void 0:h.tag)&&((p=w.params)==null||delete p.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:w}),this.relayer.request(w)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:i,opts:n}=t;await this.publish(r,i,n)})}registerEventListeners(){this.relayer.core.heartbeat.on(Vr.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(qe.connection_stalled);return}this.checkQueue()}),this.relayer.on(qe.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class h1{constructor(){this.map=new Map,this.set=(t,r)=>{const i=this.get(t);this.exists(t,r)||this.map.set(t,[...i,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const i=this.get(t);if(!this.exists(t,r))return;const n=i.filter(s=>s!==r);if(!n.length){this.map.delete(t);return}this.map.set(t,n)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var f1=Object.defineProperty,d1=Object.defineProperties,p1=Object.getOwnPropertyDescriptors,Ga=Object.getOwnPropertySymbols,g1=Object.prototype.hasOwnProperty,y1=Object.prototype.propertyIsEnumerable,Ya=(e,t,r)=>t in e?f1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ur=(e,t)=>{for(var r in t||(t={}))g1.call(t,r)&&Ya(e,r,t[r]);if(Ga)for(var r of Ga(t))y1.call(t,r)&&Ya(e,r,t[r]);return e},Rn=(e,t)=>d1(e,p1(t));class w1 extends Ff{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new h1,this.events=new yt.EventEmitter,this.name=Y0,this.version=J0,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Mt,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(i,n)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}});try{const s=Gn(n),a={topic:i,relay:s};this.pending.set(i,a);const c=await this.rpcSubscribe(i,s);return this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}}),c}catch(s){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(s),s}},this.unsubscribe=async(i,n)=>{await this.restartToComplete(),this.isInitialized(),typeof n?.id<"u"?await this.unsubscribeById(i,n.id,n):await this.unsubscribeByTopic(i,n)},this.isSubscribed=async i=>{if(this.topics.includes(i))return!0;const n=`${this.pendingSubscriptionWatchLabel}_${i}`;return await new Promise((s,a)=>{const c=new G.Watch;c.start(n);const u=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(u),c.stop(n),s(!0)),c.elapsed(n)>=Q0&&(clearInterval(u),c.stop(n),a(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=Ye(r,this.name),this.clientId=""}get context(){return Ge(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let i=!1;try{i=this.getSubscription(t).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const i=this.topicMap.get(t);await Promise.all(i.map(async n=>await this.unsubscribeById(t,n,r)))}async unsubscribeById(t,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:i}});try{const n=Gn(i);await this.rpcUnsubscribe(t,r,n);const s=_e("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:i}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(t,r){const i={method:Ei(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await qr(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(qe.connection_stalled)}return dr(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,i={method:Ei(r.protocol).batchSubscribe,params:{topics:t.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{return await await qr(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(qe.connection_stalled)}}rpcUnsubscribe(t,r,i){const n={method:Ei(i.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}onSubscribe(t,r){this.setSubscription(t,Rn(Ur({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,Ur({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,i),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,Ur({},r)),this.topicMap.set(r.topic,t),this.events.emit(ot.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(i)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const i=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(i.topic,t),this.events.emit(ot.deleted,Rn(Ur({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(ot.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const i=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(ot.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);Jr(r)&&this.onBatchSubscribe(r.map((i,n)=>Rn(Ur({},t[n]),{id:i})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(Vr.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(qe.connect,async()=>{await this.onConnect()}),this.relayer.on(qe.disconnect,()=>{this.onDisconnect()}),this.events.on(ot.created,async t=>{const r=ot.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(ot.deleted,async t=>{const r=ot.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var b1=Object.defineProperty,Ja=Object.getOwnPropertySymbols,m1=Object.prototype.hasOwnProperty,v1=Object.prototype.propertyIsEnumerable,Qa=(e,t,r)=>t in e?b1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,E1=(e,t)=>{for(var r in t||(t={}))m1.call(t,r)&&Qa(e,r,t[r]);if(Ja)for(var r of Ja(t))v1.call(t,r)&&Qa(e,r,t[r]);return e};class _1 extends $f{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new yt.EventEmitter,this.name=z0,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.requestsInFlight=new Map,this.request=async r=>{this.logger.debug("Publishing Request Payload");const i=r.id;try{await this.toEstablishConnection();const n=this.provider.request(r);return this.requestsInFlight.set(i,{promise:n,request:r}),await n}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}finally{this.requestsInFlight.delete(i)}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(qe.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(qe.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(St.payload,this.onPayloadHandler),this.provider.on(St.connect,this.onConnectHandler),this.provider.on(St.disconnect,this.onDisconnectHandler),this.provider.on(St.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Ye(t.logger,this.name):es(ts({level:t.logger||q0})),this.messages=new u1(this.logger,t.core),this.subscriber=new w1(this,this.logger),this.publisher=new l1(this,this.logger),this.relayUrl=t?.relayUrl||Ru,this.projectId=t.projectId,this.bundleId=Sw(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${ka}...`),await this.restartTransport(ka)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},W0)}get context(){return Ge(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,i){this.isInitialized(),await this.publisher.publish(t,r,i),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var i;this.isInitialized();let n=((i=this.subscriber.topicMap.get(t))==null?void 0:i[0])||"";if(n)return n;let s;const a=c=>{c.topic===t&&(this.subscriber.off(ot.created,a),s())};return await Promise.all([new Promise(c=>{s=c,this.subscriber.on(ot.created,a)}),new Promise(async c=>{n=await this.subscriber.subscribe(t,r),c()})]),n}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.requestsInFlight.size>0&&(this.logger.debug("Waiting for all in-flight requests to finish before closing transport..."),this.requestsInFlight.forEach(async t=>{await t.promise})),this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await qr(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(ot.resubscribed,()=>{r()})}),new Promise(async(r,i)=>{try{await qr(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(n){i(n);return}r()})])}catch(r){this.logger.error(r);const i=r;if(!this.isConnectionStalled(i.message))throw r;this.provider.events.emit(St.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Ra())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new kb(new Qb(Cw({sdkVersion:H0,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:i}=t;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(t){const{topic:r,message:i}=t;if(!i||i.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const n=this.messages.has(r,i);return n&&this.logger.debug(`Ignoring duplicate message: ${i}`),n}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),_s(t)){if(!t.method.endsWith(K0))return;const r=t.params,{topic:i,message:n,publishedAt:s}=r.data,a={topic:i,message:n,publishedAt:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(E1({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(t),await this.onMessageEvent(a)}else Ti(t)&&this.events.emit(qe.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(qe.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=vs(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(St.payload,this.onPayloadHandler),this.provider.off(St.connect,this.onConnectHandler),this.provider.off(St.disconnect,this.onDisconnectHandler),this.provider.off(St.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(qe.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await Ra();Sb(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(i=>this.logger.error(i)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(i=>this.logger.error(i))))})}onProviderDisconnect(){this.events.emit(qe.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},G.toMiliseconds(V0)))}isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var D1=Object.defineProperty,Xa=Object.getOwnPropertySymbols,S1=Object.prototype.hasOwnProperty,I1=Object.prototype.propertyIsEnumerable,Za=(e,t,r)=>t in e?D1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ec=(e,t)=>{for(var r in t||(t={}))S1.call(t,r)&&Za(e,r,t[r]);if(Xa)for(var r of Xa(t))I1.call(t,r)&&Za(e,r,t[r]);return e};class Ui extends Uf{constructor(t,r,i,n=Mt,s=void 0){super(t,r,i,n),this.core=t,this.logger=r,this.name=i,this.map=new Map,this.version=k0,this.cached=[],this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{this.getKey&&a!==null&&!Ke(a)?this.map.set(this.getKey(a),a):tb(a)?this.map.set(a.id,a):rb(a)&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)},this.set=async(a,c)=>{this.isInitialized(),this.map.has(a)?await this.update(a,c):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:c}),this.map.set(a,c),await this.persist())},this.get=a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a)),this.getAll=a=>(this.isInitialized(),a?this.values.filter(c=>Object.keys(a).every(u=>em(c[u],a[u]))):this.values),this.update=async(a,c)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:c});const u=ec(ec({},this.getData(a)),c);this.map.set(a,u),await this.persist()},this.delete=async(a,c)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:c}),this.map.delete(a),await this.persist())},this.logger=Ye(r,this.name),this.storagePrefix=n,this.getKey=s}get context(){return Ge(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class O1{constructor(t,r){this.core=t,this.logger=r,this.name=X0,this.version=Z0,this.events=new lc,this.initialized=!1,this.storagePrefix=Mt,this.ignoredPayloadTypes=[nr],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=kn(),n=await this.core.crypto.setSymKey(i),s=Xe(G.FIVE_MINUTES),a={protocol:Au},c={topic:n,expiry:s,relay:a,active:!1},u=Ww({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:i,relay:a,expiryTimestamp:s});return await this.pairings.set(n,c),await this.core.relayer.subscribe(n),this.core.expirer.set(n,s),{topic:n,uri:u}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:n,symKey:s,relay:a,expiryTimestamp:c}=Sa(i.uri);let u;if(this.pairings.keys.includes(n)&&(u=this.pairings.get(n),u.active))throw new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);const l=c||Xe(G.FIVE_MINUTES),h={topic:n,relay:a,expiry:l,active:!1};return await this.pairings.set(n,h),this.core.expirer.set(n,l),i.activatePairing&&await this.activate({topic:n}),this.events.emit(Lr.create,h),this.core.crypto.keychain.has(n)||(await this.core.crypto.setSymKey(s,n),await this.core.relayer.subscribe(n,{relay:a})),h},this.activate=async({topic:i})=>{this.isInitialized();const n=Xe(G.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:n}),this.core.expirer.set(i,n)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.pairings.keys.includes(n)){const s=await this.sendRequest(n,"wc_pairingPing",{}),{done:a,resolve:c,reject:u}=hr();this.events.once(Ee("pairing_ping",s),({error:l})=>{l?u(l):c()}),await a()}},this.updateExpiry=async({topic:i,expiry:n})=>{this.isInitialized(),await this.pairings.update(i,{expiry:n})},this.updateMetadata=async({topic:i,metadata:n})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:n})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",_e("USER_DISCONNECTED")),await this.deletePairing(n))},this.sendRequest=async(i,n,s)=>{const a=pr(n,s),c=await this.core.crypto.encode(i,a),u=$r[n].req;return this.core.history.set(i,a),this.core.relayer.publish(i,c,u),a.id},this.sendResult=async(i,n,s)=>{const a=vs(i,s),c=await this.core.crypto.encode(n,a),u=await this.core.history.get(n,i),l=$r[u.request.method].res;await this.core.relayer.publish(n,c,l),await this.core.history.resolve(a)},this.sendError=async(i,n,s)=>{const a=Es(i,s),c=await this.core.crypto.encode(n,a),u=await this.core.history.get(n,i),l=$r[u.request.method]?$r[u.request.method].res:$r.unregistered_method.res;await this.core.relayer.publish(n,c,l),await this.core.history.resolve(a)},this.deletePairing=async(i,n)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,_e("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),n?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(n=>Lt(n.expiry));await Promise.all(i.map(n=>this.deletePairing(n.topic)))},this.onRelayEventRequest=i=>{const{topic:n,payload:s}=i;switch(s.method){case"wc_pairingPing":return this.onPairingPingRequest(n,s);case"wc_pairingDelete":return this.onPairingDeleteRequest(n,s);default:return this.onUnknownRpcMethodRequest(n,s)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:s}=i,a=(await this.core.history.get(n,s.id)).request.method;switch(a){case"wc_pairingPing":return this.onPairingPingResponse(n,s);default:return this.onUnknownRpcMethodResponse(a)}},this.onPairingPingRequest=async(i,n)=>{const{id:s}=n;try{this.isValidPing({topic:i}),await this.sendResult(s,i,!0),this.events.emit(Lr.ping,{id:s,topic:i})}catch(a){await this.sendError(s,i,a),this.logger.error(a)}},this.onPairingPingResponse=(i,n)=>{const{id:s}=n;setTimeout(()=>{xt(n)?this.events.emit(Ee("pairing_ping",s),{}):at(n)&&this.events.emit(Ee("pairing_ping",s),{error:n.error})},500)},this.onPairingDeleteRequest=async(i,n)=>{const{id:s}=n;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(Lr.delete,{id:s,topic:i})}catch(a){await this.sendError(s,i,a),this.logger.error(a)}},this.onUnknownRpcMethodRequest=async(i,n)=>{const{id:s,method:a}=n;try{if(this.registeredMethods.includes(a))return;const c=_e("WC_METHOD_UNSUPPORTED",a);await this.sendError(s,i,c),this.logger.error(c)}catch(c){await this.sendError(s,i,c),this.logger.error(c)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(_e("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{var n;if(!ke(i)){const{message:a}=z("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(a)}if(!eb(i.uri)){const{message:a}=z("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(a)}const s=Sa(i.uri);if(!((n=s?.relay)!=null&&n.protocol)){const{message:a}=z("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(a)}if(!(s!=null&&s.symKey)){const{message:a}=z("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(a)}if(s!=null&&s.expiryTimestamp&&G.toMiliseconds(s?.expiryTimestamp)<Date.now()){const{message:a}=z("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}},this.isValidPing=async i=>{if(!ke(i)){const{message:s}=z("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidDisconnect=async i=>{if(!ke(i)){const{message:s}=z("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidPairingTopic=async i=>{if(!Pe(i,!1)){const{message:n}=z("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(n)}if(!this.pairings.keys.includes(i)){const{message:n}=z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(n)}if(Lt(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:n}=z("EXPIRED",`pairing topic: ${i}`);throw new Error(n)}},this.core=t,this.logger=Ye(r,this.name),this.pairings=new Ui(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ge(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(qe.message,async t=>{const{topic:r,message:i}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const n=await this.core.crypto.decode(r,i);try{_s(n)?(this.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):Ti(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.core.history.delete(r,n.id))}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(rt.expired,async t=>{const{topic:r}=cu(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Lr.expire,{topic:r}))})}}class x1 extends Nf{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new yt.EventEmitter,this.name=e1,this.version=t1,this.cached=[],this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,n,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:n,chainId:s}),this.records.has(n.id))return;const a={id:n.id,topic:i,request:{method:n.method,params:n.params||null},chainId:s,expiry:Xe(G.THIRTY_DAYS)};this.records.set(a.id,a),this.events.emit(pt.created,a)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const n=await this.getRecord(i.id);typeof n.response>"u"&&(n.response=at(i)?{error:i.error}:{result:i.result},this.records.set(n.id,n),this.events.emit(pt.updated,n))},this.get=async(i,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:n}),await this.getRecord(n)),this.delete=(i,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(s=>{if(s.topic===i){if(typeof n<"u"&&s.id!==n)return;this.records.delete(s.id),this.events.emit(pt.deleted,s)}})},this.exists=async(i,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===i:!1),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=Ye(r,this.name)}get context(){return Ge(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:pr(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(i)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(pt.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(pt.created,t=>{const r=pt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(pt.updated,t=>{const r=pt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(pt.deleted,t=>{const r=pt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(Vr.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{G.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class A1 extends Lf{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new yt.EventEmitter,this.name=r1,this.version=i1,this.cached=[],this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const n=this.formatTarget(i);return typeof this.getExpiration(n)<"u"}catch{return!1}},this.set=(i,n)=>{this.isInitialized();const s=this.formatTarget(i),a={target:s,expiry:n};this.expirations.set(s,a),this.checkExpiry(s,a),this.events.emit(rt.created,{target:s,expiration:a})},this.get=i=>{this.isInitialized();const n=this.formatTarget(i);return this.getExpiration(n)},this.del=i=>{if(this.isInitialized(),this.has(i)){const n=this.formatTarget(i),s=this.getExpiration(n);this.expirations.delete(n),this.events.emit(rt.deleted,{target:n,expiration:s})}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=Ye(r,this.name)}get context(){return Ge(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return Nw(t);if(typeof t=="number")return Pw(t);const{message:r}=z("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(rt.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(i),new Error(i)}return r}checkExpiry(t,r){const{expiry:i}=r;G.toMiliseconds(i)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(rt.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(Vr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(rt.created,t=>{const r=rt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(rt.expired,t=>{const r=rt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(rt.deleted,t=>{const r=rt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}}}class R1 extends Mf{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=An,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async i=>{if(this.verifyDisabled||yr()||!wr())return;const n=this.getVerifyUrl(i?.verifyUrl);this.verifyUrl!==n&&this.removeIframe(),this.verifyUrl=n;try{await this.createIframe()}catch(s){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(s)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Qn;try{await this.createIframe()}catch(s){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(s),this.verifyDisabled=!0}}},this.register=async i=>{this.initialized?this.sendPost(i.attestationId):(this.addToQueue(i.attestationId),await this.init())},this.resolve=async i=>{if(this.isDevEnv)return"";const n=this.getVerifyUrl(i?.verifyUrl);let s;try{s=await this.fetchAttestation(i.attestationId,n)}catch(a){this.logger.info(`failed to resolve attestation: ${i.attestationId} from url: ${n}`),this.logger.info(a),s=await this.fetchAttestation(i.attestationId,Qn)}return s},this.fetchAttestation=async(i,n)=>{this.logger.info(`resolving attestation: ${i} from url: ${n}`);const s=this.startAbortTimer(G.ONE_SECOND*2),a=await fetch(`${n}/attestation/${i}`,{signal:this.abortController.signal});return clearTimeout(s),a.status===200?await a.json():void 0},this.addToQueue=i=>{this.queue.push(i)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(i=>this.sendPost(i)),this.queue=[])},this.sendPost=i=>{var n;try{if(!this.iframe)return;(n=this.iframe.contentWindow)==null||n.postMessage(i,"*"),this.logger.info(`postMessage sent: ${i} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let i;const n=s=>{s.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",n),i())};await Promise.race([new Promise(s=>{if(document.getElementById(An))return s();window.addEventListener("message",n);const a=document.createElement("iframe");a.id=An,a.src=`${this.verifyUrl}/${this.projectId}`,a.style.display="none",document.body.append(a),this.iframe=a,i=s}),new Promise((s,a)=>setTimeout(()=>{window.removeEventListener("message",n),a("verify iframe load timeout")},G.toMiliseconds(G.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=i=>{let n=i||fr;return n1.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${fr}`),n=fr),n},this.logger=Ye(r,this.name),this.verifyUrl=fr,this.abortController=new AbortController,this.isDevEnv=ys()&&om.IS_VITEST}get context(){return Ge(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),G.toMiliseconds(t))}}class C1 extends Bf{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.context=s1,this.registerDeviceToken=async i=>{const{clientId:n,token:s,notificationType:a,enableEncrypted:c=!1}=i,u=`${o1}/${this.projectId}/clients`;await sm(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:n,type:a,token:s,always_raw:c})})},this.logger=Ye(r,this.context)}}var N1=Object.defineProperty,tc=Object.getOwnPropertySymbols,P1=Object.prototype.hasOwnProperty,T1=Object.prototype.propertyIsEnumerable,rc=(e,t,r)=>t in e?N1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ic=(e,t)=>{for(var r in t||(t={}))P1.call(t,r)&&rc(e,r,t[r]);if(tc)for(var r of tc(t))T1.call(t,r)&&rc(e,r,t[r]);return e};class Ds extends Cf{constructor(t){super(t),this.protocol=Ou,this.version=C0,this.name=xu,this.events=new yt.EventEmitter,this.initialized=!1,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.projectId=t?.projectId,this.relayUrl=t?.relayUrl||Ru,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof t?.logger<"u"&&typeof t?.logger!="string"?t.logger:es(ts({level:t?.logger||N0.logger}));this.logger=Ye(r,this.name),this.heartbeat=new Vr.HeartBeat,this.crypto=new c1(this,this.logger,t?.keychain),this.history=new x1(this,this.logger),this.expirer=new A1(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new $h(ic(ic({},P0),t?.storageOptions)),this.relayer=new _1({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new O1(this,this.logger),this.verify=new R1(this.projectId||"",this.logger),this.echoClient=new C1(this.projectId||"",this.logger)}static async init(t){const r=new Ds(t);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(G0,i),r}get context(){return Ge(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const $1=Ds,Cu="wc",Nu=2,Pu="client",Ss=`${Cu}@${Nu}:${Pu}:`,Cn={name:Pu,logger:"error"},nc="WALLETCONNECT_DEEPLINK_CHOICE",U1="proposal",F1="Proposal expired",L1="session",wi=G.SEVEN_DAYS,M1="engine",It={wc_sessionPropose:{req:{ttl:G.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1104},res:{ttl:G.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1106},res:{ttl:G.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:G.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:G.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:G.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1112},res:{ttl:G.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1115}}},Nn={min:G.FIVE_MINUTES,max:G.SEVEN_DAYS},Ot={idle:"IDLE",active:"ACTIVE"},B1="request",j1=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var q1=Object.defineProperty,z1=Object.defineProperties,K1=Object.getOwnPropertyDescriptors,sc=Object.getOwnPropertySymbols,V1=Object.prototype.hasOwnProperty,H1=Object.prototype.propertyIsEnumerable,oc=(e,t,r)=>t in e?q1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ze=(e,t)=>{for(var r in t||(t={}))V1.call(t,r)&&oc(e,r,t[r]);if(sc)for(var r of sc(t))H1.call(t,r)&&oc(e,r,t[r]);return e},lr=(e,t)=>z1(e,K1(t));class W1 extends qf{constructor(t){super(t),this.name=M1,this.events=new lc,this.initialized=!1,this.ignoredPayloadTypes=[nr],this.requestQueue={state:Ot.idle,queue:[]},this.sessionRequestQueue={state:Ot.idle,queue:[]},this.requestQueueDelay=G.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(It)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},G.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const i=lr(ze({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i);const{pairingTopic:n,requiredNamespaces:s,optionalNamespaces:a,sessionProperties:c,relays:u}=i;let l=n,h,p=!1;if(l&&(p=this.client.core.pairing.pairings.get(l).active),!l||!p){const{topic:g,uri:y}=await this.client.core.pairing.create();l=g,h=y}const w=await this.client.core.crypto.generateKeyPair(),v=It.wc_sessionPropose.req.ttl||G.FIVE_MINUTES,E=Xe(v),O=ze({requiredNamespaces:s,optionalNamespaces:a,relays:u??[{protocol:Au}],proposer:{publicKey:w,metadata:this.client.metadata},expiryTimestamp:E},c&&{sessionProperties:c}),{reject:C,resolve:P,done:_}=hr(v,F1);if(this.events.once(Ee("session_connect"),async({error:g,session:y})=>{if(g)C(g);else if(y){y.self.publicKey=w;const f=lr(ze({},y),{requiredNamespaces:O.requiredNamespaces,optionalNamespaces:O.optionalNamespaces});await this.client.session.set(y.topic,f),await this.setExpiry(y.topic,y.expiry),l&&await this.client.core.pairing.updateMetadata({topic:l,metadata:y.peer.metadata}),P(f)}}),!l){const{message:g}=z("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw new Error(g)}const D=await this.sendRequest({topic:l,method:"wc_sessionPropose",params:O,throwOnFailedPublish:!0});return await this.setProposal(D,ze({id:D},O)),{uri:h,approval:_}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:i,relayProtocol:n,namespaces:s,sessionProperties:a}=r,c=this.client.proposal.get(i);let{pairingTopic:u,proposer:l,requiredNamespaces:h,optionalNamespaces:p}=c;u=u||"";const w=await this.client.core.crypto.generateKeyPair(),v=l.publicKey,E=await this.client.core.crypto.generateSharedKey(w,v);u&&i&&(await this.client.core.pairing.updateMetadata({topic:u,metadata:l.metadata}),await this.sendResult({id:i,topic:u,result:{relay:{protocol:n??"irn"},responderPublicKey:w}}),await this.client.proposal.delete(i,_e("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:u}));const O=ze({relay:{protocol:n??"irn"},namespaces:s,pairingTopic:u,controller:{publicKey:w,metadata:this.client.metadata},expiry:Xe(wi)},a&&{sessionProperties:a});await this.client.core.relayer.subscribe(E);const C=lr(ze({},O),{topic:E,requiredNamespaces:h,optionalNamespaces:p,pairingTopic:u,acknowledged:!1,self:O.controller,peer:{publicKey:l.publicKey,metadata:l.metadata},controller:w});await this.client.session.set(E,C);try{await this.sendRequest({topic:E,method:"wc_sessionSettle",params:O,throwOnFailedPublish:!0})}catch(P){throw this.client.logger.error(P),this.client.session.delete(E,_e("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(E),P}return await this.setExpiry(E,Xe(wi)),{topic:E,acknowledged:()=>new Promise(P=>setTimeout(()=>P(this.client.session.get(E)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:i,reason:n}=r,{pairingTopic:s}=this.client.proposal.get(i);s&&(await this.sendError(i,s,n),await this.client.proposal.delete(i,_e("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:i,namespaces:n}=r,s=await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:n}}),{done:a,resolve:c,reject:u}=hr();return this.events.once(Ee("session_update",s),({error:l})=>{l?u(l):c()}),await this.client.session.update(i,{namespaces:n}),{acknowledged:a}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:i}=r,n=await this.sendRequest({topic:i,method:"wc_sessionExtend",params:{}}),{done:s,resolve:a,reject:c}=hr();return this.events.once(Ee("session_extend",n),({error:u})=>{u?c(u):a()}),await this.setExpiry(i,Xe(wi)),{acknowledged:s}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:i,request:n,topic:s,expiry:a=It.wc_sessionRequest.req.ttl}=r,c=ms(),{done:u,resolve:l,reject:h}=hr(a,"Request expired. Please try again.");return this.events.once(Ee("session_request",c),({error:p,result:w})=>{p?h(p):l(w)}),await Promise.all([new Promise(async p=>{await this.sendRequest({clientRpcId:c,topic:s,method:"wc_sessionRequest",params:{request:lr(ze({},n),{expiryTimestamp:Xe(a)}),chainId:i},expiry:a,throwOnFailedPublish:!0}).catch(w=>h(w)),this.client.events.emit("session_request_sent",{topic:s,request:n,chainId:i,id:c}),p()}),new Promise(async p=>{const w=await $w(this.client.core.storage,nc);Tw({id:c,topic:s,wcDeepLink:w}),p()}),u()]).then(p=>p[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:n}=r,{id:s}=n;xt(n)?await this.sendResult({id:s,topic:i,result:n.result,throwOnFailedPublish:!0}):at(n)&&await this.sendError(s,i,n.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const n=await this.sendRequest({topic:i,method:"wc_sessionPing",params:{}}),{done:s,resolve:a,reject:c}=hr();this.events.once(Ee("session_ping",n),({error:u})=>{u?c(u):a()}),await s()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:i,event:n,chainId:s}=r;await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:n,chainId:s}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:_e("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:n}=z("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(n)}},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(i=>Xw(i,r))),this.getPendingSessionRequests=()=>this.client.pendingRequest.getAll(),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter(s=>{var a,c;return((a=s.peerMetadata)==null?void 0:a.url)&&((c=s.peerMetadata)==null?void 0:c.url)===r.peer.metadata.url&&s.topic&&s.topic!==i.topic});if(n.length===0)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),await Promise.all(n.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}},this.deleteSession=async r=>{const{topic:i,expirerHasDeleted:n=!1,emitEvent:s=!0,id:a=0}=r,{self:c}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,_e("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),n||this.client.core.expirer.del(i),this.client.core.storage.removeItem(nc).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===i&&this.deletePendingSessionRequest(u.id,_e("USER_DISCONNECTED"))}),s&&this.client.events.emit("session_delete",{id:a,topic:i})},this.deleteProposal=async(r,i)=>{await Promise.all([this.client.proposal.delete(r,_e("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,i,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==r),n&&(this.sessionRequestQueue.state=Ot.idle,this.client.events.emit("session_request_expire",{id:r}))},this.setExpiry=async(r,i)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:i}),this.client.core.expirer.set(r,i)},this.setProposal=async(r,i)=>{await this.client.proposal.set(r,i),this.client.core.expirer.set(r,Xe(It.wc_sessionPropose.req.ttl))},this.setPendingSessionRequest=async r=>{const{id:i,topic:n,params:s,verifyContext:a}=r,c=s.request.expiryTimestamp||Xe(It.wc_sessionRequest.req.ttl);await this.client.pendingRequest.set(i,{id:i,topic:n,params:s,verifyContext:a}),c&&this.client.core.expirer.set(i,c)},this.sendRequest=async r=>{const{topic:i,method:n,params:s,expiry:a,relayRpcId:c,clientRpcId:u,throwOnFailedPublish:l}=r,h=pr(n,s,u);if(wr()&&j1.includes(n)){const v=dr(JSON.stringify(h));this.client.core.verify.register({attestationId:v})}const p=await this.client.core.crypto.encode(i,h),w=It[n].req;return a&&(w.ttl=a),c&&(w.id=c),this.client.core.history.set(i,h),l?(w.internal=lr(ze({},w.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,p,w)):this.client.core.relayer.publish(i,p,w).catch(v=>this.client.logger.error(v)),h.id},this.sendResult=async r=>{const{id:i,topic:n,result:s,throwOnFailedPublish:a}=r,c=vs(i,s),u=await this.client.core.crypto.encode(n,c),l=await this.client.core.history.get(n,i),h=It[l.request.method].res;a?(h.internal=lr(ze({},h.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,u,h)):this.client.core.relayer.publish(n,u,h).catch(p=>this.client.logger.error(p)),await this.client.core.history.resolve(c)},this.sendError=async(r,i,n)=>{const s=Es(r,n),a=await this.client.core.crypto.encode(i,s),c=await this.client.core.history.get(i,r),u=It[c.request.method].res;this.client.core.relayer.publish(i,a,u),await this.client.core.history.resolve(s)},this.cleanup=async()=>{const r=[],i=[];this.client.session.getAll().forEach(n=>{let s=!1;Lt(n.expiry)&&(s=!0),this.client.core.crypto.keychain.has(n.topic)||(s=!0),s&&r.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{Lt(n.expiryTimestamp)&&i.push(n.id)}),await Promise.all([...r.map(n=>this.deleteSession({topic:n})),...i.map(n=>this.deleteProposal(n))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===Ot.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Ot.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(i=>setTimeout(i,300))}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=Ot.idle},this.processRequest=r=>{const{topic:i,payload:n}=r,s=n.method;switch(s){case"wc_sessionPropose":return this.onSessionProposeRequest(i,n);case"wc_sessionSettle":return this.onSessionSettleRequest(i,n);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,n);case"wc_sessionExtend":return this.onSessionExtendRequest(i,n);case"wc_sessionPing":return this.onSessionPingRequest(i,n);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,n);case"wc_sessionRequest":return this.onSessionRequest(i,n);case"wc_sessionEvent":return this.onSessionEventRequest(i,n);default:return this.client.logger.info(`Unsupported request method ${s}`)}},this.onRelayEventResponse=async r=>{const{topic:i,payload:n}=r,s=(await this.client.core.history.get(i,n.id)).request.method;switch(s){case"wc_sessionPropose":return this.onSessionProposeResponse(i,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,n);case"wc_sessionExtend":return this.onSessionExtendResponse(i,n);case"wc_sessionPing":return this.onSessionPingResponse(i,n);case"wc_sessionRequest":return this.onSessionRequestResponse(i,n);default:return this.client.logger.info(`Unsupported response method ${s}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:i}=r,{message:n}=z("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(n)},this.onSessionProposeRequest=async(r,i)=>{const{params:n,id:s}=i;try{this.isValidConnect(ze({},i.params));const a=n.expiryTimestamp||Xe(It.wc_sessionPropose.req.ttl),c=ze({id:s,pairingTopic:r,expiryTimestamp:a},n);await this.setProposal(s,c);const u=dr(JSON.stringify(i)),l=await this.getVerifyContext(u,c.proposer.metadata);this.client.events.emit("session_proposal",{id:s,params:c,verifyContext:l})}catch(a){await this.sendError(s,r,a),this.client.logger.error(a)}},this.onSessionProposeResponse=async(r,i)=>{const{id:n}=i;if(xt(i)){const{result:s}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:s});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const u=s.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u});const l=await this.client.core.crypto.generateSharedKey(c,u);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:l});const h=await this.client.core.relayer.subscribe(l);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:r})}else at(i)&&(await this.client.proposal.delete(n,_e("USER_DISCONNECTED")),this.events.emit(Ee("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(r,i)=>{const{id:n,params:s}=i;try{this.isValidSessionSettleRequest(s);const{relay:a,controller:c,expiry:u,namespaces:l,sessionProperties:h,pairingTopic:p}=i.params,w=ze({topic:r,relay:a,expiry:u,namespaces:l,acknowledged:!0,pairingTopic:p,requiredNamespaces:{},optionalNamespaces:{},controller:c.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:c.publicKey,metadata:c.metadata}},h&&{sessionProperties:h});await this.sendResult({id:i.id,topic:r,result:!0}),this.events.emit(Ee("session_connect"),{session:w}),this.cleanupDuplicatePairings(w)}catch(a){await this.sendError(n,r,a),this.client.logger.error(a)}},this.onSessionSettleResponse=async(r,i)=>{const{id:n}=i;xt(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ee("session_approve",n),{})):at(i)&&(await this.client.session.delete(r,_e("USER_DISCONNECTED")),this.events.emit(Ee("session_approve",n),{error:i.error}))},this.onSessionUpdateRequest=async(r,i)=>{const{params:n,id:s}=i;try{const a=`${r}_session_update`,c=yi.get(a);if(c&&this.isRequestOutOfSync(c,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidUpdate(ze({topic:r},n)),await this.client.session.update(r,{namespaces:n.namespaces}),await this.sendResult({id:s,topic:r,result:!0}),this.client.events.emit("session_update",{id:s,topic:r,params:n}),yi.set(a,s)}catch(a){await this.sendError(s,r,a),this.client.logger.error(a)}},this.isRequestOutOfSync=(r,i)=>parseInt(i.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,i)=>{const{id:n}=i;xt(i)?this.events.emit(Ee("session_update",n),{}):at(i)&&this.events.emit(Ee("session_update",n),{error:i.error})},this.onSessionExtendRequest=async(r,i)=>{const{id:n}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Xe(wi)),await this.sendResult({id:n,topic:r,result:!0}),this.client.events.emit("session_extend",{id:n,topic:r})}catch(s){await this.sendError(n,r,s),this.client.logger.error(s)}},this.onSessionExtendResponse=(r,i)=>{const{id:n}=i;xt(i)?this.events.emit(Ee("session_extend",n),{}):at(i)&&this.events.emit(Ee("session_extend",n),{error:i.error})},this.onSessionPingRequest=async(r,i)=>{const{id:n}=i;try{this.isValidPing({topic:r}),await this.sendResult({id:n,topic:r,result:!0}),this.client.events.emit("session_ping",{id:n,topic:r})}catch(s){await this.sendError(n,r,s),this.client.logger.error(s)}},this.onSessionPingResponse=(r,i)=>{const{id:n}=i;setTimeout(()=>{xt(i)?this.events.emit(Ee("session_ping",n),{}):at(i)&&this.events.emit(Ee("session_ping",n),{error:i.error})},500)},this.onSessionDeleteRequest=async(r,i)=>{const{id:n}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),await Promise.all([new Promise(s=>{this.client.core.relayer.once(qe.publish,async()=>{s(await this.deleteSession({topic:r,id:n}))})}),this.sendResult({id:n,topic:r,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:_e("USER_DISCONNECTED")})])}catch(s){this.client.logger.error(s)}},this.onSessionRequest=async(r,i)=>{const{id:n,params:s}=i;try{this.isValidRequest(ze({topic:r},s));const a=dr(JSON.stringify(pr("wc_sessionRequest",s,n))),c=this.client.session.get(r),u=await this.getVerifyContext(a,c.peer.metadata),l={id:n,topic:r,params:s,verifyContext:u};await this.setPendingSessionRequest(l),this.addSessionRequestToSessionRequestQueue(l),this.processSessionRequestQueue()}catch(a){await this.sendError(n,r,a),this.client.logger.error(a)}},this.onSessionRequestResponse=(r,i)=>{const{id:n}=i;xt(i)?this.events.emit(Ee("session_request",n),{result:i.result}):at(i)&&this.events.emit(Ee("session_request",n),{error:i.error})},this.onSessionEventRequest=async(r,i)=>{const{id:n,params:s}=i;try{const a=`${r}_session_event_${s.event.name}`,c=yi.get(a);if(c&&this.isRequestOutOfSync(c,n)){this.client.logger.info(`Discarding out of sync request - ${n}`);return}this.isValidEmit(ze({topic:r},s)),this.client.events.emit("session_event",{id:n,topic:r,params:s}),yi.set(a,n)}catch(a){await this.sendError(n,r,a),this.client.logger.error(a)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Ot.idle,this.processSessionRequestQueue()},G.toMiliseconds(this.requestQueueDelay))},this.cleanupPendingSentRequestsForTopic=({topic:r,error:i})=>{const n=this.client.core.history.pending;n.length>0&&n.filter(s=>s.topic===r&&s.request.method==="wc_sessionRequest").forEach(s=>{this.events.emit(Ee("session_request",s.request.id),{error:i})})},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===Ot.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Ot.active,this.client.events.emit("session_request",r)}catch(i){this.client.logger.error(i)}},this.onPairingCreated=r=>{if(r.active)return;const i=this.client.proposal.getAll().find(n=>n.pairingTopic===r.topic);i&&this.onSessionProposeRequest(r.topic,pr("wc_sessionPropose",{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties},i.id))},this.isValidConnect=async r=>{if(!ke(r)){const{message:u}=z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(u)}const{pairingTopic:i,requiredNamespaces:n,optionalNamespaces:s,sessionProperties:a,relays:c}=r;if(Ke(i)||await this.isValidPairingTopic(i),!lb(c)){const{message:u}=z("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}!Ke(n)&&Oi(n)!==0&&this.validateNamespaces(n,"requiredNamespaces"),!Ke(s)&&Oi(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),Ke(a)||this.validateSessionProps(a,"sessionProperties")},this.validateNamespaces=(r,i)=>{const n=ub(r,"connect()",i);if(n)throw new Error(n.message)},this.isValidApprove=async r=>{if(!ke(r))throw new Error(z("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:n,relayProtocol:s,sessionProperties:a}=r;await this.isValidProposalId(i);const c=this.client.proposal.get(i),u=Dn(n,"approve()");if(u)throw new Error(u.message);const l=xa(c.requiredNamespaces,n,"approve()");if(l)throw new Error(l.message);if(!Pe(s,!0)){const{message:h}=z("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(h)}Ke(a)||this.validateSessionProps(a,"sessionProperties")},this.isValidReject=async r=>{if(!ke(r)){const{message:s}=z("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(s)}const{id:i,reason:n}=r;if(await this.isValidProposalId(i),!fb(n)){const{message:s}=z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(s)}},this.isValidSessionSettleRequest=r=>{if(!ke(r)){const{message:l}=z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(l)}const{relay:i,controller:n,namespaces:s,expiry:a}=r;if(!lu(i)){const{message:l}=z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const c=ib(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);const u=Dn(s,"onSessionSettleRequest()");if(u)throw new Error(u.message);if(Lt(a)){const{message:l}=z("EXPIRED","onSessionSettleRequest()");throw new Error(l)}},this.isValidUpdate=async r=>{if(!ke(r)){const{message:u}=z("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(u)}const{topic:i,namespaces:n}=r;await this.isValidSessionTopic(i);const s=this.client.session.get(i),a=Dn(n,"update()");if(a)throw new Error(a.message);const c=xa(s.requiredNamespaces,n,"update()");if(c)throw new Error(c.message)},this.isValidExtend=async r=>{if(!ke(r)){const{message:n}=z("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionTopic(i)},this.isValidRequest=async r=>{if(!ke(r)){const{message:u}=z("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(u)}const{topic:i,request:n,chainId:s,expiry:a}=r;await this.isValidSessionTopic(i);const{namespaces:c}=this.client.session.get(i);if(!Oa(c,s)){const{message:u}=z("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(u)}if(!db(n)){const{message:u}=z("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(u)}if(!yb(c,s,n.method)){const{message:u}=z("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(u)}if(a&&!vb(a,Nn)){const{message:u}=z("MISSING_OR_INVALID",`request() expiry: ${a}. Expiry must be a number (in seconds) between ${Nn.min} and ${Nn.max}`);throw new Error(u)}},this.isValidRespond=async r=>{var i;if(!ke(r)){const{message:a}=z("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(a)}const{topic:n,response:s}=r;try{await this.isValidSessionTopic(n)}catch(a){throw(i=r?.response)!=null&&i.id&&this.cleanupAfterResponse(r),a}if(!pb(s)){const{message:a}=z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(a)}},this.isValidPing=async r=>{if(!ke(r)){const{message:n}=z("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async r=>{if(!ke(r)){const{message:c}=z("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(c)}const{topic:i,event:n,chainId:s}=r;await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!Oa(a,s)){const{message:c}=z("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(c)}if(!gb(n)){const{message:c}=z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(c)}if(!wb(a,s,n.name)){const{message:c}=z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(c)}},this.isValidDisconnect=async r=>{if(!ke(r)){const{message:n}=z("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.getVerifyContext=async(r,i)=>{const n={verified:{verifyUrl:i.verifyUrl||fr,validation:"UNKNOWN",origin:i.url||""}};try{const s=await this.client.core.verify.resolve({attestationId:r,verifyUrl:i.verifyUrl});s&&(n.verified.origin=s.origin,n.verified.isScam=s.isScam,n.verified.validation=s.origin===new URL(i.url).origin?"VALID":"INVALID")}catch(s){this.client.logger.info(s)}return this.client.logger.info(`Verify context: ${JSON.stringify(n)}`),n},this.validateSessionProps=(r,i)=>{Object.values(r).forEach(n=>{if(!Pe(n,!1)){const{message:s}=z("MISSING_OR_INVALID",`${i} must be in Record<string, string> format. Received: ${JSON.stringify(n)}`);throw new Error(s)}})}}async isInitialized(){if(!this.initialized){const{message:t}=z("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(qe.message,async t=>{const{topic:r,message:i}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const n=await this.client.core.crypto.decode(r,i);try{_s(n)?(this.client.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):Ti(n)?(await this.client.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.client.core.history.delete(r,n.id)):this.onRelayEventUnknownPayload({topic:r,payload:n})}catch(s){this.client.logger.error(s)}})}registerExpirerEvents(){this.client.core.expirer.on(rt.expired,async t=>{const{topic:r,id:i}=cu(t.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,z("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(Lr.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!Pe(t,!1)){const{message:r}=z("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(Lt(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=z("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!Pe(t,!1)){const{message:r}=z("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=z("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(Lt(this.client.session.get(t).expiry)){await this.deleteSession({topic:t});const{message:r}=z("EXPIRED",`session topic: ${t}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(t)){const{message:r}=z("MISSING_OR_INVALID",`session topic does not exist in keychain: ${t}`);throw await this.deleteSession({topic:t}),new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(Pe(t,!1)){const{message:r}=z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!hb(t)){const{message:r}=z("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=z("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(Lt(this.client.proposal.get(t).expiryTimestamp)){await this.deleteProposal(t);const{message:r}=z("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class k1 extends Ui{constructor(t,r){super(t,r,U1,Ss),this.core=t,this.logger=r}}class G1 extends Ui{constructor(t,r){super(t,r,L1,Ss),this.core=t,this.logger=r}}class Y1 extends Ui{constructor(t,r){super(t,r,B1,Ss,i=>i.id),this.core=t,this.logger=r}}class Is extends jf{constructor(t){super(t),this.protocol=Cu,this.version=Nu,this.name=Cn.name,this.events=new yt.EventEmitter,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(n){throw this.logger.error(n.message),n}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(n){throw this.logger.error(n.message),n}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(n){throw this.logger.error(n.message),n}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(n){throw this.logger.error(n.message),n}},this.update=async i=>{try{return await this.engine.update(i)}catch(n){throw this.logger.error(n.message),n}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(n){throw this.logger.error(n.message),n}},this.request=async i=>{try{return await this.engine.request(i)}catch(n){throw this.logger.error(n.message),n}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(n){throw this.logger.error(n.message),n}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(n){throw this.logger.error(n.message),n}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(n){throw this.logger.error(n.message),n}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(n){throw this.logger.error(n.message),n}},this.find=i=>{try{return this.engine.find(i)}catch(n){throw this.logger.error(n.message),n}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=t?.name||Cn.name,this.metadata=t?.metadata||Ow();const r=typeof t?.logger<"u"&&typeof t?.logger!="string"?t.logger:es(ts({level:t?.logger||Cn.logger}));this.core=t?.core||new $1(t),this.logger=Ye(r,this.name),this.session=new G1(this.core,this.logger),this.proposal=new k1(this.core,this.logger),this.pendingRequest=new Y1(this.core,this.logger),this.engine=new W1(this)}static async init(t){const r=new Is(t);return await r.initialize(),r}get context(){return Ge(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}}const J1=Is,ac=e=>{const t=e.namespaces.stellar.accounts.map(r=>({network:r.split(":")[1],publicKey:r.split(":")[2]}));return{id:e.topic,name:e.peer.metadata.name,description:e.peer.metadata.description,url:e.peer.metadata.url,icons:e.peer.metadata.icons[0],accounts:t}},Tu="wallet_connect";class Q1{constructor(t){this.wcParams=t,this.moduleType=Ul.BRIDGE_WALLET,this.productId=Tu,this.productName="Wallet Connect",this.productUrl="https://walletconnect.com/",this.productIcon="https://stellar.creit.tech/wallet-icons/walletconnect.png",t.sessionId&&this.setSession(t.sessionId),t.client&&t.modal?(this.client=t.client,this.qrModal=t.modal):J1.init({projectId:t.projectId,metadata:{name:t.name,url:t.url,description:t.description,icons:t.icons}}).then(r=>{console.log("WalletConnect is ready."),this.client=r,this.qrModal=new ih({projectId:t.projectId}),t.onSessionDeleted&&this.onSessionDeleted(t.onSessionDeleted)}).catch(console.error)}async isAvailable(){return!0}async getAddress(){return(async()=>{if(!this.client)throw new Error("WalletConnect is not running yet")})().then(async()=>({address:(await this.getTargetSession()).accounts[0].publicKey})).catch(r=>{throw qs(r)})}async signTransaction(t,r){return(async()=>{if(!this.client)throw new Error("WalletConnect is not running yet")})().then(async()=>{const n=await this.getTargetSession({publicKey:r?.address});return{signedTxXdr:await this.client.request({topic:n.id,chainId:r?.networkPassphrase===js.PUBLIC?"stellar:pubnet":"stellar:testnet",request:{method:this.wcParams.method,params:{xdr:t}}}).then(a=>a.signedXDR)}}).catch(n=>{throw qs(n)})}async signAuthEntry(){throw{code:-3,message:'WalletConnect does not support the "signAuthEntry" function'}}async signMessage(){throw{code:-3,message:'WalletConnect does not support the "signMessage" function'}}async getNetwork(){throw{code:-3,message:'WalletConnect does not support the "getNetwork" function'}}setSession(t){this.activeSession=t}onSessionDeleted(t){if(!this.client)throw new Error("WalletConnect is not running yet");this.client.on("session_delete",r=>{t(r.topic)})}async connectWalletConnect(){if(!this.client)throw new Error("WalletConnect is not running yet");try{const{uri:t,approval:r}=await this.client.connect({requiredNamespaces:{stellar:{methods:[this.wcParams.method],chains:[this.wcParams.network===js.PUBLIC?"stellar:pubnet":"stellar:testnet"],events:[]}}}),i=await new Promise((n,s)=>{t&&this.qrModal.openModal({uri:t}),r().then(a=>{this.qrModal.closeModal(),n(a)}).catch(a=>{this.qrModal.closeModal(),s(a)})}).then(ac);return this.setSession(i.id),i}catch(t){throw this.qrModal.closeModal(),console.error(t),new Error("There was an error when trying to connect")}}async disconnect(){if(!this.client)throw new Error("WalletConnect is not running yet");const t=await this.getSessions();for(const r of t)await this.closeSession(r.id)}async closeSession(t,r){if(!this.client)throw new Error("WalletConnect is not running yet");await this.client.disconnect({topic:t,reason:{message:r||"Session closed",code:-1}})}async getSessions(){if(!this.client)throw new Error("WalletConnect is not running yet");return this.client.session.values.map(ac)}async getTargetSession(t){let i=(await this.getSessions()).find(n=>n.id===this.activeSession||!!n.accounts.find(s=>s.publicKey===t?.publicKey));return i||(i=await this.connectWalletConnect()),i}}var $u=(e=>(e.SIGN="stellar_signXDR",e.SIGN_AND_SUBMIT="stellar_signAndSubmitXDR",e))($u||{});const Ev=Object.freeze(Object.defineProperty({__proto__:null,WALLET_CONNECT_ID:Tu,WalletConnectAllowedMethods:$u,WalletConnectModule:Q1},Symbol.toStringTag,{value:"Module"}));export{Kl as R,cc as T,je as a,Qs as n,rv as o,ct as p,Ki as s,tv as t,Ev as w,gr as y};
